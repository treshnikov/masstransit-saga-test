2022-08-05 21:27:07.253 +04:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2022-08-05 21:27:07.648 +04:00 [INF] Entity Framework Core 6.0.3 initialized 'SagasDbContext' using provider 'Npgsql.EntityFrameworkCore.PostgreSQL:6.0.3+94d0a8eaeb9cf5af6ce55a9e59153c1a1be3244f' with options: None
2022-08-05 21:27:07.674 +04:00 [DBG] Migrating using database 'sagas_db' on server ''.
2022-08-05 21:27:07.682 +04:00 [DBG] Opening connection to database 'sagas_db' on server ''.
2022-08-05 21:27:07.819 +04:00 [DBG] Opened connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:27:07.823 +04:00 [DBG] Closing connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:27:07.828 +04:00 [DBG] Closed connection to database 'sagas_db' on server ''.
2022-08-05 21:27:07.835 +04:00 [DBG] Creating DbCommand for 'ExecuteScalar'.
2022-08-05 21:27:07.841 +04:00 [DBG] Created DbCommand for 'ExecuteScalar' (4ms).
2022-08-05 21:27:07.843 +04:00 [DBG] Opening connection to database 'sagas_db' on server ''.
2022-08-05 21:27:07.895 +04:00 [DBG] Opened connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:27:07.903 +04:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (SELECT 1 FROM pg_catalog.pg_class c JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace WHERE c.relname='__EFMigrationsHistory');
2022-08-05 21:27:07.962 +04:00 [INF] Executed DbCommand (59ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (SELECT 1 FROM pg_catalog.pg_class c JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace WHERE c.relname='__EFMigrationsHistory');
2022-08-05 21:27:07.967 +04:00 [DBG] Closing connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:27:07.969 +04:00 [DBG] Closed connection to database 'sagas_db' on server ''.
2022-08-05 21:27:07.973 +04:00 [DBG] Opening connection to database 'sagas_db' on server ''.
2022-08-05 21:27:08.023 +04:00 [DBG] Opened connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:27:08.026 +04:00 [DBG] Closing connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:27:08.027 +04:00 [DBG] Closed connection to database 'sagas_db' on server ''.
2022-08-05 21:27:08.030 +04:00 [DBG] Creating DbCommand for 'ExecuteScalar'.
2022-08-05 21:27:08.030 +04:00 [DBG] Created DbCommand for 'ExecuteScalar' (0ms).
2022-08-05 21:27:08.031 +04:00 [DBG] Opening connection to database 'sagas_db' on server ''.
2022-08-05 21:27:08.032 +04:00 [DBG] Opened connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:27:08.033 +04:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (SELECT 1 FROM pg_catalog.pg_class c JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace WHERE c.relname='__EFMigrationsHistory');
2022-08-05 21:27:08.035 +04:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (SELECT 1 FROM pg_catalog.pg_class c JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace WHERE c.relname='__EFMigrationsHistory');
2022-08-05 21:27:08.037 +04:00 [DBG] Closing connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:27:08.038 +04:00 [DBG] Closed connection to database 'sagas_db' on server ''.
2022-08-05 21:27:08.051 +04:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2022-08-05 21:27:08.052 +04:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2022-08-05 21:27:08.053 +04:00 [DBG] Opening connection to database 'sagas_db' on server ''.
2022-08-05 21:27:08.055 +04:00 [DBG] Opened connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:27:08.056 +04:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2022-08-05 21:27:08.060 +04:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2022-08-05 21:27:08.066 +04:00 [DBG] A data reader was disposed.
2022-08-05 21:27:08.067 +04:00 [DBG] Closing connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:27:08.068 +04:00 [DBG] Closed connection to database 'sagas_db' on server ''.
2022-08-05 21:27:08.078 +04:00 [INF] No migrations were applied. The database is already up to date.
2022-08-05 21:27:08.081 +04:00 [DBG] 'SagasDbContext' disposed.
2022-08-05 21:27:08.102 +04:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2022-08-05 21:27:08.119 +04:00 [DBG] Hosting starting
2022-08-05 21:27:08.284 +04:00 [INF] Configured endpoint buy-items-saga-state, Saga: BuyItemsSagaState, State Machine: BuyItemsSaga
2022-08-05 21:27:08.370 +04:00 [DBG] Starting bus instances: IBus
2022-08-05 21:27:08.376 +04:00 [DBG] Starting bus: "rabbitmq://localhost/"
2022-08-05 21:27:08.402 +04:00 [DBG] Connect: rabbitmq@localhost:5672/
2022-08-05 21:27:08.432 +04:00 [DBG] Unable to locate an appropriate development https certificate.
2022-08-05 21:27:08.439 +04:00 [DBG] Stopping bus instances: IBus
2022-08-05 21:27:08.442 +04:00 [WRN] Failed to stop bus: "rabbitmq://localhost/SMS2104090_SagasMicroservice_bus_rtpoyyn76cybkkcubdp8qb73bu?temporary=true" (Not Started)
2022-08-05 21:27:08.460 +04:00 [DBG] Connected: rabbitmq@localhost:5672/ (address: amqp://localhost:5672, local: 50217)
2022-08-05 21:27:08.492 +04:00 [DBG] Endpoint Ready: "rabbitmq://localhost/SMS2104090_SagasMicroservice_bus_rtpoyyn76cybkkcubdp8qb73bu?temporary=true"
2022-08-05 21:27:08.506 +04:00 [DBG] Declare queue: name: buy-items-saga-state, durable, consumer-count: 0 message-count: 0
2022-08-05 21:27:08.533 +04:00 [DBG] Declare exchange: name: buy-items-saga-state, type: fanout, durable
2022-08-05 21:27:08.536 +04:00 [DBG] Declare exchange: name: MassTransit:Fault--Contracts:IGetItemsRequest--, type: fanout, durable
2022-08-05 21:27:08.537 +04:00 [DBG] Declare exchange: name: MassTransit.Contracts:RequestTimeoutExpired--Contracts:IGetMoneyRequest--, type: fanout, durable
2022-08-05 21:27:08.538 +04:00 [DBG] Declare exchange: name: MassTransit.Contracts:RequestTimeoutExpired--Contracts:IGetItemsRequest--, type: fanout, durable
2022-08-05 21:27:08.540 +04:00 [DBG] Declare exchange: name: Contracts:IGetMoneyResponse, type: fanout, durable
2022-08-05 21:27:08.550 +04:00 [DBG] Declare exchange: name: Contracts:IGetItemsResponse, type: fanout, durable
2022-08-05 21:27:08.552 +04:00 [DBG] Declare exchange: name: Contracts:BuyItemsRequest, type: fanout, durable
2022-08-05 21:27:08.553 +04:00 [DBG] Declare exchange: name: MassTransit:Fault--Contracts:IGetMoneyRequest--, type: fanout, durable
2022-08-05 21:27:08.557 +04:00 [DBG] Bind queue: source: buy-items-saga-state, destination: buy-items-saga-state
2022-08-05 21:27:08.579 +04:00 [DBG] Bind exchange: source: MassTransit:Fault--Contracts:IGetItemsRequest--, destination: buy-items-saga-state
2022-08-05 21:27:08.582 +04:00 [DBG] Bind exchange: source: MassTransit.Contracts:RequestTimeoutExpired--Contracts:IGetMoneyRequest--, destination: buy-items-saga-state
2022-08-05 21:27:08.583 +04:00 [DBG] Bind exchange: source: MassTransit.Contracts:RequestTimeoutExpired--Contracts:IGetItemsRequest--, destination: buy-items-saga-state
2022-08-05 21:27:08.584 +04:00 [DBG] Bind exchange: source: Contracts:IGetMoneyResponse, destination: buy-items-saga-state
2022-08-05 21:27:08.585 +04:00 [DBG] Bind exchange: source: Contracts:IGetItemsResponse, destination: buy-items-saga-state
2022-08-05 21:27:08.586 +04:00 [DBG] Bind exchange: source: Contracts:BuyItemsRequest, destination: buy-items-saga-state
2022-08-05 21:27:08.587 +04:00 [DBG] Bind exchange: source: MassTransit:Fault--Contracts:IGetMoneyRequest--, destination: buy-items-saga-state
2022-08-05 21:29:25.419 +04:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2022-08-05 21:29:25.857 +04:00 [INF] Entity Framework Core 6.0.3 initialized 'SagasDbContext' using provider 'Npgsql.EntityFrameworkCore.PostgreSQL:6.0.3+94d0a8eaeb9cf5af6ce55a9e59153c1a1be3244f' with options: None
2022-08-05 21:29:25.885 +04:00 [DBG] Migrating using database 'sagas_db' on server ''.
2022-08-05 21:29:25.896 +04:00 [DBG] Opening connection to database 'sagas_db' on server ''.
2022-08-05 21:29:26.027 +04:00 [DBG] Opened connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:29:26.031 +04:00 [DBG] Closing connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:29:26.036 +04:00 [DBG] Closed connection to database 'sagas_db' on server ''.
2022-08-05 21:29:26.043 +04:00 [DBG] Creating DbCommand for 'ExecuteScalar'.
2022-08-05 21:29:26.049 +04:00 [DBG] Created DbCommand for 'ExecuteScalar' (4ms).
2022-08-05 21:29:26.052 +04:00 [DBG] Opening connection to database 'sagas_db' on server ''.
2022-08-05 21:29:26.109 +04:00 [DBG] Opened connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:29:26.116 +04:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (SELECT 1 FROM pg_catalog.pg_class c JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace WHERE c.relname='__EFMigrationsHistory');
2022-08-05 21:29:26.183 +04:00 [INF] Executed DbCommand (68ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (SELECT 1 FROM pg_catalog.pg_class c JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace WHERE c.relname='__EFMigrationsHistory');
2022-08-05 21:29:26.187 +04:00 [DBG] Closing connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:29:26.189 +04:00 [DBG] Closed connection to database 'sagas_db' on server ''.
2022-08-05 21:29:26.192 +04:00 [DBG] Opening connection to database 'sagas_db' on server ''.
2022-08-05 21:29:26.331 +04:00 [DBG] Opened connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:29:26.333 +04:00 [DBG] Closing connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:29:26.335 +04:00 [DBG] Closed connection to database 'sagas_db' on server ''.
2022-08-05 21:29:26.336 +04:00 [DBG] Creating DbCommand for 'ExecuteScalar'.
2022-08-05 21:29:26.337 +04:00 [DBG] Created DbCommand for 'ExecuteScalar' (1ms).
2022-08-05 21:29:26.340 +04:00 [DBG] Opening connection to database 'sagas_db' on server ''.
2022-08-05 21:29:26.341 +04:00 [DBG] Opened connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:29:26.342 +04:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (SELECT 1 FROM pg_catalog.pg_class c JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace WHERE c.relname='__EFMigrationsHistory');
2022-08-05 21:29:26.344 +04:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (SELECT 1 FROM pg_catalog.pg_class c JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace WHERE c.relname='__EFMigrationsHistory');
2022-08-05 21:29:26.345 +04:00 [DBG] Closing connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:29:26.347 +04:00 [DBG] Closed connection to database 'sagas_db' on server ''.
2022-08-05 21:29:26.362 +04:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2022-08-05 21:29:26.363 +04:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2022-08-05 21:29:26.364 +04:00 [DBG] Opening connection to database 'sagas_db' on server ''.
2022-08-05 21:29:26.365 +04:00 [DBG] Opened connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:29:26.367 +04:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2022-08-05 21:29:26.370 +04:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2022-08-05 21:29:26.377 +04:00 [DBG] A data reader was disposed.
2022-08-05 21:29:26.379 +04:00 [DBG] Closing connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:29:26.379 +04:00 [DBG] Closed connection to database 'sagas_db' on server ''.
2022-08-05 21:29:26.388 +04:00 [INF] No migrations were applied. The database is already up to date.
2022-08-05 21:29:26.393 +04:00 [DBG] 'SagasDbContext' disposed.
2022-08-05 21:29:26.416 +04:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2022-08-05 21:29:26.437 +04:00 [DBG] Hosting starting
2022-08-05 21:29:26.628 +04:00 [INF] Configured endpoint buy-items-saga-state, Saga: BuyItemsSagaState, State Machine: BuyItemsSaga
2022-08-05 21:29:26.726 +04:00 [DBG] Starting bus instances: IBus
2022-08-05 21:29:26.732 +04:00 [DBG] Starting bus: "rabbitmq://localhost/"
2022-08-05 21:29:26.762 +04:00 [DBG] Connect: rabbitmq@localhost:5672/
2022-08-05 21:29:26.796 +04:00 [DBG] Unable to locate an appropriate development https certificate.
2022-08-05 21:29:26.802 +04:00 [DBG] Stopping bus instances: IBus
2022-08-05 21:29:26.805 +04:00 [WRN] Failed to stop bus: "rabbitmq://localhost/SMS2104090_SagasMicroservice_bus_db4oyyn76cybkymjbdp8qnymfg?temporary=true" (Not Started)
2022-08-05 21:29:26.821 +04:00 [DBG] Connected: rabbitmq@localhost:5672/ (address: amqp://localhost:5672, local: 50435)
2022-08-05 21:29:26.853 +04:00 [DBG] Endpoint Ready: "rabbitmq://localhost/SMS2104090_SagasMicroservice_bus_db4oyyn76cybkymjbdp8qnymfg?temporary=true"
2022-08-05 21:29:26.868 +04:00 [DBG] Declare queue: name: buy-items-saga-state, durable, consumer-count: 0 message-count: 0
2022-08-05 21:29:26.886 +04:00 [DBG] Declare exchange: name: buy-items-saga-state, type: fanout, durable
2022-08-05 21:29:26.889 +04:00 [DBG] Declare exchange: name: MassTransit:Fault--Contracts:IGetItemsRequest--, type: fanout, durable
2022-08-05 21:29:26.890 +04:00 [DBG] Declare exchange: name: MassTransit.Contracts:RequestTimeoutExpired--Contracts:IGetMoneyRequest--, type: fanout, durable
2022-08-05 21:29:26.894 +04:00 [DBG] Declare exchange: name: MassTransit.Contracts:RequestTimeoutExpired--Contracts:IGetItemsRequest--, type: fanout, durable
2022-08-05 21:29:26.896 +04:00 [DBG] Declare exchange: name: Contracts:IGetMoneyResponse, type: fanout, durable
2022-08-05 21:29:26.897 +04:00 [DBG] Declare exchange: name: Contracts:IGetItemsResponse, type: fanout, durable
2022-08-05 21:29:26.898 +04:00 [DBG] Declare exchange: name: Contracts:BuyItemsRequest, type: fanout, durable
2022-08-05 21:29:26.900 +04:00 [DBG] Declare exchange: name: MassTransit:Fault--Contracts:IGetMoneyRequest--, type: fanout, durable
2022-08-05 21:29:26.904 +04:00 [DBG] Bind queue: source: buy-items-saga-state, destination: buy-items-saga-state
2022-08-05 21:29:26.932 +04:00 [DBG] Bind exchange: source: MassTransit:Fault--Contracts:IGetItemsRequest--, destination: buy-items-saga-state
2022-08-05 21:29:26.935 +04:00 [DBG] Bind exchange: source: MassTransit.Contracts:RequestTimeoutExpired--Contracts:IGetMoneyRequest--, destination: buy-items-saga-state
2022-08-05 21:29:26.936 +04:00 [DBG] Bind exchange: source: MassTransit.Contracts:RequestTimeoutExpired--Contracts:IGetItemsRequest--, destination: buy-items-saga-state
2022-08-05 21:29:26.937 +04:00 [DBG] Bind exchange: source: Contracts:IGetMoneyResponse, destination: buy-items-saga-state
2022-08-05 21:29:26.938 +04:00 [DBG] Bind exchange: source: Contracts:IGetItemsResponse, destination: buy-items-saga-state
2022-08-05 21:29:26.939 +04:00 [DBG] Bind exchange: source: Contracts:BuyItemsRequest, destination: buy-items-saga-state
2022-08-05 21:29:26.941 +04:00 [DBG] Bind exchange: source: MassTransit:Fault--Contracts:IGetMoneyRequest--, destination: buy-items-saga-state
2022-08-05 21:29:27.015 +04:00 [DBG] Consumer Ok: "rabbitmq://localhost/buy-items-saga-state" - amq.ctag-nZN9UY9qIWDZ0UEdj5Na1w
2022-08-05 21:29:27.017 +04:00 [DBG] Endpoint Ready: "rabbitmq://localhost/buy-items-saga-state"
2022-08-05 21:29:27.022 +04:00 [INF] Bus started: "rabbitmq://localhost/"
2022-08-05 21:30:34.333 +04:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2022-08-05 21:30:34.777 +04:00 [INF] Entity Framework Core 6.0.3 initialized 'SagasDbContext' using provider 'Npgsql.EntityFrameworkCore.PostgreSQL:6.0.3+94d0a8eaeb9cf5af6ce55a9e59153c1a1be3244f' with options: None
2022-08-05 21:30:34.807 +04:00 [DBG] Migrating using database 'sagas_db' on server ''.
2022-08-05 21:30:34.814 +04:00 [DBG] Opening connection to database 'sagas_db' on server ''.
2022-08-05 21:30:34.959 +04:00 [DBG] Opened connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:30:34.963 +04:00 [DBG] Closing connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:30:34.970 +04:00 [DBG] Closed connection to database 'sagas_db' on server ''.
2022-08-05 21:30:34.977 +04:00 [DBG] Creating DbCommand for 'ExecuteScalar'.
2022-08-05 21:30:34.984 +04:00 [DBG] Created DbCommand for 'ExecuteScalar' (4ms).
2022-08-05 21:30:34.987 +04:00 [DBG] Opening connection to database 'sagas_db' on server ''.
2022-08-05 21:30:35.041 +04:00 [DBG] Opened connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:30:35.048 +04:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (SELECT 1 FROM pg_catalog.pg_class c JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace WHERE c.relname='__EFMigrationsHistory');
2022-08-05 21:30:35.114 +04:00 [INF] Executed DbCommand (66ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (SELECT 1 FROM pg_catalog.pg_class c JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace WHERE c.relname='__EFMigrationsHistory');
2022-08-05 21:30:35.120 +04:00 [DBG] Closing connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:30:35.122 +04:00 [DBG] Closed connection to database 'sagas_db' on server ''.
2022-08-05 21:30:35.125 +04:00 [DBG] Opening connection to database 'sagas_db' on server ''.
2022-08-05 21:30:35.162 +04:00 [DBG] Opened connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:30:35.164 +04:00 [DBG] Closing connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:30:35.168 +04:00 [DBG] Closed connection to database 'sagas_db' on server ''.
2022-08-05 21:30:35.170 +04:00 [DBG] Creating DbCommand for 'ExecuteScalar'.
2022-08-05 21:30:35.170 +04:00 [DBG] Created DbCommand for 'ExecuteScalar' (0ms).
2022-08-05 21:30:35.172 +04:00 [DBG] Opening connection to database 'sagas_db' on server ''.
2022-08-05 21:30:35.172 +04:00 [DBG] Opened connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:30:35.173 +04:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (SELECT 1 FROM pg_catalog.pg_class c JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace WHERE c.relname='__EFMigrationsHistory');
2022-08-05 21:30:35.176 +04:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (SELECT 1 FROM pg_catalog.pg_class c JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace WHERE c.relname='__EFMigrationsHistory');
2022-08-05 21:30:35.177 +04:00 [DBG] Closing connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:30:35.178 +04:00 [DBG] Closed connection to database 'sagas_db' on server ''.
2022-08-05 21:30:35.192 +04:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2022-08-05 21:30:35.194 +04:00 [DBG] Created DbCommand for 'ExecuteReader' (2ms).
2022-08-05 21:30:35.195 +04:00 [DBG] Opening connection to database 'sagas_db' on server ''.
2022-08-05 21:30:35.196 +04:00 [DBG] Opened connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:30:35.198 +04:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2022-08-05 21:30:35.203 +04:00 [INF] Executed DbCommand (6ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2022-08-05 21:30:35.208 +04:00 [DBG] A data reader was disposed.
2022-08-05 21:30:35.209 +04:00 [DBG] Closing connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:30:35.209 +04:00 [DBG] Closed connection to database 'sagas_db' on server ''.
2022-08-05 21:30:35.220 +04:00 [INF] No migrations were applied. The database is already up to date.
2022-08-05 21:30:35.221 +04:00 [DBG] 'SagasDbContext' disposed.
2022-08-05 21:30:35.242 +04:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2022-08-05 21:30:35.260 +04:00 [DBG] Hosting starting
2022-08-05 21:30:35.435 +04:00 [INF] Configured endpoint buy-items-saga-state, Saga: BuyItemsSagaState, State Machine: BuyItemsSaga
2022-08-05 21:30:35.518 +04:00 [DBG] Starting bus instances: IBus
2022-08-05 21:30:35.523 +04:00 [DBG] Starting bus: "rabbitmq://localhost/"
2022-08-05 21:30:35.551 +04:00 [DBG] Connect: rabbitmq@localhost:5672/
2022-08-05 21:30:35.573 +04:00 [INF] Now listening on: http://localhost:5180
2022-08-05 21:30:35.575 +04:00 [DBG] Loaded hosting startup assembly SagasMicroservice
2022-08-05 21:30:35.577 +04:00 [INF] Application started. Press Ctrl+C to shut down.
2022-08-05 21:30:35.578 +04:00 [INF] Hosting environment: Development
2022-08-05 21:30:35.579 +04:00 [INF] Content root path: D:\github\microservices-archetecture\MicroservicesWithSagas\SagasMicroservice\
2022-08-05 21:30:35.580 +04:00 [DBG] Hosting started
2022-08-05 21:30:35.604 +04:00 [DBG] Connected: rabbitmq@localhost:5672/ (address: amqp://localhost:5672, local: 50538)
2022-08-05 21:30:35.627 +04:00 [DBG] Endpoint Ready: "rabbitmq://localhost/SMS2104090_SagasMicroservice_bus_htmyyyn76cybmjwdbdp8qnbwfk?temporary=true"
2022-08-05 21:30:35.638 +04:00 [DBG] Declare queue: name: buy-items-saga-state, durable, consumer-count: 0 message-count: 0
2022-08-05 21:30:35.664 +04:00 [DBG] Declare exchange: name: buy-items-saga-state, type: fanout, durable
2022-08-05 21:30:35.667 +04:00 [DBG] Declare exchange: name: MassTransit:Fault--Contracts:IGetItemsRequest--, type: fanout, durable
2022-08-05 21:30:35.668 +04:00 [DBG] Declare exchange: name: MassTransit.Contracts:RequestTimeoutExpired--Contracts:IGetMoneyRequest--, type: fanout, durable
2022-08-05 21:30:35.670 +04:00 [DBG] Declare exchange: name: MassTransit.Contracts:RequestTimeoutExpired--Contracts:IGetItemsRequest--, type: fanout, durable
2022-08-05 21:30:35.671 +04:00 [DBG] Declare exchange: name: Contracts:IGetMoneyResponse, type: fanout, durable
2022-08-05 21:30:35.674 +04:00 [DBG] Declare exchange: name: Contracts:IGetItemsResponse, type: fanout, durable
2022-08-05 21:30:35.675 +04:00 [DBG] Declare exchange: name: Contracts:BuyItemsRequest, type: fanout, durable
2022-08-05 21:30:35.677 +04:00 [DBG] Declare exchange: name: MassTransit:Fault--Contracts:IGetMoneyRequest--, type: fanout, durable
2022-08-05 21:30:35.680 +04:00 [DBG] Bind queue: source: buy-items-saga-state, destination: buy-items-saga-state
2022-08-05 21:30:35.709 +04:00 [DBG] Bind exchange: source: MassTransit:Fault--Contracts:IGetItemsRequest--, destination: buy-items-saga-state
2022-08-05 21:30:35.713 +04:00 [DBG] Bind exchange: source: MassTransit.Contracts:RequestTimeoutExpired--Contracts:IGetMoneyRequest--, destination: buy-items-saga-state
2022-08-05 21:30:35.714 +04:00 [DBG] Bind exchange: source: MassTransit.Contracts:RequestTimeoutExpired--Contracts:IGetItemsRequest--, destination: buy-items-saga-state
2022-08-05 21:30:35.715 +04:00 [DBG] Bind exchange: source: Contracts:IGetMoneyResponse, destination: buy-items-saga-state
2022-08-05 21:30:35.716 +04:00 [DBG] Bind exchange: source: Contracts:IGetItemsResponse, destination: buy-items-saga-state
2022-08-05 21:30:35.717 +04:00 [DBG] Bind exchange: source: Contracts:BuyItemsRequest, destination: buy-items-saga-state
2022-08-05 21:30:35.717 +04:00 [DBG] Bind exchange: source: MassTransit:Fault--Contracts:IGetMoneyRequest--, destination: buy-items-saga-state
2022-08-05 21:30:35.767 +04:00 [DBG] Consumer Ok: "rabbitmq://localhost/buy-items-saga-state" - amq.ctag-BylJrOkeTcKFDuH9sxyugA
2022-08-05 21:30:35.771 +04:00 [DBG] Endpoint Ready: "rabbitmq://localhost/buy-items-saga-state"
2022-08-05 21:30:35.774 +04:00 [INF] Bus started: "rabbitmq://localhost/"
2022-08-05 21:37:20.650 +04:00 [INF] Application is shutting down...
2022-08-05 21:37:20.650 +04:00 [DBG] Hosting stopping
2022-08-05 21:37:20.662 +04:00 [DBG] Stopping bus instances: IBus
2022-08-05 21:37:20.668 +04:00 [DBG] Stopping bus: "rabbitmq://localhost/"
2022-08-05 21:37:20.680 +04:00 [DBG] Endpoint Stopping: "rabbitmq://localhost/buy-items-saga-state"
2022-08-05 21:37:20.684 +04:00 [DBG] Stopping receive transport: "rabbitmq://localhost/buy-items-saga-state"
2022-08-05 21:37:20.691 +04:00 [DBG] Stopping Consumer: "rabbitmq://localhost/buy-items-saga-state" - amq.ctag-BylJrOkeTcKFDuH9sxyugA
2022-08-05 21:37:20.698 +04:00 [DBG] Endpoint Stopping: "rabbitmq://localhost/SMS2104090_SagasMicroservice_bus_htmyyyn76cybmjwdbdp8qnbwfk?temporary=true"
2022-08-05 21:37:20.699 +04:00 [DBG] Consumer Cancel Ok: "rabbitmq://localhost/buy-items-saga-state" - amq.ctag-BylJrOkeTcKFDuH9sxyugA
2022-08-05 21:37:20.700 +04:00 [DBG] Stopping receive transport: "rabbitmq://localhost/SMS2104090_SagasMicroservice_bus_htmyyyn76cybmjwdbdp8qnbwfk?temporary=true"
2022-08-05 21:37:20.704 +04:00 [DBG] Endpoint Completed: "rabbitmq://localhost/buy-items-saga-state"
2022-08-05 21:37:20.704 +04:00 [DBG] Endpoint Completed: "rabbitmq://localhost/SMS2104090_SagasMicroservice_bus_htmyyyn76cybmjwdbdp8qnbwfk?temporary=true"
2022-08-05 21:37:20.705 +04:00 [DBG] Consumer completed amq.ctag-BylJrOkeTcKFDuH9sxyugA: 0 received, 0 concurrent
2022-08-05 21:37:20.733 +04:00 [DBG] Disconnect: rabbitmq@localhost:5672/
2022-08-05 21:37:20.741 +04:00 [DBG] Disconnected: rabbitmq@localhost:5672/
2022-08-05 21:37:20.744 +04:00 [INF] Bus stopped: "rabbitmq://localhost/"
2022-08-05 21:37:20.748 +04:00 [DBG] Hosting stopped
2022-08-05 21:37:25.026 +04:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2022-08-05 21:37:25.859 +04:00 [INF] Entity Framework Core 6.0.3 initialized 'SagasDbContext' using provider 'Npgsql.EntityFrameworkCore.PostgreSQL:6.0.3+94d0a8eaeb9cf5af6ce55a9e59153c1a1be3244f' with options: None
2022-08-05 21:37:25.901 +04:00 [DBG] Migrating using database 'sagas_db' on server ''.
2022-08-05 21:37:25.913 +04:00 [DBG] Opening connection to database 'sagas_db' on server ''.
2022-08-05 21:37:26.105 +04:00 [DBG] Opened connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:37:26.109 +04:00 [DBG] Closing connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:37:26.118 +04:00 [DBG] Closed connection to database 'sagas_db' on server ''.
2022-08-05 21:37:26.128 +04:00 [DBG] Creating DbCommand for 'ExecuteScalar'.
2022-08-05 21:37:26.139 +04:00 [DBG] Created DbCommand for 'ExecuteScalar' (8ms).
2022-08-05 21:37:26.145 +04:00 [DBG] Opening connection to database 'sagas_db' on server ''.
2022-08-05 21:37:26.226 +04:00 [DBG] Opened connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:37:26.236 +04:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (SELECT 1 FROM pg_catalog.pg_class c JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace WHERE c.relname='__EFMigrationsHistory');
2022-08-05 21:37:26.329 +04:00 [INF] Executed DbCommand (94ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (SELECT 1 FROM pg_catalog.pg_class c JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace WHERE c.relname='__EFMigrationsHistory');
2022-08-05 21:37:26.335 +04:00 [DBG] Closing connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:37:26.339 +04:00 [DBG] Closed connection to database 'sagas_db' on server ''.
2022-08-05 21:37:26.344 +04:00 [DBG] Opening connection to database 'sagas_db' on server ''.
2022-08-05 21:37:26.405 +04:00 [DBG] Opened connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:37:26.408 +04:00 [DBG] Closing connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:37:26.411 +04:00 [DBG] Closed connection to database 'sagas_db' on server ''.
2022-08-05 21:37:26.413 +04:00 [DBG] Creating DbCommand for 'ExecuteScalar'.
2022-08-05 21:37:26.414 +04:00 [DBG] Created DbCommand for 'ExecuteScalar' (1ms).
2022-08-05 21:37:26.417 +04:00 [DBG] Opening connection to database 'sagas_db' on server ''.
2022-08-05 21:37:26.420 +04:00 [DBG] Opened connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:37:26.422 +04:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (SELECT 1 FROM pg_catalog.pg_class c JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace WHERE c.relname='__EFMigrationsHistory');
2022-08-05 21:37:26.426 +04:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (SELECT 1 FROM pg_catalog.pg_class c JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace WHERE c.relname='__EFMigrationsHistory');
2022-08-05 21:37:26.430 +04:00 [DBG] Closing connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:37:26.432 +04:00 [DBG] Closed connection to database 'sagas_db' on server ''.
2022-08-05 21:37:26.456 +04:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2022-08-05 21:37:26.460 +04:00 [DBG] Created DbCommand for 'ExecuteReader' (3ms).
2022-08-05 21:37:26.462 +04:00 [DBG] Opening connection to database 'sagas_db' on server ''.
2022-08-05 21:37:26.464 +04:00 [DBG] Opened connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:37:26.467 +04:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2022-08-05 21:37:26.473 +04:00 [INF] Executed DbCommand (6ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2022-08-05 21:37:26.484 +04:00 [DBG] A data reader was disposed.
2022-08-05 21:37:26.485 +04:00 [DBG] Closing connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:37:26.487 +04:00 [DBG] Closed connection to database 'sagas_db' on server ''.
2022-08-05 21:37:26.502 +04:00 [INF] No migrations were applied. The database is already up to date.
2022-08-05 21:37:26.506 +04:00 [DBG] 'SagasDbContext' disposed.
2022-08-05 21:37:26.539 +04:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2022-08-05 21:37:26.562 +04:00 [DBG] Hosting starting
2022-08-05 21:37:26.816 +04:00 [INF] Configured endpoint buy-items-saga-state, Saga: BuyItemsSagaState, State Machine: BuyItemsSaga
2022-08-05 21:37:26.952 +04:00 [DBG] Starting bus instances: IBus
2022-08-05 21:37:26.959 +04:00 [DBG] Starting bus: "rabbitmq://localhost/"
2022-08-05 21:37:27.001 +04:00 [DBG] Connect: rabbitmq@localhost:5672/
2022-08-05 21:37:27.020 +04:00 [INF] Now listening on: http://localhost:5180
2022-08-05 21:37:27.023 +04:00 [DBG] Loaded hosting startup assembly SagasMicroservice
2022-08-05 21:37:27.025 +04:00 [INF] Application started. Press Ctrl+C to shut down.
2022-08-05 21:37:27.026 +04:00 [INF] Hosting environment: Development
2022-08-05 21:37:27.028 +04:00 [INF] Content root path: D:\github\microservices-archetecture\MicroservicesWithSagas\SagasMicroservice\
2022-08-05 21:37:27.029 +04:00 [DBG] Hosting started
2022-08-05 21:37:27.082 +04:00 [DBG] Connected: rabbitmq@localhost:5672/ (address: amqp://localhost:5672, local: 63131)
2022-08-05 21:37:27.118 +04:00 [DBG] Endpoint Ready: "rabbitmq://localhost/SMS2104090_SagasMicroservice_bus_ntyyyyn76cybkf86bdp8qnjjgs?temporary=true"
2022-08-05 21:37:27.137 +04:00 [DBG] Declare queue: name: buy-items-saga-state, durable, consumer-count: 0 message-count: 0
2022-08-05 21:37:27.162 +04:00 [DBG] Declare exchange: name: buy-items-saga-state, type: fanout, durable
2022-08-05 21:37:27.166 +04:00 [DBG] Declare exchange: name: MassTransit:Fault--Contracts:IGetItemsRequest--, type: fanout, durable
2022-08-05 21:37:27.168 +04:00 [DBG] Declare exchange: name: MassTransit.Contracts:RequestTimeoutExpired--Contracts:IGetMoneyRequest--, type: fanout, durable
2022-08-05 21:37:27.170 +04:00 [DBG] Declare exchange: name: MassTransit.Contracts:RequestTimeoutExpired--Contracts:IGetItemsRequest--, type: fanout, durable
2022-08-05 21:37:27.172 +04:00 [DBG] Declare exchange: name: Contracts:IGetMoneyResponse, type: fanout, durable
2022-08-05 21:37:27.174 +04:00 [DBG] Declare exchange: name: Contracts:IGetItemsResponse, type: fanout, durable
2022-08-05 21:37:27.175 +04:00 [DBG] Declare exchange: name: Contracts:BuyItemsRequest, type: fanout, durable
2022-08-05 21:37:27.179 +04:00 [DBG] Declare exchange: name: MassTransit:Fault--Contracts:IGetMoneyRequest--, type: fanout, durable
2022-08-05 21:37:27.185 +04:00 [DBG] Bind queue: source: buy-items-saga-state, destination: buy-items-saga-state
2022-08-05 21:37:27.212 +04:00 [DBG] Bind exchange: source: MassTransit:Fault--Contracts:IGetItemsRequest--, destination: buy-items-saga-state
2022-08-05 21:37:27.215 +04:00 [DBG] Bind exchange: source: MassTransit.Contracts:RequestTimeoutExpired--Contracts:IGetMoneyRequest--, destination: buy-items-saga-state
2022-08-05 21:37:27.217 +04:00 [DBG] Bind exchange: source: MassTransit.Contracts:RequestTimeoutExpired--Contracts:IGetItemsRequest--, destination: buy-items-saga-state
2022-08-05 21:37:27.220 +04:00 [DBG] Bind exchange: source: Contracts:IGetMoneyResponse, destination: buy-items-saga-state
2022-08-05 21:37:27.222 +04:00 [DBG] Bind exchange: source: Contracts:IGetItemsResponse, destination: buy-items-saga-state
2022-08-05 21:37:27.225 +04:00 [DBG] Bind exchange: source: Contracts:BuyItemsRequest, destination: buy-items-saga-state
2022-08-05 21:37:27.227 +04:00 [DBG] Bind exchange: source: MassTransit:Fault--Contracts:IGetMoneyRequest--, destination: buy-items-saga-state
2022-08-05 21:37:27.336 +04:00 [DBG] Consumer Ok: "rabbitmq://localhost/buy-items-saga-state" - amq.ctag-10OIVaxKUvfaPFqmEHIMQA
2022-08-05 21:37:27.340 +04:00 [DBG] Endpoint Ready: "rabbitmq://localhost/buy-items-saga-state"
2022-08-05 21:37:27.346 +04:00 [INF] Bus started: "rabbitmq://localhost/"
2022-08-05 21:39:11.045 +04:00 [INF] Entity Framework Core 6.0.3 initialized 'SagasDbContext' using provider 'Npgsql.EntityFrameworkCore.PostgreSQL:6.0.3+94d0a8eaeb9cf5af6ce55a9e59153c1a1be3244f' with options: None
2022-08-05 21:39:11.056 +04:00 [DBG] Opening connection to database 'sagas_db' on server ''.
2022-08-05 21:39:11.058 +04:00 [DBG] Opened connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:39:11.060 +04:00 [DBG] Beginning transaction with isolation level 'Serializable'.
2022-08-05 21:39:11.065 +04:00 [DBG] Began transaction with isolation level 'Serializable'.
2022-08-05 21:39:11.124 +04:00 [DBG] Compiling query expression: 
'DbSet<BuyItemsSagaState>().FromSql(SELECT * FROM "public"."BuyItemsSagaState" WHERE "CorrelationId" = @p0 FOR UPDATE, __p_0)
    .SingleOrDefault()'
2022-08-05 21:39:11.236 +04:00 [DBG] Generated query execution expression: 
'queryContext => ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync<BuyItemsSagaState>(
    asyncEnumerable: new SingleQueryingEnumerable<BuyItemsSagaState>(
        (RelationalQueryContext)queryContext, 
        RelationalCommandCache.SelectExpression(
            Projection Mapping:
                EmptyProjectionMember -> Dictionary<IProperty, int> { [Property: BuyItemsSagaState.CorrelationId (Guid) Required PK AfterSave:Throw, 0], [Property: BuyItemsSagaState.CurrentState (string) MaxLength(255), 1], [Property: BuyItemsSagaState.RequestId (Guid?), 2], [Property: BuyItemsSagaState.ResponseAddress (Uri), 3] }
            SELECT TOP(2) b.CorrelationId, b.CurrentState, b.RequestId, b.ResponseAddress
            FROM SELECT * FROM "public"."BuyItemsSagaState" WHERE "CorrelationId" = @p0 FOR UPDATE), 
        Func<QueryContext, DbDataReader, ResultContext, SingleQueryResultCoordinator, BuyItemsSagaState>, 
        SagasDbContext, 
        False, 
        False, 
        True
    ), 
    cancellationToken: queryContext.CancellationToken)'
2022-08-05 21:39:11.262 +04:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2022-08-05 21:39:11.264 +04:00 [DBG] Created DbCommand for 'ExecuteReader' (2ms).
2022-08-05 21:39:11.270 +04:00 [DBG] Executing DbCommand [Parameters=[p0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT b."CorrelationId", b."CurrentState", b."RequestId", b."ResponseAddress"
FROM (
    SELECT * FROM "public"."BuyItemsSagaState" WHERE "CorrelationId" = @p0 FOR UPDATE
) AS b
LIMIT 2
2022-08-05 21:39:11.300 +04:00 [INF] Executed DbCommand (31ms) [Parameters=[p0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT b."CorrelationId", b."CurrentState", b."RequestId", b."ResponseAddress"
FROM (
    SELECT * FROM "public"."BuyItemsSagaState" WHERE "CorrelationId" = @p0 FOR UPDATE
) AS b
LIMIT 2
2022-08-05 21:39:11.320 +04:00 [DBG] A data reader was disposed.
2022-08-05 21:39:11.337 +04:00 [DBG] SAGA:BuyItemsSagaState:"3fa85f64-5717-4562-b3fc-2c963f66afa6" Created Contracts.BuyItemsRequest
2022-08-05 21:39:11.414 +04:00 [DBG] SAGA:BuyItemsSagaState:"3fa85f64-5717-4562-b3fc-2c963f66afa6" Added Contracts.BuyItemsRequest
2022-08-05 21:39:11.600 +04:00 [DBG] Create send transport: "rabbitmq://localhost/buy-items-saga-state"
2022-08-05 21:39:11.642 +04:00 [DBG] Declare exchange: name: buy-items-saga-state, type: fanout, durable
2022-08-05 21:39:11.745 +04:00 [DBG] Declare exchange: name: buy-items-saga-state_delay, type: x-delayed-message, durable, x-delayed-type: fanout
2022-08-05 21:39:11.746 +04:00 [DBG] Declare exchange: name: buy-items-saga-state, type: fanout, durable
2022-08-05 21:39:11.757 +04:00 [DBG] Bind exchange: source: buy-items-saga-state_delay, destination: buy-items-saga-state
2022-08-05 21:39:11.798 +04:00 [DBG] SEND "rabbitmq://localhost/buy-items-saga-state" "14400000-5df3-0015-15b0-08da7709686f" MassTransit.Contracts.RequestTimeoutExpired<Contracts.IGetMoneyRequest>
2022-08-05 21:39:11.864 +04:00 [DBG] Context 'SagasDbContext' started tracking 'BuyItemsSagaState' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2022-08-05 21:39:11.870 +04:00 [DBG] SaveChanges starting for 'SagasDbContext'.
2022-08-05 21:39:11.874 +04:00 [DBG] DetectChanges starting for 'SagasDbContext'.
2022-08-05 21:39:11.882 +04:00 [DBG] DetectChanges completed for 'SagasDbContext'.
2022-08-05 21:39:11.899 +04:00 [DBG] Creating transaction savepoint.
2022-08-05 21:39:11.911 +04:00 [DBG] Created transaction savepoint.
2022-08-05 21:39:11.964 +04:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2022-08-05 21:39:11.965 +04:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2022-08-05 21:39:11.968 +04:00 [DBG] Executing DbCommand [Parameters=[@p0='?' (DbType = Guid), @p1='?', @p2='?' (DbType = Guid), @p3='?'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "BuyItemsSagaState" ("CorrelationId", "CurrentState", "RequestId", "ResponseAddress")
VALUES (@p0, @p1, @p2, @p3);
2022-08-05 21:39:11.975 +04:00 [INF] Executed DbCommand (7ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?', @p2='?' (DbType = Guid), @p3='?'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "BuyItemsSagaState" ("CorrelationId", "CurrentState", "RequestId", "ResponseAddress")
VALUES (@p0, @p1, @p2, @p3);
2022-08-05 21:39:11.979 +04:00 [DBG] A data reader was disposed.
2022-08-05 21:39:11.981 +04:00 [DBG] Releasing transaction savepoint.
2022-08-05 21:39:11.983 +04:00 [DBG] Released transaction savepoint.
2022-08-05 21:39:11.992 +04:00 [DBG] An entity of type 'BuyItemsSagaState' tracked by 'SagasDbContext' changed state from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2022-08-05 21:39:11.995 +04:00 [DBG] SaveChanges completed for 'SagasDbContext' with 1 entities written to the database.
2022-08-05 21:39:11.998 +04:00 [DBG] Committing transaction.
2022-08-05 21:39:12.005 +04:00 [DBG] Committed transaction.
2022-08-05 21:39:12.007 +04:00 [DBG] Closing connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:39:12.008 +04:00 [DBG] Closed connection to database 'sagas_db' on server ''.
2022-08-05 21:39:12.010 +04:00 [DBG] Disposing transaction.
2022-08-05 21:39:12.012 +04:00 [DBG] 'SagasDbContext' disposed.
2022-08-05 21:39:12.018 +04:00 [DBG] RECEIVE "rabbitmq://localhost/buy-items-saga-state" "da210000-5df3-0015-76da-08da770967de" Contracts.BuyItemsRequest BuyItemsSagaState("00:00:00.9783789")
2022-08-05 21:39:12.024 +04:00 [DBG] Declare exchange: name: Contracts:IGetMoneyRequest, type: fanout, durable
2022-08-05 21:39:12.041 +04:00 [DBG] SEND "rabbitmq://localhost/Contracts:IGetMoneyRequest" "14400000-5df3-0015-dd2e-08da770968a2" Contracts.IGetMoneyRequest
2022-08-05 21:39:12.337 +04:00 [INF] Entity Framework Core 6.0.3 initialized 'SagasDbContext' using provider 'Npgsql.EntityFrameworkCore.PostgreSQL:6.0.3+94d0a8eaeb9cf5af6ce55a9e59153c1a1be3244f' with options: None
2022-08-05 21:39:12.342 +04:00 [DBG] Opening connection to database 'sagas_db' on server ''.
2022-08-05 21:39:12.343 +04:00 [DBG] Opened connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:39:12.344 +04:00 [DBG] Beginning transaction with isolation level 'Serializable'.
2022-08-05 21:39:12.345 +04:00 [DBG] Began transaction with isolation level 'Serializable'.
2022-08-05 21:39:12.348 +04:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2022-08-05 21:39:12.349 +04:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2022-08-05 21:39:12.350 +04:00 [DBG] Executing DbCommand [Parameters=[p0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT b."CorrelationId", b."CurrentState", b."RequestId", b."ResponseAddress"
FROM (
    SELECT * FROM "public"."BuyItemsSagaState" WHERE "CorrelationId" = @p0 FOR UPDATE
) AS b
LIMIT 2
2022-08-05 21:39:12.354 +04:00 [INF] Executed DbCommand (4ms) [Parameters=[p0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT b."CorrelationId", b."CurrentState", b."RequestId", b."ResponseAddress"
FROM (
    SELECT * FROM "public"."BuyItemsSagaState" WHERE "CorrelationId" = @p0 FOR UPDATE
) AS b
LIMIT 2
2022-08-05 21:39:12.358 +04:00 [DBG] Context 'SagasDbContext' started tracking 'BuyItemsSagaState' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2022-08-05 21:39:12.359 +04:00 [DBG] A data reader was disposed.
2022-08-05 21:39:12.360 +04:00 [DBG] SAGA:BuyItemsSagaState:"3fa85f64-5717-4562-b3fc-2c963f66afa6" Used Contracts.IGetMoneyResponse
2022-08-05 21:39:12.372 +04:00 [DBG] SEND "rabbitmq://localhost/buy-items-saga-state" "14400000-5df3-0015-1c49-08da770968d7" MassTransit.Contracts.RequestTimeoutExpired<Contracts.IGetItemsRequest>
2022-08-05 21:39:12.375 +04:00 [DBG] An entity of type 'BuyItemsSagaState' tracked by 'SagasDbContext' changed state from '"Unchanged"' to '"Modified"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2022-08-05 21:39:12.376 +04:00 [DBG] SaveChanges starting for 'SagasDbContext'.
2022-08-05 21:39:12.377 +04:00 [DBG] DetectChanges starting for 'SagasDbContext'.
2022-08-05 21:39:12.378 +04:00 [DBG] DetectChanges completed for 'SagasDbContext'.
2022-08-05 21:39:12.379 +04:00 [DBG] Creating transaction savepoint.
2022-08-05 21:39:12.380 +04:00 [DBG] Created transaction savepoint.
2022-08-05 21:39:12.382 +04:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2022-08-05 21:39:12.382 +04:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2022-08-05 21:39:12.383 +04:00 [DBG] Executing DbCommand [Parameters=[@p3='?' (DbType = Guid), @p0='?', @p1='?' (DbType = Guid), @p2='?'], CommandType='"Text"', CommandTimeout='30']
UPDATE "BuyItemsSagaState" SET "CurrentState" = @p0, "RequestId" = @p1, "ResponseAddress" = @p2
WHERE "CorrelationId" = @p3;
2022-08-05 21:39:12.387 +04:00 [INF] Executed DbCommand (3ms) [Parameters=[@p3='?' (DbType = Guid), @p0='?', @p1='?' (DbType = Guid), @p2='?'], CommandType='"Text"', CommandTimeout='30']
UPDATE "BuyItemsSagaState" SET "CurrentState" = @p0, "RequestId" = @p1, "ResponseAddress" = @p2
WHERE "CorrelationId" = @p3;
2022-08-05 21:39:12.388 +04:00 [DBG] A data reader was disposed.
2022-08-05 21:39:12.389 +04:00 [DBG] Releasing transaction savepoint.
2022-08-05 21:39:12.389 +04:00 [DBG] Released transaction savepoint.
2022-08-05 21:39:12.390 +04:00 [DBG] An entity of type 'BuyItemsSagaState' tracked by 'SagasDbContext' changed state from '"Modified"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2022-08-05 21:39:12.391 +04:00 [DBG] SaveChanges completed for 'SagasDbContext' with 1 entities written to the database.
2022-08-05 21:39:12.393 +04:00 [DBG] Committing transaction.
2022-08-05 21:39:12.394 +04:00 [DBG] Committed transaction.
2022-08-05 21:39:12.394 +04:00 [DBG] Closing connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:39:12.395 +04:00 [DBG] Closed connection to database 'sagas_db' on server ''.
2022-08-05 21:39:12.396 +04:00 [DBG] Disposing transaction.
2022-08-05 21:39:12.397 +04:00 [DBG] 'SagasDbContext' disposed.
2022-08-05 21:39:12.398 +04:00 [DBG] RECEIVE "rabbitmq://localhost/buy-items-saga-state" "da210000-5df3-0015-796e-08da770968c2" Contracts.IGetMoneyResponse BuyItemsSagaState("00:00:00.0990787")
2022-08-05 21:39:12.399 +04:00 [DBG] Declare exchange: name: Contracts:IGetItemsRequest, type: fanout, durable
2022-08-05 21:39:12.410 +04:00 [DBG] SEND "rabbitmq://localhost/Contracts:IGetItemsRequest" "14400000-5df3-0015-3550-08da770968dc" Contracts.IGetItemsRequest
2022-08-05 21:39:12.671 +04:00 [INF] Entity Framework Core 6.0.3 initialized 'SagasDbContext' using provider 'Npgsql.EntityFrameworkCore.PostgreSQL:6.0.3+94d0a8eaeb9cf5af6ce55a9e59153c1a1be3244f' with options: None
2022-08-05 21:39:12.678 +04:00 [DBG] Opening connection to database 'sagas_db' on server ''.
2022-08-05 21:39:12.679 +04:00 [DBG] Opened connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:39:12.680 +04:00 [DBG] Beginning transaction with isolation level 'Serializable'.
2022-08-05 21:39:12.681 +04:00 [DBG] Began transaction with isolation level 'Serializable'.
2022-08-05 21:39:12.682 +04:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2022-08-05 21:39:12.683 +04:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2022-08-05 21:39:12.684 +04:00 [DBG] Executing DbCommand [Parameters=[p0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT b."CorrelationId", b."CurrentState", b."RequestId", b."ResponseAddress"
FROM (
    SELECT * FROM "public"."BuyItemsSagaState" WHERE "CorrelationId" = @p0 FOR UPDATE
) AS b
LIMIT 2
2022-08-05 21:39:12.687 +04:00 [INF] Executed DbCommand (3ms) [Parameters=[p0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT b."CorrelationId", b."CurrentState", b."RequestId", b."ResponseAddress"
FROM (
    SELECT * FROM "public"."BuyItemsSagaState" WHERE "CorrelationId" = @p0 FOR UPDATE
) AS b
LIMIT 2
2022-08-05 21:39:12.690 +04:00 [DBG] Context 'SagasDbContext' started tracking 'BuyItemsSagaState' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2022-08-05 21:39:12.691 +04:00 [DBG] A data reader was disposed.
2022-08-05 21:39:12.692 +04:00 [DBG] SAGA:BuyItemsSagaState:"3fa85f64-5717-4562-b3fc-2c963f66afa6" Used Contracts.IGetItemsResponse
2022-08-05 21:39:12.696 +04:00 [DBG] Create send transport: "rabbitmq://localhost:0/SMS2104090_ApiGateway_bus_5eooyyn76cybmbd5bdp8qnjirf?temporary=true"
2022-08-05 21:39:12.698 +04:00 [DBG] An entity of type 'BuyItemsSagaState' tracked by 'SagasDbContext' changed state from '"Unchanged"' to '"Modified"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2022-08-05 21:39:12.699 +04:00 [DBG] SaveChanges starting for 'SagasDbContext'.
2022-08-05 21:39:12.700 +04:00 [DBG] DetectChanges starting for 'SagasDbContext'.
2022-08-05 21:39:12.701 +04:00 [DBG] DetectChanges completed for 'SagasDbContext'.
2022-08-05 21:39:12.702 +04:00 [DBG] Creating transaction savepoint.
2022-08-05 21:39:12.703 +04:00 [DBG] Created transaction savepoint.
2022-08-05 21:39:12.704 +04:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2022-08-05 21:39:12.705 +04:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2022-08-05 21:39:12.705 +04:00 [DBG] Executing DbCommand [Parameters=[@p3='?' (DbType = Guid), @p0='?', @p1='?' (DbType = Guid), @p2='?'], CommandType='"Text"', CommandTimeout='30']
UPDATE "BuyItemsSagaState" SET "CurrentState" = @p0, "RequestId" = @p1, "ResponseAddress" = @p2
WHERE "CorrelationId" = @p3;
2022-08-05 21:39:12.707 +04:00 [INF] Executed DbCommand (2ms) [Parameters=[@p3='?' (DbType = Guid), @p0='?', @p1='?' (DbType = Guid), @p2='?'], CommandType='"Text"', CommandTimeout='30']
UPDATE "BuyItemsSagaState" SET "CurrentState" = @p0, "RequestId" = @p1, "ResponseAddress" = @p2
WHERE "CorrelationId" = @p3;
2022-08-05 21:39:12.709 +04:00 [DBG] A data reader was disposed.
2022-08-05 21:39:12.709 +04:00 [DBG] Releasing transaction savepoint.
2022-08-05 21:39:12.710 +04:00 [DBG] Released transaction savepoint.
2022-08-05 21:39:12.711 +04:00 [DBG] An entity of type 'BuyItemsSagaState' tracked by 'SagasDbContext' changed state from '"Modified"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2022-08-05 21:39:12.712 +04:00 [DBG] SaveChanges completed for 'SagasDbContext' with 1 entities written to the database.
2022-08-05 21:39:12.713 +04:00 [DBG] Committing transaction.
2022-08-05 21:39:12.713 +04:00 [DBG] Committed transaction.
2022-08-05 21:39:12.714 +04:00 [DBG] Closing connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:39:12.715 +04:00 [DBG] Closed connection to database 'sagas_db' on server ''.
2022-08-05 21:39:12.716 +04:00 [DBG] Disposing transaction.
2022-08-05 21:39:12.716 +04:00 [DBG] 'SagasDbContext' disposed.
2022-08-05 21:39:12.717 +04:00 [DBG] RECEIVE "rabbitmq://localhost/buy-items-saga-state" "da210000-5df3-0015-b1e7-08da770968fa" Contracts.IGetItemsResponse BuyItemsSagaState("00:00:00.0487212")
2022-08-05 21:39:12.719 +04:00 [DBG] Declare exchange: name: SMS2104090_ApiGateway_bus_5eooyyn76cybmbd5bdp8qnjirf, type: fanout, auto-delete
2022-08-05 21:39:12.725 +04:00 [DBG] SEND "rabbitmq://localhost:0/SMS2104090_ApiGateway_bus_5eooyyn76cybmbd5bdp8qnjirf?temporary=true" "14400000-5df3-0015-091d-08da7709690d" Contracts.BuyItemsResponse
2022-08-05 21:39:41.645 +04:00 [INF] Entity Framework Core 6.0.3 initialized 'SagasDbContext' using provider 'Npgsql.EntityFrameworkCore.PostgreSQL:6.0.3+94d0a8eaeb9cf5af6ce55a9e59153c1a1be3244f' with options: None
2022-08-05 21:39:41.648 +04:00 [DBG] Opening connection to database 'sagas_db' on server ''.
2022-08-05 21:39:41.649 +04:00 [DBG] Opened connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:39:41.650 +04:00 [DBG] Beginning transaction with isolation level 'Serializable'.
2022-08-05 21:39:41.651 +04:00 [DBG] Began transaction with isolation level 'Serializable'.
2022-08-05 21:39:41.653 +04:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2022-08-05 21:39:41.654 +04:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2022-08-05 21:39:41.655 +04:00 [DBG] Executing DbCommand [Parameters=[p0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT b."CorrelationId", b."CurrentState", b."RequestId", b."ResponseAddress"
FROM (
    SELECT * FROM "public"."BuyItemsSagaState" WHERE "CorrelationId" = @p0 FOR UPDATE
) AS b
LIMIT 2
2022-08-05 21:39:41.666 +04:00 [INF] Executed DbCommand (11ms) [Parameters=[p0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT b."CorrelationId", b."CurrentState", b."RequestId", b."ResponseAddress"
FROM (
    SELECT * FROM "public"."BuyItemsSagaState" WHERE "CorrelationId" = @p0 FOR UPDATE
) AS b
LIMIT 2
2022-08-05 21:39:41.669 +04:00 [DBG] Context 'SagasDbContext' started tracking 'BuyItemsSagaState' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2022-08-05 21:39:41.670 +04:00 [DBG] A data reader was disposed.
2022-08-05 21:39:41.671 +04:00 [DBG] SAGA:BuyItemsSagaState:"3fa85f64-5717-4562-b3fc-2c963f66afa6" Used MassTransit.Contracts.RequestTimeoutExpired<Contracts.IGetMoneyRequest>
2022-08-05 21:39:41.676 +04:00 [DBG] Rolling back transaction.
2022-08-05 21:39:41.680 +04:00 [DBG] Rolled back transaction.
2022-08-05 21:39:41.681 +04:00 [DBG] Closing connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:39:41.682 +04:00 [DBG] Closed connection to database 'sagas_db' on server ''.
2022-08-05 21:39:41.684 +04:00 [DBG] Disposing transaction.
2022-08-05 21:39:41.686 +04:00 [DBG] 'SagasDbContext' disposed.
2022-08-05 21:39:41.689 +04:00 [WRN] R-RETRY "rabbitmq://localhost/buy-items-saga-state" "14400000-5df3-0015-15b0-08da7709686f" MassTransit.RetryPolicies.RetryConsumeContext<MassTransit.Contracts.RequestTimeoutExpired<Contracts.IGetMoneyRequest>>
MassTransit.NotAcceptedStateMachineException: BuyItemsSagaState(3fa85f64-5717-4562-b3fc-2c963f66afa6) Saga exception on receipt of MassTransit.Contracts.RequestTimeoutExpired<Contracts.IGetMoneyRequest>: Not accepted in state Final
 ---> MassTransit.UnhandledEventException: The GetMoney.TimeoutExpired event is not handled during the Final state for the BuyItemsSaga state machine
   at MassTransit.MassTransitStateMachine`1.DefaultUnhandledEventCallback(UnhandledEventContext`1 context) in /_/src/MassTransit/SagaStateMachine/MassTransitStateMachine.cs:line 221
   at MassTransit.MassTransitStateMachine`1.UnhandledEvent(BehaviorContext`1 context, State state) in /_/src/MassTransit/SagaStateMachine/MassTransitStateMachine.cs:line 1288
   at MassTransit.MassTransitStateMachine`1.<.ctor>b__14_2(BehaviorContext`1 context, State state) in /_/src/MassTransit/SagaStateMachine/MassTransitStateMachine.cs:line 54
   at MassTransit.SagaStateMachine.StateMachineState`1.MassTransit.State<TSaga>.Raise[T](BehaviorContext`2 context) in /_/src/MassTransit/SagaStateMachine/SagaStateMachine/StateMachineState.cs:line 162
   at MassTransit.MassTransitStateMachine`1.MassTransit.StateMachine<TInstance>.RaiseEvent[T](BehaviorContext`2 context) in /_/src/MassTransit/SagaStateMachine/MassTransitStateMachine.cs:line 134
   at MassTransit.Middleware.StateMachineSagaMessageFilter`2.Send(SagaConsumeContext`2 context, IPipe`1 next) in /_/src/MassTransit/Middleware/StateMachineSagaMessageFilter.cs:line 60
   --- End of inner exception stack trace ---
   at MassTransit.Middleware.StateMachineSagaMessageFilter`2.Send(SagaConsumeContext`2 context, IPipe`1 next) in /_/src/MassTransit/Middleware/StateMachineSagaMessageFilter.cs:line 69
   at MassTransit.Middleware.StateMachineSagaMessageFilter`2.Send(SagaConsumeContext`2 context, IPipe`1 next) in /_/src/MassTransit/Middleware/StateMachineSagaMessageFilter.cs:line 74
   at MassTransit.Middleware.SendSagaPipe`2.Send(SagaRepositoryContext`2 context) in /_/src/MassTransit/Middleware/SendSagaPipe.cs:line 43
   at MassTransit.Middleware.SendSagaPipe`2.Send(SagaRepositoryContext`2 context) in /_/src/MassTransit/Middleware/SendSagaPipe.cs:line 67
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.<>c__DisplayClass5_0`1.<<Send>b__1>d.MoveNext() in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 56
--- End of stack trace from previous location ---
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.<>c__DisplayClass8_0.<<WithinTransaction>g__Create|0>d.MoveNext() in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 139
--- End of stack trace from previous location ---
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.WithinTransaction[T](DbContext context, CancellationToken cancellationToken, Func`1 callback) in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 164
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.WithinTransaction[T](DbContext context, CancellationToken cancellationToken, Func`1 callback) in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 183
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.WithinTransaction[T](DbContext context, CancellationToken cancellationToken, Func`1 callback) in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 183
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.Send[T](ConsumeContext`1 context, IPipe`1 next) in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 64
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.Send[T](ConsumeContext`1 context, IPipe`1 next) in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 68
   at MassTransit.DependencyInjection.DependencyInjectionSagaRepositoryContextFactory`1.<>c__DisplayClass6_0`1.<<Send>g__CreateScope|0>d.MoveNext() in /_/src/MassTransit/DependencyInjection/DependencyInjection/DependencyInjectionSagaRepositoryContextFactory.cs:line 84
--- End of stack trace from previous location ---
   at MassTransit.DependencyInjection.DependencyInjectionSagaRepositoryContextFactory`1.<>c__DisplayClass6_0`1.<<Send>g__CreateScope|0>d.MoveNext() in /_/src/MassTransit/DependencyInjection/DependencyInjection/DependencyInjectionSagaRepositoryContextFactory.cs:line 91
--- End of stack trace from previous location ---
   at MassTransit.Middleware.CorrelatedSagaFilter`2.MassTransit.IFilter<MassTransit.ConsumeContext<TMessage>>.Send(ConsumeContext`1 context, IPipe`1 next) in /_/src/MassTransit/Middleware/CorrelatedSagaFilter.cs:line 46
   at MassTransit.Middleware.CorrelatedSagaFilter`2.MassTransit.IFilter<MassTransit.ConsumeContext<TMessage>>.Send(ConsumeContext`1 context, IPipe`1 next) in /_/src/MassTransit/Middleware/CorrelatedSagaFilter.cs:line 64
   at MassTransit.Middleware.RetryFilter`1.MassTransit.IFilter<TContext>.Send(TContext context, IPipe`1 next) in /_/src/MassTransit/Middleware/RetryFilter.cs:line 47
2022-08-05 21:39:42.372 +04:00 [INF] Entity Framework Core 6.0.3 initialized 'SagasDbContext' using provider 'Npgsql.EntityFrameworkCore.PostgreSQL:6.0.3+94d0a8eaeb9cf5af6ce55a9e59153c1a1be3244f' with options: None
2022-08-05 21:39:42.376 +04:00 [DBG] Opening connection to database 'sagas_db' on server ''.
2022-08-05 21:39:42.377 +04:00 [DBG] Opened connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:39:42.378 +04:00 [DBG] Beginning transaction with isolation level 'Serializable'.
2022-08-05 21:39:42.379 +04:00 [DBG] Began transaction with isolation level 'Serializable'.
2022-08-05 21:39:42.380 +04:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2022-08-05 21:39:42.381 +04:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2022-08-05 21:39:42.382 +04:00 [DBG] Executing DbCommand [Parameters=[p0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT b."CorrelationId", b."CurrentState", b."RequestId", b."ResponseAddress"
FROM (
    SELECT * FROM "public"."BuyItemsSagaState" WHERE "CorrelationId" = @p0 FOR UPDATE
) AS b
LIMIT 2
2022-08-05 21:39:42.384 +04:00 [INF] Executed DbCommand (2ms) [Parameters=[p0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT b."CorrelationId", b."CurrentState", b."RequestId", b."ResponseAddress"
FROM (
    SELECT * FROM "public"."BuyItemsSagaState" WHERE "CorrelationId" = @p0 FOR UPDATE
) AS b
LIMIT 2
2022-08-05 21:39:42.386 +04:00 [DBG] Context 'SagasDbContext' started tracking 'BuyItemsSagaState' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2022-08-05 21:39:42.387 +04:00 [DBG] A data reader was disposed.
2022-08-05 21:39:42.388 +04:00 [DBG] SAGA:BuyItemsSagaState:"3fa85f64-5717-4562-b3fc-2c963f66afa6" Used MassTransit.Contracts.RequestTimeoutExpired<Contracts.IGetItemsRequest>
2022-08-05 21:39:42.389 +04:00 [DBG] Rolling back transaction.
2022-08-05 21:39:42.390 +04:00 [DBG] Rolled back transaction.
2022-08-05 21:39:42.391 +04:00 [DBG] Closing connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:39:42.391 +04:00 [DBG] Closed connection to database 'sagas_db' on server ''.
2022-08-05 21:39:42.392 +04:00 [DBG] Disposing transaction.
2022-08-05 21:39:42.393 +04:00 [DBG] 'SagasDbContext' disposed.
2022-08-05 21:39:42.394 +04:00 [WRN] R-RETRY "rabbitmq://localhost/buy-items-saga-state" "14400000-5df3-0015-1c49-08da770968d7" MassTransit.RetryPolicies.RetryConsumeContext<MassTransit.Contracts.RequestTimeoutExpired<Contracts.IGetItemsRequest>>
MassTransit.NotAcceptedStateMachineException: BuyItemsSagaState(3fa85f64-5717-4562-b3fc-2c963f66afa6) Saga exception on receipt of MassTransit.Contracts.RequestTimeoutExpired<Contracts.IGetItemsRequest>: Not accepted in state Final
 ---> MassTransit.UnhandledEventException: The GetItems.TimeoutExpired event is not handled during the Final state for the BuyItemsSaga state machine
   at MassTransit.MassTransitStateMachine`1.DefaultUnhandledEventCallback(UnhandledEventContext`1 context) in /_/src/MassTransit/SagaStateMachine/MassTransitStateMachine.cs:line 221
   at MassTransit.MassTransitStateMachine`1.UnhandledEvent(BehaviorContext`1 context, State state) in /_/src/MassTransit/SagaStateMachine/MassTransitStateMachine.cs:line 1288
   at MassTransit.MassTransitStateMachine`1.<.ctor>b__14_2(BehaviorContext`1 context, State state) in /_/src/MassTransit/SagaStateMachine/MassTransitStateMachine.cs:line 54
   at MassTransit.SagaStateMachine.StateMachineState`1.MassTransit.State<TSaga>.Raise[T](BehaviorContext`2 context) in /_/src/MassTransit/SagaStateMachine/SagaStateMachine/StateMachineState.cs:line 162
   at MassTransit.MassTransitStateMachine`1.MassTransit.StateMachine<TInstance>.RaiseEvent[T](BehaviorContext`2 context) in /_/src/MassTransit/SagaStateMachine/MassTransitStateMachine.cs:line 134
   at MassTransit.Middleware.StateMachineSagaMessageFilter`2.Send(SagaConsumeContext`2 context, IPipe`1 next) in /_/src/MassTransit/Middleware/StateMachineSagaMessageFilter.cs:line 60
   --- End of inner exception stack trace ---
   at MassTransit.Middleware.StateMachineSagaMessageFilter`2.Send(SagaConsumeContext`2 context, IPipe`1 next) in /_/src/MassTransit/Middleware/StateMachineSagaMessageFilter.cs:line 69
   at MassTransit.Middleware.StateMachineSagaMessageFilter`2.Send(SagaConsumeContext`2 context, IPipe`1 next) in /_/src/MassTransit/Middleware/StateMachineSagaMessageFilter.cs:line 74
   at MassTransit.Middleware.SendSagaPipe`2.Send(SagaRepositoryContext`2 context) in /_/src/MassTransit/Middleware/SendSagaPipe.cs:line 43
   at MassTransit.Middleware.SendSagaPipe`2.Send(SagaRepositoryContext`2 context) in /_/src/MassTransit/Middleware/SendSagaPipe.cs:line 67
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.<>c__DisplayClass5_0`1.<<Send>b__1>d.MoveNext() in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 56
--- End of stack trace from previous location ---
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.<>c__DisplayClass8_0.<<WithinTransaction>g__Create|0>d.MoveNext() in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 139
--- End of stack trace from previous location ---
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.WithinTransaction[T](DbContext context, CancellationToken cancellationToken, Func`1 callback) in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 164
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.WithinTransaction[T](DbContext context, CancellationToken cancellationToken, Func`1 callback) in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 183
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.WithinTransaction[T](DbContext context, CancellationToken cancellationToken, Func`1 callback) in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 183
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.Send[T](ConsumeContext`1 context, IPipe`1 next) in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 64
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.Send[T](ConsumeContext`1 context, IPipe`1 next) in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 68
   at MassTransit.DependencyInjection.DependencyInjectionSagaRepositoryContextFactory`1.<>c__DisplayClass6_0`1.<<Send>g__CreateScope|0>d.MoveNext() in /_/src/MassTransit/DependencyInjection/DependencyInjection/DependencyInjectionSagaRepositoryContextFactory.cs:line 84
--- End of stack trace from previous location ---
   at MassTransit.DependencyInjection.DependencyInjectionSagaRepositoryContextFactory`1.<>c__DisplayClass6_0`1.<<Send>g__CreateScope|0>d.MoveNext() in /_/src/MassTransit/DependencyInjection/DependencyInjection/DependencyInjectionSagaRepositoryContextFactory.cs:line 91
--- End of stack trace from previous location ---
   at MassTransit.Middleware.CorrelatedSagaFilter`2.MassTransit.IFilter<MassTransit.ConsumeContext<TMessage>>.Send(ConsumeContext`1 context, IPipe`1 next) in /_/src/MassTransit/Middleware/CorrelatedSagaFilter.cs:line 46
   at MassTransit.Middleware.CorrelatedSagaFilter`2.MassTransit.IFilter<MassTransit.ConsumeContext<TMessage>>.Send(ConsumeContext`1 context, IPipe`1 next) in /_/src/MassTransit/Middleware/CorrelatedSagaFilter.cs:line 64
   at MassTransit.Middleware.RetryFilter`1.MassTransit.IFilter<TContext>.Send(TContext context, IPipe`1 next) in /_/src/MassTransit/Middleware/RetryFilter.cs:line 47
2022-08-05 21:39:42.751 +04:00 [INF] Entity Framework Core 6.0.3 initialized 'SagasDbContext' using provider 'Npgsql.EntityFrameworkCore.PostgreSQL:6.0.3+94d0a8eaeb9cf5af6ce55a9e59153c1a1be3244f' with options: None
2022-08-05 21:39:42.756 +04:00 [DBG] Opening connection to database 'sagas_db' on server ''.
2022-08-05 21:39:42.758 +04:00 [DBG] Opened connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:39:42.759 +04:00 [DBG] Beginning transaction with isolation level 'Serializable'.
2022-08-05 21:39:42.759 +04:00 [DBG] Began transaction with isolation level 'Serializable'.
2022-08-05 21:39:42.760 +04:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2022-08-05 21:39:42.761 +04:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2022-08-05 21:39:42.762 +04:00 [DBG] Executing DbCommand [Parameters=[p0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT b."CorrelationId", b."CurrentState", b."RequestId", b."ResponseAddress"
FROM (
    SELECT * FROM "public"."BuyItemsSagaState" WHERE "CorrelationId" = @p0 FOR UPDATE
) AS b
LIMIT 2
2022-08-05 21:39:42.765 +04:00 [INF] Executed DbCommand (3ms) [Parameters=[p0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT b."CorrelationId", b."CurrentState", b."RequestId", b."ResponseAddress"
FROM (
    SELECT * FROM "public"."BuyItemsSagaState" WHERE "CorrelationId" = @p0 FOR UPDATE
) AS b
LIMIT 2
2022-08-05 21:39:42.766 +04:00 [DBG] Context 'SagasDbContext' started tracking 'BuyItemsSagaState' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2022-08-05 21:39:42.767 +04:00 [DBG] A data reader was disposed.
2022-08-05 21:39:42.768 +04:00 [DBG] SAGA:BuyItemsSagaState:"3fa85f64-5717-4562-b3fc-2c963f66afa6" Used MassTransit.Contracts.RequestTimeoutExpired<Contracts.IGetMoneyRequest>
2022-08-05 21:39:42.770 +04:00 [DBG] Rolling back transaction.
2022-08-05 21:39:42.770 +04:00 [DBG] Rolled back transaction.
2022-08-05 21:39:42.771 +04:00 [DBG] Closing connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:39:42.772 +04:00 [DBG] Closed connection to database 'sagas_db' on server ''.
2022-08-05 21:39:42.773 +04:00 [DBG] Disposing transaction.
2022-08-05 21:39:42.774 +04:00 [DBG] 'SagasDbContext' disposed.
2022-08-05 21:39:43.418 +04:00 [INF] Entity Framework Core 6.0.3 initialized 'SagasDbContext' using provider 'Npgsql.EntityFrameworkCore.PostgreSQL:6.0.3+94d0a8eaeb9cf5af6ce55a9e59153c1a1be3244f' with options: None
2022-08-05 21:39:43.419 +04:00 [DBG] Opening connection to database 'sagas_db' on server ''.
2022-08-05 21:39:43.420 +04:00 [DBG] Opened connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:39:43.421 +04:00 [DBG] Beginning transaction with isolation level 'Serializable'.
2022-08-05 21:39:43.422 +04:00 [DBG] Began transaction with isolation level 'Serializable'.
2022-08-05 21:39:43.423 +04:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2022-08-05 21:39:43.423 +04:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2022-08-05 21:39:43.424 +04:00 [DBG] Executing DbCommand [Parameters=[p0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT b."CorrelationId", b."CurrentState", b."RequestId", b."ResponseAddress"
FROM (
    SELECT * FROM "public"."BuyItemsSagaState" WHERE "CorrelationId" = @p0 FOR UPDATE
) AS b
LIMIT 2
2022-08-05 21:39:43.427 +04:00 [INF] Executed DbCommand (3ms) [Parameters=[p0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT b."CorrelationId", b."CurrentState", b."RequestId", b."ResponseAddress"
FROM (
    SELECT * FROM "public"."BuyItemsSagaState" WHERE "CorrelationId" = @p0 FOR UPDATE
) AS b
LIMIT 2
2022-08-05 21:39:43.430 +04:00 [DBG] Context 'SagasDbContext' started tracking 'BuyItemsSagaState' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2022-08-05 21:39:43.431 +04:00 [DBG] A data reader was disposed.
2022-08-05 21:39:43.432 +04:00 [DBG] SAGA:BuyItemsSagaState:"3fa85f64-5717-4562-b3fc-2c963f66afa6" Used MassTransit.Contracts.RequestTimeoutExpired<Contracts.IGetItemsRequest>
2022-08-05 21:39:43.434 +04:00 [DBG] Rolling back transaction.
2022-08-05 21:39:43.435 +04:00 [DBG] Rolled back transaction.
2022-08-05 21:39:43.436 +04:00 [DBG] Closing connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:39:43.437 +04:00 [DBG] Closed connection to database 'sagas_db' on server ''.
2022-08-05 21:39:43.438 +04:00 [DBG] Disposing transaction.
2022-08-05 21:39:43.439 +04:00 [DBG] 'SagasDbContext' disposed.
2022-08-05 21:39:44.790 +04:00 [INF] Entity Framework Core 6.0.3 initialized 'SagasDbContext' using provider 'Npgsql.EntityFrameworkCore.PostgreSQL:6.0.3+94d0a8eaeb9cf5af6ce55a9e59153c1a1be3244f' with options: None
2022-08-05 21:39:44.793 +04:00 [DBG] Opening connection to database 'sagas_db' on server ''.
2022-08-05 21:39:44.795 +04:00 [DBG] Opened connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:39:44.797 +04:00 [DBG] Beginning transaction with isolation level 'Serializable'.
2022-08-05 21:39:44.797 +04:00 [DBG] Began transaction with isolation level 'Serializable'.
2022-08-05 21:39:44.799 +04:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2022-08-05 21:39:44.799 +04:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2022-08-05 21:39:44.800 +04:00 [DBG] Executing DbCommand [Parameters=[p0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT b."CorrelationId", b."CurrentState", b."RequestId", b."ResponseAddress"
FROM (
    SELECT * FROM "public"."BuyItemsSagaState" WHERE "CorrelationId" = @p0 FOR UPDATE
) AS b
LIMIT 2
2022-08-05 21:39:44.803 +04:00 [INF] Executed DbCommand (2ms) [Parameters=[p0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT b."CorrelationId", b."CurrentState", b."RequestId", b."ResponseAddress"
FROM (
    SELECT * FROM "public"."BuyItemsSagaState" WHERE "CorrelationId" = @p0 FOR UPDATE
) AS b
LIMIT 2
2022-08-05 21:39:44.804 +04:00 [DBG] Context 'SagasDbContext' started tracking 'BuyItemsSagaState' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2022-08-05 21:39:44.806 +04:00 [DBG] A data reader was disposed.
2022-08-05 21:39:44.806 +04:00 [DBG] SAGA:BuyItemsSagaState:"3fa85f64-5717-4562-b3fc-2c963f66afa6" Used MassTransit.Contracts.RequestTimeoutExpired<Contracts.IGetMoneyRequest>
2022-08-05 21:39:44.808 +04:00 [DBG] Rolling back transaction.
2022-08-05 21:39:44.808 +04:00 [DBG] Rolled back transaction.
2022-08-05 21:39:44.809 +04:00 [DBG] Closing connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:39:44.810 +04:00 [DBG] Closed connection to database 'sagas_db' on server ''.
2022-08-05 21:39:44.811 +04:00 [DBG] Disposing transaction.
2022-08-05 21:39:44.811 +04:00 [DBG] 'SagasDbContext' disposed.
2022-08-05 21:39:45.460 +04:00 [INF] Entity Framework Core 6.0.3 initialized 'SagasDbContext' using provider 'Npgsql.EntityFrameworkCore.PostgreSQL:6.0.3+94d0a8eaeb9cf5af6ce55a9e59153c1a1be3244f' with options: None
2022-08-05 21:39:45.463 +04:00 [DBG] Opening connection to database 'sagas_db' on server ''.
2022-08-05 21:39:45.464 +04:00 [DBG] Opened connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:39:45.465 +04:00 [DBG] Beginning transaction with isolation level 'Serializable'.
2022-08-05 21:39:45.466 +04:00 [DBG] Began transaction with isolation level 'Serializable'.
2022-08-05 21:39:45.467 +04:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2022-08-05 21:39:45.468 +04:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2022-08-05 21:39:45.469 +04:00 [DBG] Executing DbCommand [Parameters=[p0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT b."CorrelationId", b."CurrentState", b."RequestId", b."ResponseAddress"
FROM (
    SELECT * FROM "public"."BuyItemsSagaState" WHERE "CorrelationId" = @p0 FOR UPDATE
) AS b
LIMIT 2
2022-08-05 21:39:45.471 +04:00 [INF] Executed DbCommand (2ms) [Parameters=[p0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT b."CorrelationId", b."CurrentState", b."RequestId", b."ResponseAddress"
FROM (
    SELECT * FROM "public"."BuyItemsSagaState" WHERE "CorrelationId" = @p0 FOR UPDATE
) AS b
LIMIT 2
2022-08-05 21:39:45.473 +04:00 [DBG] Context 'SagasDbContext' started tracking 'BuyItemsSagaState' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2022-08-05 21:39:45.474 +04:00 [DBG] A data reader was disposed.
2022-08-05 21:39:45.475 +04:00 [DBG] SAGA:BuyItemsSagaState:"3fa85f64-5717-4562-b3fc-2c963f66afa6" Used MassTransit.Contracts.RequestTimeoutExpired<Contracts.IGetItemsRequest>
2022-08-05 21:39:45.477 +04:00 [DBG] Rolling back transaction.
2022-08-05 21:39:45.478 +04:00 [DBG] Rolled back transaction.
2022-08-05 21:39:45.478 +04:00 [DBG] Closing connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:39:45.479 +04:00 [DBG] Closed connection to database 'sagas_db' on server ''.
2022-08-05 21:39:45.480 +04:00 [DBG] Disposing transaction.
2022-08-05 21:39:45.481 +04:00 [DBG] 'SagasDbContext' disposed.
2022-08-05 21:39:47.822 +04:00 [INF] Entity Framework Core 6.0.3 initialized 'SagasDbContext' using provider 'Npgsql.EntityFrameworkCore.PostgreSQL:6.0.3+94d0a8eaeb9cf5af6ce55a9e59153c1a1be3244f' with options: None
2022-08-05 21:39:47.827 +04:00 [DBG] Opening connection to database 'sagas_db' on server ''.
2022-08-05 21:39:47.828 +04:00 [DBG] Opened connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:39:47.829 +04:00 [DBG] Beginning transaction with isolation level 'Serializable'.
2022-08-05 21:39:47.830 +04:00 [DBG] Began transaction with isolation level 'Serializable'.
2022-08-05 21:39:47.831 +04:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2022-08-05 21:39:47.833 +04:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2022-08-05 21:39:47.834 +04:00 [DBG] Executing DbCommand [Parameters=[p0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT b."CorrelationId", b."CurrentState", b."RequestId", b."ResponseAddress"
FROM (
    SELECT * FROM "public"."BuyItemsSagaState" WHERE "CorrelationId" = @p0 FOR UPDATE
) AS b
LIMIT 2
2022-08-05 21:39:47.838 +04:00 [INF] Executed DbCommand (3ms) [Parameters=[p0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT b."CorrelationId", b."CurrentState", b."RequestId", b."ResponseAddress"
FROM (
    SELECT * FROM "public"."BuyItemsSagaState" WHERE "CorrelationId" = @p0 FOR UPDATE
) AS b
LIMIT 2
2022-08-05 21:39:47.840 +04:00 [DBG] Context 'SagasDbContext' started tracking 'BuyItemsSagaState' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2022-08-05 21:39:47.842 +04:00 [DBG] A data reader was disposed.
2022-08-05 21:39:47.843 +04:00 [DBG] SAGA:BuyItemsSagaState:"3fa85f64-5717-4562-b3fc-2c963f66afa6" Used MassTransit.Contracts.RequestTimeoutExpired<Contracts.IGetMoneyRequest>
2022-08-05 21:39:47.845 +04:00 [DBG] Rolling back transaction.
2022-08-05 21:39:47.846 +04:00 [DBG] Rolled back transaction.
2022-08-05 21:39:47.847 +04:00 [DBG] Closing connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:39:47.849 +04:00 [DBG] Closed connection to database 'sagas_db' on server ''.
2022-08-05 21:39:47.850 +04:00 [DBG] Disposing transaction.
2022-08-05 21:39:47.851 +04:00 [DBG] 'SagasDbContext' disposed.
2022-08-05 21:39:47.890 +04:00 [DBG] Declare exchange: name: MassTransit:Fault--MassTransit.Contracts:RequestTimeoutExpired--Contracts:IGetMoneyRequest----, type: fanout, durable
2022-08-05 21:39:47.891 +04:00 [DBG] Declare exchange: name: MassTransit:Fault, type: fanout, durable
2022-08-05 21:39:47.919 +04:00 [DBG] Bind exchange: source: MassTransit:Fault--MassTransit.Contracts:RequestTimeoutExpired--Contracts:IGetMoneyRequest----, destination: MassTransit:Fault
2022-08-05 21:39:48.013 +04:00 [DBG] SEND "rabbitmq://localhost/MassTransit:Fault--MassTransit.Contracts:RequestTimeoutExpired--Contracts:IGetMoneyRequest----" "14400000-5df3-0015-23f8-08da77097e0c" MassTransit.Fault<MassTransit.Contracts.RequestTimeoutExpired<Contracts.IGetMoneyRequest>>
2022-08-05 21:39:48.018 +04:00 [ERR] R-FAULT "rabbitmq://localhost/buy-items-saga-state" "14400000-5df3-0015-15b0-08da7709686f" MassTransit.Contracts.RequestTimeoutExpired<Contracts.IGetMoneyRequest> BuyItemsSagaState("00:00:00.0304936")
MassTransit.NotAcceptedStateMachineException: BuyItemsSagaState(3fa85f64-5717-4562-b3fc-2c963f66afa6) Saga exception on receipt of MassTransit.Contracts.RequestTimeoutExpired<Contracts.IGetMoneyRequest>: Not accepted in state Final
 ---> MassTransit.UnhandledEventException: The GetMoney.TimeoutExpired event is not handled during the Final state for the BuyItemsSaga state machine
   at MassTransit.MassTransitStateMachine`1.DefaultUnhandledEventCallback(UnhandledEventContext`1 context) in /_/src/MassTransit/SagaStateMachine/MassTransitStateMachine.cs:line 221
   at MassTransit.MassTransitStateMachine`1.UnhandledEvent(BehaviorContext`1 context, State state) in /_/src/MassTransit/SagaStateMachine/MassTransitStateMachine.cs:line 1288
   at MassTransit.MassTransitStateMachine`1.<.ctor>b__14_2(BehaviorContext`1 context, State state) in /_/src/MassTransit/SagaStateMachine/MassTransitStateMachine.cs:line 54
   at MassTransit.SagaStateMachine.StateMachineState`1.MassTransit.State<TSaga>.Raise[T](BehaviorContext`2 context) in /_/src/MassTransit/SagaStateMachine/SagaStateMachine/StateMachineState.cs:line 162
   at MassTransit.MassTransitStateMachine`1.MassTransit.StateMachine<TInstance>.RaiseEvent[T](BehaviorContext`2 context) in /_/src/MassTransit/SagaStateMachine/MassTransitStateMachine.cs:line 134
   at MassTransit.Middleware.StateMachineSagaMessageFilter`2.Send(SagaConsumeContext`2 context, IPipe`1 next) in /_/src/MassTransit/Middleware/StateMachineSagaMessageFilter.cs:line 60
   --- End of inner exception stack trace ---
   at MassTransit.Middleware.StateMachineSagaMessageFilter`2.Send(SagaConsumeContext`2 context, IPipe`1 next) in /_/src/MassTransit/Middleware/StateMachineSagaMessageFilter.cs:line 69
   at MassTransit.Middleware.StateMachineSagaMessageFilter`2.Send(SagaConsumeContext`2 context, IPipe`1 next) in /_/src/MassTransit/Middleware/StateMachineSagaMessageFilter.cs:line 74
   at MassTransit.Middleware.SendSagaPipe`2.Send(SagaRepositoryContext`2 context) in /_/src/MassTransit/Middleware/SendSagaPipe.cs:line 43
   at MassTransit.Middleware.SendSagaPipe`2.Send(SagaRepositoryContext`2 context) in /_/src/MassTransit/Middleware/SendSagaPipe.cs:line 67
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.<>c__DisplayClass5_0`1.<<Send>b__1>d.MoveNext() in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 56
--- End of stack trace from previous location ---
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.<>c__DisplayClass8_0.<<WithinTransaction>g__Create|0>d.MoveNext() in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 139
--- End of stack trace from previous location ---
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.WithinTransaction[T](DbContext context, CancellationToken cancellationToken, Func`1 callback) in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 164
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.WithinTransaction[T](DbContext context, CancellationToken cancellationToken, Func`1 callback) in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 183
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.WithinTransaction[T](DbContext context, CancellationToken cancellationToken, Func`1 callback) in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 183
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.Send[T](ConsumeContext`1 context, IPipe`1 next) in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 64
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.Send[T](ConsumeContext`1 context, IPipe`1 next) in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 68
   at MassTransit.DependencyInjection.DependencyInjectionSagaRepositoryContextFactory`1.<>c__DisplayClass6_0`1.<<Send>g__CreateScope|0>d.MoveNext() in /_/src/MassTransit/DependencyInjection/DependencyInjection/DependencyInjectionSagaRepositoryContextFactory.cs:line 84
--- End of stack trace from previous location ---
   at MassTransit.DependencyInjection.DependencyInjectionSagaRepositoryContextFactory`1.<>c__DisplayClass6_0`1.<<Send>g__CreateScope|0>d.MoveNext() in /_/src/MassTransit/DependencyInjection/DependencyInjection/DependencyInjectionSagaRepositoryContextFactory.cs:line 91
--- End of stack trace from previous location ---
   at MassTransit.Middleware.CorrelatedSagaFilter`2.MassTransit.IFilter<MassTransit.ConsumeContext<TMessage>>.Send(ConsumeContext`1 context, IPipe`1 next) in /_/src/MassTransit/Middleware/CorrelatedSagaFilter.cs:line 46
   at MassTransit.Middleware.CorrelatedSagaFilter`2.MassTransit.IFilter<MassTransit.ConsumeContext<TMessage>>.Send(ConsumeContext`1 context, IPipe`1 next) in /_/src/MassTransit/Middleware/CorrelatedSagaFilter.cs:line 64
   at MassTransit.Middleware.RetryFilter`1.Attempt(TContext context, RetryContext`1 retryContext, IPipe`1 next) in /_/src/MassTransit/Middleware/RetryFilter.cs:line 158
2022-08-05 21:39:48.062 +04:00 [DBG] Declare queue: name: buy-items-saga-state_error, durable, consumer-count: 0 message-count: 0
2022-08-05 21:39:48.087 +04:00 [DBG] Declare exchange: name: buy-items-saga-state_error, type: fanout, durable
2022-08-05 21:39:48.097 +04:00 [DBG] Bind queue: source: buy-items-saga-state_error, destination: buy-items-saga-state_error
2022-08-05 21:39:48.496 +04:00 [INF] Entity Framework Core 6.0.3 initialized 'SagasDbContext' using provider 'Npgsql.EntityFrameworkCore.PostgreSQL:6.0.3+94d0a8eaeb9cf5af6ce55a9e59153c1a1be3244f' with options: None
2022-08-05 21:39:48.499 +04:00 [DBG] Opening connection to database 'sagas_db' on server ''.
2022-08-05 21:39:48.503 +04:00 [DBG] Opened connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:39:48.505 +04:00 [DBG] Beginning transaction with isolation level 'Serializable'.
2022-08-05 21:39:48.506 +04:00 [DBG] Began transaction with isolation level 'Serializable'.
2022-08-05 21:39:48.508 +04:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2022-08-05 21:39:48.510 +04:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2022-08-05 21:39:48.512 +04:00 [DBG] Executing DbCommand [Parameters=[p0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT b."CorrelationId", b."CurrentState", b."RequestId", b."ResponseAddress"
FROM (
    SELECT * FROM "public"."BuyItemsSagaState" WHERE "CorrelationId" = @p0 FOR UPDATE
) AS b
LIMIT 2
2022-08-05 21:39:48.517 +04:00 [INF] Executed DbCommand (5ms) [Parameters=[p0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT b."CorrelationId", b."CurrentState", b."RequestId", b."ResponseAddress"
FROM (
    SELECT * FROM "public"."BuyItemsSagaState" WHERE "CorrelationId" = @p0 FOR UPDATE
) AS b
LIMIT 2
2022-08-05 21:39:48.520 +04:00 [DBG] Context 'SagasDbContext' started tracking 'BuyItemsSagaState' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2022-08-05 21:39:48.522 +04:00 [DBG] A data reader was disposed.
2022-08-05 21:39:48.524 +04:00 [DBG] SAGA:BuyItemsSagaState:"3fa85f64-5717-4562-b3fc-2c963f66afa6" Used MassTransit.Contracts.RequestTimeoutExpired<Contracts.IGetItemsRequest>
2022-08-05 21:39:48.526 +04:00 [DBG] Rolling back transaction.
2022-08-05 21:39:48.528 +04:00 [DBG] Rolled back transaction.
2022-08-05 21:39:48.529 +04:00 [DBG] Closing connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:39:48.531 +04:00 [DBG] Closed connection to database 'sagas_db' on server ''.
2022-08-05 21:39:48.532 +04:00 [DBG] Disposing transaction.
2022-08-05 21:39:48.534 +04:00 [DBG] 'SagasDbContext' disposed.
2022-08-05 21:39:48.542 +04:00 [DBG] Declare exchange: name: MassTransit:Fault--MassTransit.Contracts:RequestTimeoutExpired--Contracts:IGetItemsRequest----, type: fanout, durable
2022-08-05 21:39:48.544 +04:00 [DBG] Declare exchange: name: MassTransit:Fault, type: fanout, durable
2022-08-05 21:39:48.554 +04:00 [DBG] Bind exchange: source: MassTransit:Fault--MassTransit.Contracts:RequestTimeoutExpired--Contracts:IGetItemsRequest----, destination: MassTransit:Fault
2022-08-05 21:39:48.643 +04:00 [DBG] SEND "rabbitmq://localhost/MassTransit:Fault--MassTransit.Contracts:RequestTimeoutExpired--Contracts:IGetItemsRequest----" "14400000-5df3-0015-4acd-08da77097e6e" MassTransit.Fault<MassTransit.Contracts.RequestTimeoutExpired<Contracts.IGetItemsRequest>>
2022-08-05 21:39:48.647 +04:00 [ERR] R-FAULT "rabbitmq://localhost/buy-items-saga-state" "14400000-5df3-0015-1c49-08da770968d7" MassTransit.Contracts.RequestTimeoutExpired<Contracts.IGetItemsRequest> BuyItemsSagaState("00:00:00.0399550")
MassTransit.NotAcceptedStateMachineException: BuyItemsSagaState(3fa85f64-5717-4562-b3fc-2c963f66afa6) Saga exception on receipt of MassTransit.Contracts.RequestTimeoutExpired<Contracts.IGetItemsRequest>: Not accepted in state Final
 ---> MassTransit.UnhandledEventException: The GetItems.TimeoutExpired event is not handled during the Final state for the BuyItemsSaga state machine
   at MassTransit.MassTransitStateMachine`1.DefaultUnhandledEventCallback(UnhandledEventContext`1 context) in /_/src/MassTransit/SagaStateMachine/MassTransitStateMachine.cs:line 221
   at MassTransit.MassTransitStateMachine`1.UnhandledEvent(BehaviorContext`1 context, State state) in /_/src/MassTransit/SagaStateMachine/MassTransitStateMachine.cs:line 1288
   at MassTransit.MassTransitStateMachine`1.<.ctor>b__14_2(BehaviorContext`1 context, State state) in /_/src/MassTransit/SagaStateMachine/MassTransitStateMachine.cs:line 54
   at MassTransit.SagaStateMachine.StateMachineState`1.MassTransit.State<TSaga>.Raise[T](BehaviorContext`2 context) in /_/src/MassTransit/SagaStateMachine/SagaStateMachine/StateMachineState.cs:line 162
   at MassTransit.MassTransitStateMachine`1.MassTransit.StateMachine<TInstance>.RaiseEvent[T](BehaviorContext`2 context) in /_/src/MassTransit/SagaStateMachine/MassTransitStateMachine.cs:line 134
   at MassTransit.Middleware.StateMachineSagaMessageFilter`2.Send(SagaConsumeContext`2 context, IPipe`1 next) in /_/src/MassTransit/Middleware/StateMachineSagaMessageFilter.cs:line 60
   --- End of inner exception stack trace ---
   at MassTransit.Middleware.StateMachineSagaMessageFilter`2.Send(SagaConsumeContext`2 context, IPipe`1 next) in /_/src/MassTransit/Middleware/StateMachineSagaMessageFilter.cs:line 69
   at MassTransit.Middleware.StateMachineSagaMessageFilter`2.Send(SagaConsumeContext`2 context, IPipe`1 next) in /_/src/MassTransit/Middleware/StateMachineSagaMessageFilter.cs:line 74
   at MassTransit.Middleware.SendSagaPipe`2.Send(SagaRepositoryContext`2 context) in /_/src/MassTransit/Middleware/SendSagaPipe.cs:line 43
   at MassTransit.Middleware.SendSagaPipe`2.Send(SagaRepositoryContext`2 context) in /_/src/MassTransit/Middleware/SendSagaPipe.cs:line 67
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.<>c__DisplayClass5_0`1.<<Send>b__1>d.MoveNext() in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 56
--- End of stack trace from previous location ---
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.<>c__DisplayClass8_0.<<WithinTransaction>g__Create|0>d.MoveNext() in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 139
--- End of stack trace from previous location ---
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.WithinTransaction[T](DbContext context, CancellationToken cancellationToken, Func`1 callback) in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 164
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.WithinTransaction[T](DbContext context, CancellationToken cancellationToken, Func`1 callback) in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 183
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.WithinTransaction[T](DbContext context, CancellationToken cancellationToken, Func`1 callback) in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 183
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.Send[T](ConsumeContext`1 context, IPipe`1 next) in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 64
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.Send[T](ConsumeContext`1 context, IPipe`1 next) in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 68
   at MassTransit.DependencyInjection.DependencyInjectionSagaRepositoryContextFactory`1.<>c__DisplayClass6_0`1.<<Send>g__CreateScope|0>d.MoveNext() in /_/src/MassTransit/DependencyInjection/DependencyInjection/DependencyInjectionSagaRepositoryContextFactory.cs:line 84
--- End of stack trace from previous location ---
   at MassTransit.DependencyInjection.DependencyInjectionSagaRepositoryContextFactory`1.<>c__DisplayClass6_0`1.<<Send>g__CreateScope|0>d.MoveNext() in /_/src/MassTransit/DependencyInjection/DependencyInjection/DependencyInjectionSagaRepositoryContextFactory.cs:line 91
--- End of stack trace from previous location ---
   at MassTransit.Middleware.CorrelatedSagaFilter`2.MassTransit.IFilter<MassTransit.ConsumeContext<TMessage>>.Send(ConsumeContext`1 context, IPipe`1 next) in /_/src/MassTransit/Middleware/CorrelatedSagaFilter.cs:line 46
   at MassTransit.Middleware.CorrelatedSagaFilter`2.MassTransit.IFilter<MassTransit.ConsumeContext<TMessage>>.Send(ConsumeContext`1 context, IPipe`1 next) in /_/src/MassTransit/Middleware/CorrelatedSagaFilter.cs:line 64
   at MassTransit.Middleware.RetryFilter`1.Attempt(TContext context, RetryContext`1 retryContext, IPipe`1 next) in /_/src/MassTransit/Middleware/RetryFilter.cs:line 158
2022-08-05 21:40:26.063 +04:00 [INF] Entity Framework Core 6.0.3 initialized 'SagasDbContext' using provider 'Npgsql.EntityFrameworkCore.PostgreSQL:6.0.3+94d0a8eaeb9cf5af6ce55a9e59153c1a1be3244f' with options: None
2022-08-05 21:40:26.065 +04:00 [DBG] Opening connection to database 'sagas_db' on server ''.
2022-08-05 21:40:26.067 +04:00 [DBG] Opened connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:40:26.068 +04:00 [DBG] Beginning transaction with isolation level 'Serializable'.
2022-08-05 21:40:26.069 +04:00 [DBG] Began transaction with isolation level 'Serializable'.
2022-08-05 21:40:26.070 +04:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2022-08-05 21:40:26.071 +04:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2022-08-05 21:40:26.072 +04:00 [DBG] Executing DbCommand [Parameters=[p0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT b."CorrelationId", b."CurrentState", b."RequestId", b."ResponseAddress"
FROM (
    SELECT * FROM "public"."BuyItemsSagaState" WHERE "CorrelationId" = @p0 FOR UPDATE
) AS b
LIMIT 2
2022-08-05 21:40:26.074 +04:00 [INF] Executed DbCommand (2ms) [Parameters=[p0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT b."CorrelationId", b."CurrentState", b."RequestId", b."ResponseAddress"
FROM (
    SELECT * FROM "public"."BuyItemsSagaState" WHERE "CorrelationId" = @p0 FOR UPDATE
) AS b
LIMIT 2
2022-08-05 21:40:26.076 +04:00 [DBG] Context 'SagasDbContext' started tracking 'BuyItemsSagaState' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2022-08-05 21:40:26.077 +04:00 [DBG] A data reader was disposed.
2022-08-05 21:40:26.078 +04:00 [DBG] SAGA:BuyItemsSagaState:"3fa85f64-5717-4562-b3fc-2c963f66afa6" Used Contracts.BuyItemsRequest
2022-08-05 21:40:26.079 +04:00 [DBG] Rolling back transaction.
2022-08-05 21:40:26.080 +04:00 [DBG] Rolled back transaction.
2022-08-05 21:40:26.080 +04:00 [DBG] Closing connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:40:26.081 +04:00 [DBG] Closed connection to database 'sagas_db' on server ''.
2022-08-05 21:40:26.083 +04:00 [DBG] Disposing transaction.
2022-08-05 21:40:26.083 +04:00 [DBG] 'SagasDbContext' disposed.
2022-08-05 21:40:26.085 +04:00 [WRN] R-RETRY "rabbitmq://localhost/buy-items-saga-state" "da210000-5df3-0015-897d-08da770994c0" MassTransit.RetryPolicies.RetryConsumeContext<Contracts.BuyItemsRequest>
MassTransit.NotAcceptedStateMachineException: BuyItemsSagaState(3fa85f64-5717-4562-b3fc-2c963f66afa6) Saga exception on receipt of Contracts.BuyItemsRequest: Not accepted in state Final
 ---> MassTransit.UnhandledEventException: The BuyItems event is not handled during the Final state for the BuyItemsSaga state machine
   at MassTransit.MassTransitStateMachine`1.DefaultUnhandledEventCallback(UnhandledEventContext`1 context) in /_/src/MassTransit/SagaStateMachine/MassTransitStateMachine.cs:line 221
   at MassTransit.MassTransitStateMachine`1.UnhandledEvent(BehaviorContext`1 context, State state) in /_/src/MassTransit/SagaStateMachine/MassTransitStateMachine.cs:line 1288
   at MassTransit.MassTransitStateMachine`1.<.ctor>b__14_2(BehaviorContext`1 context, State state) in /_/src/MassTransit/SagaStateMachine/MassTransitStateMachine.cs:line 54
   at MassTransit.SagaStateMachine.StateMachineState`1.MassTransit.State<TSaga>.Raise[T](BehaviorContext`2 context) in /_/src/MassTransit/SagaStateMachine/SagaStateMachine/StateMachineState.cs:line 162
   at MassTransit.MassTransitStateMachine`1.MassTransit.StateMachine<TInstance>.RaiseEvent[T](BehaviorContext`2 context) in /_/src/MassTransit/SagaStateMachine/MassTransitStateMachine.cs:line 134
   at MassTransit.Middleware.StateMachineSagaMessageFilter`2.Send(SagaConsumeContext`2 context, IPipe`1 next) in /_/src/MassTransit/Middleware/StateMachineSagaMessageFilter.cs:line 60
   --- End of inner exception stack trace ---
   at MassTransit.Middleware.StateMachineSagaMessageFilter`2.Send(SagaConsumeContext`2 context, IPipe`1 next) in /_/src/MassTransit/Middleware/StateMachineSagaMessageFilter.cs:line 69
   at MassTransit.Middleware.StateMachineSagaMessageFilter`2.Send(SagaConsumeContext`2 context, IPipe`1 next) in /_/src/MassTransit/Middleware/StateMachineSagaMessageFilter.cs:line 74
   at MassTransit.Middleware.SendSagaPipe`2.Send(SagaRepositoryContext`2 context) in /_/src/MassTransit/Middleware/SendSagaPipe.cs:line 43
   at MassTransit.Middleware.SendSagaPipe`2.Send(SagaRepositoryContext`2 context) in /_/src/MassTransit/Middleware/SendSagaPipe.cs:line 67
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.<>c__DisplayClass5_0`1.<<Send>b__1>d.MoveNext() in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 56
--- End of stack trace from previous location ---
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.<>c__DisplayClass8_0.<<WithinTransaction>g__Create|0>d.MoveNext() in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 139
--- End of stack trace from previous location ---
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.WithinTransaction[T](DbContext context, CancellationToken cancellationToken, Func`1 callback) in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 185
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.WithinTransaction[T](DbContext context, CancellationToken cancellationToken, Func`1 callback) in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 185
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.WithinTransaction[T](DbContext context, CancellationToken cancellationToken, Func`1 callback) in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 185
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.Send[T](ConsumeContext`1 context, IPipe`1 next) in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 64
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.Send[T](ConsumeContext`1 context, IPipe`1 next) in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 68
   at MassTransit.DependencyInjection.DependencyInjectionSagaRepositoryContextFactory`1.<>c__DisplayClass6_0`1.<<Send>g__CreateScope|0>d.MoveNext() in /_/src/MassTransit/DependencyInjection/DependencyInjection/DependencyInjectionSagaRepositoryContextFactory.cs:line 84
--- End of stack trace from previous location ---
   at MassTransit.DependencyInjection.DependencyInjectionSagaRepositoryContextFactory`1.<>c__DisplayClass6_0`1.<<Send>g__CreateScope|0>d.MoveNext() in /_/src/MassTransit/DependencyInjection/DependencyInjection/DependencyInjectionSagaRepositoryContextFactory.cs:line 91
--- End of stack trace from previous location ---
   at MassTransit.Middleware.CorrelatedSagaFilter`2.MassTransit.IFilter<MassTransit.ConsumeContext<TMessage>>.Send(ConsumeContext`1 context, IPipe`1 next) in /_/src/MassTransit/Middleware/CorrelatedSagaFilter.cs:line 66
   at MassTransit.Middleware.CorrelatedSagaFilter`2.MassTransit.IFilter<MassTransit.ConsumeContext<TMessage>>.Send(ConsumeContext`1 context, IPipe`1 next) in /_/src/MassTransit/Middleware/CorrelatedSagaFilter.cs:line 66
   at MassTransit.Middleware.RetryFilter`1.MassTransit.IFilter<TContext>.Send(TContext context, IPipe`1 next) in /_/src/MassTransit/Middleware/RetryFilter.cs:line 47
2022-08-05 21:40:27.106 +04:00 [INF] Entity Framework Core 6.0.3 initialized 'SagasDbContext' using provider 'Npgsql.EntityFrameworkCore.PostgreSQL:6.0.3+94d0a8eaeb9cf5af6ce55a9e59153c1a1be3244f' with options: None
2022-08-05 21:40:27.108 +04:00 [DBG] Opening connection to database 'sagas_db' on server ''.
2022-08-05 21:40:27.109 +04:00 [DBG] Opened connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:40:27.110 +04:00 [DBG] Beginning transaction with isolation level 'Serializable'.
2022-08-05 21:40:27.111 +04:00 [DBG] Began transaction with isolation level 'Serializable'.
2022-08-05 21:40:27.112 +04:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2022-08-05 21:40:27.112 +04:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2022-08-05 21:40:27.113 +04:00 [DBG] Executing DbCommand [Parameters=[p0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT b."CorrelationId", b."CurrentState", b."RequestId", b."ResponseAddress"
FROM (
    SELECT * FROM "public"."BuyItemsSagaState" WHERE "CorrelationId" = @p0 FOR UPDATE
) AS b
LIMIT 2
2022-08-05 21:40:27.118 +04:00 [INF] Executed DbCommand (5ms) [Parameters=[p0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT b."CorrelationId", b."CurrentState", b."RequestId", b."ResponseAddress"
FROM (
    SELECT * FROM "public"."BuyItemsSagaState" WHERE "CorrelationId" = @p0 FOR UPDATE
) AS b
LIMIT 2
2022-08-05 21:40:27.121 +04:00 [DBG] Context 'SagasDbContext' started tracking 'BuyItemsSagaState' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2022-08-05 21:40:27.122 +04:00 [DBG] A data reader was disposed.
2022-08-05 21:40:27.123 +04:00 [DBG] SAGA:BuyItemsSagaState:"3fa85f64-5717-4562-b3fc-2c963f66afa6" Used Contracts.BuyItemsRequest
2022-08-05 21:40:27.124 +04:00 [DBG] Rolling back transaction.
2022-08-05 21:40:27.125 +04:00 [DBG] Rolled back transaction.
2022-08-05 21:40:27.126 +04:00 [DBG] Closing connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:40:27.127 +04:00 [DBG] Closed connection to database 'sagas_db' on server ''.
2022-08-05 21:40:27.128 +04:00 [DBG] Disposing transaction.
2022-08-05 21:40:27.129 +04:00 [DBG] 'SagasDbContext' disposed.
2022-08-05 21:40:29.146 +04:00 [INF] Entity Framework Core 6.0.3 initialized 'SagasDbContext' using provider 'Npgsql.EntityFrameworkCore.PostgreSQL:6.0.3+94d0a8eaeb9cf5af6ce55a9e59153c1a1be3244f' with options: None
2022-08-05 21:40:29.148 +04:00 [DBG] Opening connection to database 'sagas_db' on server ''.
2022-08-05 21:40:29.149 +04:00 [DBG] Opened connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:40:29.151 +04:00 [DBG] Beginning transaction with isolation level 'Serializable'.
2022-08-05 21:40:29.152 +04:00 [DBG] Began transaction with isolation level 'Serializable'.
2022-08-05 21:40:29.154 +04:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2022-08-05 21:40:29.155 +04:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2022-08-05 21:40:29.156 +04:00 [DBG] Executing DbCommand [Parameters=[p0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT b."CorrelationId", b."CurrentState", b."RequestId", b."ResponseAddress"
FROM (
    SELECT * FROM "public"."BuyItemsSagaState" WHERE "CorrelationId" = @p0 FOR UPDATE
) AS b
LIMIT 2
2022-08-05 21:40:29.159 +04:00 [INF] Executed DbCommand (3ms) [Parameters=[p0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT b."CorrelationId", b."CurrentState", b."RequestId", b."ResponseAddress"
FROM (
    SELECT * FROM "public"."BuyItemsSagaState" WHERE "CorrelationId" = @p0 FOR UPDATE
) AS b
LIMIT 2
2022-08-05 21:40:29.161 +04:00 [DBG] Context 'SagasDbContext' started tracking 'BuyItemsSagaState' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2022-08-05 21:40:29.162 +04:00 [DBG] A data reader was disposed.
2022-08-05 21:40:29.163 +04:00 [DBG] SAGA:BuyItemsSagaState:"3fa85f64-5717-4562-b3fc-2c963f66afa6" Used Contracts.BuyItemsRequest
2022-08-05 21:40:29.164 +04:00 [DBG] Rolling back transaction.
2022-08-05 21:40:29.166 +04:00 [DBG] Rolled back transaction.
2022-08-05 21:40:29.167 +04:00 [DBG] Closing connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:40:29.168 +04:00 [DBG] Closed connection to database 'sagas_db' on server ''.
2022-08-05 21:40:29.169 +04:00 [DBG] Disposing transaction.
2022-08-05 21:40:29.172 +04:00 [DBG] 'SagasDbContext' disposed.
2022-08-05 21:40:32.188 +04:00 [INF] Entity Framework Core 6.0.3 initialized 'SagasDbContext' using provider 'Npgsql.EntityFrameworkCore.PostgreSQL:6.0.3+94d0a8eaeb9cf5af6ce55a9e59153c1a1be3244f' with options: None
2022-08-05 21:40:32.191 +04:00 [DBG] Opening connection to database 'sagas_db' on server ''.
2022-08-05 21:40:32.192 +04:00 [DBG] Opened connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:40:32.194 +04:00 [DBG] Beginning transaction with isolation level 'Serializable'.
2022-08-05 21:40:32.195 +04:00 [DBG] Began transaction with isolation level 'Serializable'.
2022-08-05 21:40:32.196 +04:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2022-08-05 21:40:32.198 +04:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2022-08-05 21:40:32.199 +04:00 [DBG] Executing DbCommand [Parameters=[p0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT b."CorrelationId", b."CurrentState", b."RequestId", b."ResponseAddress"
FROM (
    SELECT * FROM "public"."BuyItemsSagaState" WHERE "CorrelationId" = @p0 FOR UPDATE
) AS b
LIMIT 2
2022-08-05 21:40:32.203 +04:00 [INF] Executed DbCommand (3ms) [Parameters=[p0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT b."CorrelationId", b."CurrentState", b."RequestId", b."ResponseAddress"
FROM (
    SELECT * FROM "public"."BuyItemsSagaState" WHERE "CorrelationId" = @p0 FOR UPDATE
) AS b
LIMIT 2
2022-08-05 21:40:32.205 +04:00 [DBG] Context 'SagasDbContext' started tracking 'BuyItemsSagaState' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2022-08-05 21:40:32.207 +04:00 [DBG] A data reader was disposed.
2022-08-05 21:40:32.208 +04:00 [DBG] SAGA:BuyItemsSagaState:"3fa85f64-5717-4562-b3fc-2c963f66afa6" Used Contracts.BuyItemsRequest
2022-08-05 21:40:32.210 +04:00 [DBG] Rolling back transaction.
2022-08-05 21:40:32.211 +04:00 [DBG] Rolled back transaction.
2022-08-05 21:40:32.211 +04:00 [DBG] Closing connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:40:32.213 +04:00 [DBG] Closed connection to database 'sagas_db' on server ''.
2022-08-05 21:40:32.214 +04:00 [DBG] Disposing transaction.
2022-08-05 21:40:32.215 +04:00 [DBG] 'SagasDbContext' disposed.
2022-08-05 21:40:32.227 +04:00 [DBG] SEND "rabbitmq://localhost:0/SMS2104090_ApiGateway_bus_5eooyyn76cybmbd5bdp8qnjirf?temporary=true" "14400000-5df3-0015-4e28-08da7709986f" MassTransit.Fault<Contracts.BuyItemsRequest>
2022-08-05 21:40:32.228 +04:00 [ERR] R-FAULT "rabbitmq://localhost/buy-items-saga-state" "da210000-5df3-0015-897d-08da770994c0" Contracts.BuyItemsRequest BuyItemsSagaState("00:00:00.0281154")
MassTransit.NotAcceptedStateMachineException: BuyItemsSagaState(3fa85f64-5717-4562-b3fc-2c963f66afa6) Saga exception on receipt of Contracts.BuyItemsRequest: Not accepted in state Final
 ---> MassTransit.UnhandledEventException: The BuyItems event is not handled during the Final state for the BuyItemsSaga state machine
   at MassTransit.MassTransitStateMachine`1.DefaultUnhandledEventCallback(UnhandledEventContext`1 context) in /_/src/MassTransit/SagaStateMachine/MassTransitStateMachine.cs:line 221
   at MassTransit.MassTransitStateMachine`1.UnhandledEvent(BehaviorContext`1 context, State state) in /_/src/MassTransit/SagaStateMachine/MassTransitStateMachine.cs:line 1288
   at MassTransit.MassTransitStateMachine`1.<.ctor>b__14_2(BehaviorContext`1 context, State state) in /_/src/MassTransit/SagaStateMachine/MassTransitStateMachine.cs:line 54
   at MassTransit.SagaStateMachine.StateMachineState`1.MassTransit.State<TSaga>.Raise[T](BehaviorContext`2 context) in /_/src/MassTransit/SagaStateMachine/SagaStateMachine/StateMachineState.cs:line 162
   at MassTransit.MassTransitStateMachine`1.MassTransit.StateMachine<TInstance>.RaiseEvent[T](BehaviorContext`2 context) in /_/src/MassTransit/SagaStateMachine/MassTransitStateMachine.cs:line 134
   at MassTransit.Middleware.StateMachineSagaMessageFilter`2.Send(SagaConsumeContext`2 context, IPipe`1 next) in /_/src/MassTransit/Middleware/StateMachineSagaMessageFilter.cs:line 60
   --- End of inner exception stack trace ---
   at MassTransit.Middleware.StateMachineSagaMessageFilter`2.Send(SagaConsumeContext`2 context, IPipe`1 next) in /_/src/MassTransit/Middleware/StateMachineSagaMessageFilter.cs:line 69
   at MassTransit.Middleware.StateMachineSagaMessageFilter`2.Send(SagaConsumeContext`2 context, IPipe`1 next) in /_/src/MassTransit/Middleware/StateMachineSagaMessageFilter.cs:line 74
   at MassTransit.Middleware.SendSagaPipe`2.Send(SagaRepositoryContext`2 context) in /_/src/MassTransit/Middleware/SendSagaPipe.cs:line 74
   at MassTransit.Middleware.SendSagaPipe`2.Send(SagaRepositoryContext`2 context) in /_/src/MassTransit/Middleware/SendSagaPipe.cs:line 74
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.<>c__DisplayClass5_0`1.<<Send>b__1>d.MoveNext() in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 56
--- End of stack trace from previous location ---
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.<>c__DisplayClass8_0.<<WithinTransaction>g__Create|0>d.MoveNext() in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 139
--- End of stack trace from previous location ---
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.WithinTransaction[T](DbContext context, CancellationToken cancellationToken, Func`1 callback) in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 185
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.WithinTransaction[T](DbContext context, CancellationToken cancellationToken, Func`1 callback) in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 185
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.WithinTransaction[T](DbContext context, CancellationToken cancellationToken, Func`1 callback) in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 185
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.Send[T](ConsumeContext`1 context, IPipe`1 next) in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 64
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.Send[T](ConsumeContext`1 context, IPipe`1 next) in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 68
   at MassTransit.DependencyInjection.DependencyInjectionSagaRepositoryContextFactory`1.<>c__DisplayClass6_0`1.<<Send>g__CreateScope|0>d.MoveNext() in /_/src/MassTransit/DependencyInjection/DependencyInjection/DependencyInjectionSagaRepositoryContextFactory.cs:line 84
--- End of stack trace from previous location ---
   at MassTransit.DependencyInjection.DependencyInjectionSagaRepositoryContextFactory`1.<>c__DisplayClass6_0`1.<<Send>g__CreateScope|0>d.MoveNext() in /_/src/MassTransit/DependencyInjection/DependencyInjection/DependencyInjectionSagaRepositoryContextFactory.cs:line 91
--- End of stack trace from previous location ---
   at MassTransit.Middleware.CorrelatedSagaFilter`2.MassTransit.IFilter<MassTransit.ConsumeContext<TMessage>>.Send(ConsumeContext`1 context, IPipe`1 next) in /_/src/MassTransit/Middleware/CorrelatedSagaFilter.cs:line 66
   at MassTransit.Middleware.CorrelatedSagaFilter`2.MassTransit.IFilter<MassTransit.ConsumeContext<TMessage>>.Send(ConsumeContext`1 context, IPipe`1 next) in /_/src/MassTransit/Middleware/CorrelatedSagaFilter.cs:line 66
   at MassTransit.Middleware.RetryFilter`1.Attempt(TContext context, RetryContext`1 retryContext, IPipe`1 next) in /_/src/MassTransit/Middleware/RetryFilter.cs:line 158
2022-08-05 21:41:32.755 +04:00 [INF] Application is shutting down...
2022-08-05 21:41:32.756 +04:00 [DBG] Hosting stopping
2022-08-05 21:41:32.763 +04:00 [DBG] Stopping bus instances: IBus
2022-08-05 21:41:32.769 +04:00 [DBG] Stopping bus: "rabbitmq://localhost/"
2022-08-05 21:41:32.774 +04:00 [DBG] Endpoint Stopping: "rabbitmq://localhost/buy-items-saga-state"
2022-08-05 21:41:32.776 +04:00 [DBG] Stopping receive transport: "rabbitmq://localhost/buy-items-saga-state"
2022-08-05 21:41:32.781 +04:00 [DBG] Stopping Consumer: "rabbitmq://localhost/buy-items-saga-state" - amq.ctag-10OIVaxKUvfaPFqmEHIMQA
2022-08-05 21:41:32.788 +04:00 [DBG] Endpoint Stopping: "rabbitmq://localhost/SMS2104090_SagasMicroservice_bus_ntyyyyn76cybkf86bdp8qnjjgs?temporary=true"
2022-08-05 21:41:32.788 +04:00 [DBG] Consumer Cancel Ok: "rabbitmq://localhost/buy-items-saga-state" - amq.ctag-10OIVaxKUvfaPFqmEHIMQA
2022-08-05 21:41:32.789 +04:00 [DBG] Stopping receive transport: "rabbitmq://localhost/SMS2104090_SagasMicroservice_bus_ntyyyyn76cybkf86bdp8qnjjgs?temporary=true"
2022-08-05 21:41:32.790 +04:00 [DBG] Endpoint Completed: "rabbitmq://localhost/SMS2104090_SagasMicroservice_bus_ntyyyyn76cybkf86bdp8qnjjgs?temporary=true"
2022-08-05 21:41:32.791 +04:00 [DBG] Endpoint Completed: "rabbitmq://localhost/buy-items-saga-state"
2022-08-05 21:41:32.792 +04:00 [DBG] Stopping send transport: Contracts:IGetMoneyRequest
2022-08-05 21:41:32.793 +04:00 [DBG] Consumer completed amq.ctag-10OIVaxKUvfaPFqmEHIMQA: 6 received, 2 concurrent
2022-08-05 21:41:32.796 +04:00 [DBG] Stopping send transport: buy-items-saga-state
2022-08-05 21:41:32.798 +04:00 [DBG] Stopping send transport: Contracts:IGetItemsRequest
2022-08-05 21:41:32.799 +04:00 [DBG] Stopping send transport: SMS2104090_ApiGateway_bus_5eooyyn76cybmbd5bdp8qnjirf
2022-08-05 21:41:32.799 +04:00 [DBG] Stopping send transport: MassTransit:Fault--MassTransit.Contracts:RequestTimeoutExpired--Contracts:IGetMoneyRequest----
2022-08-05 21:41:32.800 +04:00 [DBG] Stopping send transport: MassTransit:Fault--MassTransit.Contracts:RequestTimeoutExpired--Contracts:IGetItemsRequest----
2022-08-05 21:41:32.810 +04:00 [DBG] Disconnect: rabbitmq@localhost:5672/
2022-08-05 21:41:32.816 +04:00 [DBG] Disconnected: rabbitmq@localhost:5672/
2022-08-05 21:41:32.819 +04:00 [INF] Bus stopped: "rabbitmq://localhost/"
2022-08-05 21:41:32.821 +04:00 [DBG] Hosting stopped
2022-08-05 21:52:43.378 +04:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2022-08-05 21:52:45.298 +04:00 [INF] Entity Framework Core 6.0.3 initialized 'SagasDbContext' using provider 'Npgsql.EntityFrameworkCore.PostgreSQL:6.0.3+94d0a8eaeb9cf5af6ce55a9e59153c1a1be3244f' with options: None
2022-08-05 21:52:45.468 +04:00 [DBG] Opening connection to database 'sagas_db' on server ''.
2022-08-05 21:52:46.160 +04:00 [DBG] Opened connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:52:46.166 +04:00 [DBG] Closing connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:52:46.179 +04:00 [DBG] Closed connection to database 'sagas_db' on server ''.
2022-08-05 21:52:46.202 +04:00 [DBG] Creating DbCommand for 'ExecuteScalar'.
2022-08-05 21:52:46.232 +04:00 [DBG] Created DbCommand for 'ExecuteScalar' (14ms).
2022-08-05 21:52:46.243 +04:00 [DBG] Opening connection to database 'sagas_db' on server ''.
2022-08-05 21:52:48.856 +04:00 [DBG] Opened connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:52:48.866 +04:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']

SELECT CASE WHEN COUNT(*) = 0 THEN FALSE ELSE TRUE END
FROM pg_class AS cls
JOIN pg_namespace AS ns ON ns.oid = cls.relnamespace
WHERE
        cls.relkind IN ('r', 'v', 'm', 'f', 'p') AND
        ns.nspname NOT IN ('pg_catalog', 'information_schema') AND
        -- Exclude tables which are members of PG extensions
        NOT EXISTS (
            SELECT 1 FROM pg_depend WHERE
                classid=(
                    SELECT cls.oid
                    FROM pg_class AS cls
                             JOIN pg_namespace AS ns ON ns.oid = cls.relnamespace
                    WHERE relname='pg_class' AND ns.nspname='pg_catalog'
                ) AND
                objid=cls.oid AND
                deptype IN ('e', 'x')
        )
2022-08-05 21:52:48.990 +04:00 [INF] Executed DbCommand (122ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

SELECT CASE WHEN COUNT(*) = 0 THEN FALSE ELSE TRUE END
FROM pg_class AS cls
JOIN pg_namespace AS ns ON ns.oid = cls.relnamespace
WHERE
        cls.relkind IN ('r', 'v', 'm', 'f', 'p') AND
        ns.nspname NOT IN ('pg_catalog', 'information_schema') AND
        -- Exclude tables which are members of PG extensions
        NOT EXISTS (
            SELECT 1 FROM pg_depend WHERE
                classid=(
                    SELECT cls.oid
                    FROM pg_class AS cls
                             JOIN pg_namespace AS ns ON ns.oid = cls.relnamespace
                    WHERE relname='pg_class' AND ns.nspname='pg_catalog'
                ) AND
                objid=cls.oid AND
                deptype IN ('e', 'x')
        )
2022-08-05 21:52:48.996 +04:00 [DBG] Closing connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:52:49.000 +04:00 [DBG] Closed connection to database 'sagas_db' on server ''.
2022-08-05 21:52:49.003 +04:00 [DBG] 'SagasDbContext' disposed.
2022-08-05 21:52:49.097 +04:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2022-08-05 21:52:49.137 +04:00 [DBG] Hosting starting
2022-08-05 21:52:49.457 +04:00 [INF] Configured endpoint buy-items-saga-state, Saga: BuyItemsSagaState, State Machine: BuyItemsSaga
2022-08-05 21:52:49.618 +04:00 [DBG] Starting bus instances: IBus
2022-08-05 21:52:49.625 +04:00 [DBG] Starting bus: "rabbitmq://localhost/"
2022-08-05 21:52:49.714 +04:00 [DBG] Connect: rabbitmq@localhost:5672/
2022-08-05 21:52:49.868 +04:00 [DBG] Connected: rabbitmq@localhost:5672/ (address: amqp://localhost:5672, local: 49824)
2022-08-05 21:52:49.874 +04:00 [INF] Now listening on: http://localhost:5180
2022-08-05 21:52:49.901 +04:00 [DBG] Loaded hosting startup assembly SagasMicroservice
2022-08-05 21:52:49.903 +04:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2022-08-05 21:52:49.905 +04:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2022-08-05 21:52:49.906 +04:00 [INF] Application started. Press Ctrl+C to shut down.
2022-08-05 21:52:49.907 +04:00 [INF] Hosting environment: Development
2022-08-05 21:52:49.908 +04:00 [INF] Content root path: D:\github\microservices-archetecture\src\SagasMicroservice\
2022-08-05 21:52:49.909 +04:00 [DBG] Hosting started
2022-08-05 21:52:49.929 +04:00 [DBG] Endpoint Ready: "rabbitmq://localhost/SMS2104090_SagasMicroservice_bus_wofoyyn76cybkuoabdp8qn4xf9?temporary=true"
2022-08-05 21:52:49.950 +04:00 [DBG] Declare queue: name: buy-items-saga-state, durable, consumer-count: 0 message-count: 0
2022-08-05 21:52:49.977 +04:00 [DBG] Declare exchange: name: buy-items-saga-state, type: fanout, durable
2022-08-05 21:52:49.981 +04:00 [DBG] Declare exchange: name: Contracts:BuyItemsRequest, type: fanout, durable
2022-08-05 21:52:49.983 +04:00 [DBG] Declare exchange: name: Contracts:IGetItemsResponse, type: fanout, durable
2022-08-05 21:52:49.984 +04:00 [DBG] Declare exchange: name: MassTransit.Contracts:RequestTimeoutExpired--Contracts:IGetMoneyRequest--, type: fanout, durable
2022-08-05 21:52:49.986 +04:00 [DBG] Declare exchange: name: Contracts:IGetMoneyResponse, type: fanout, durable
2022-08-05 21:52:49.987 +04:00 [DBG] Declare exchange: name: MassTransit:Fault--Contracts:IGetMoneyRequest--, type: fanout, durable
2022-08-05 21:52:49.989 +04:00 [DBG] Declare exchange: name: MassTransit.Contracts:RequestTimeoutExpired--Contracts:IGetItemsRequest--, type: fanout, durable
2022-08-05 21:52:49.994 +04:00 [DBG] Declare exchange: name: MassTransit:Fault--Contracts:IGetItemsRequest--, type: fanout, durable
2022-08-05 21:52:49.999 +04:00 [DBG] Bind queue: source: buy-items-saga-state, destination: buy-items-saga-state
2022-08-05 21:52:50.024 +04:00 [DBG] Bind exchange: source: Contracts:BuyItemsRequest, destination: buy-items-saga-state
2022-08-05 21:52:50.028 +04:00 [DBG] Bind exchange: source: Contracts:IGetItemsResponse, destination: buy-items-saga-state
2022-08-05 21:52:50.030 +04:00 [DBG] Bind exchange: source: MassTransit.Contracts:RequestTimeoutExpired--Contracts:IGetMoneyRequest--, destination: buy-items-saga-state
2022-08-05 21:52:50.032 +04:00 [DBG] Bind exchange: source: Contracts:IGetMoneyResponse, destination: buy-items-saga-state
2022-08-05 21:52:50.034 +04:00 [DBG] Bind exchange: source: MassTransit:Fault--Contracts:IGetMoneyRequest--, destination: buy-items-saga-state
2022-08-05 21:52:50.036 +04:00 [DBG] Bind exchange: source: MassTransit.Contracts:RequestTimeoutExpired--Contracts:IGetItemsRequest--, destination: buy-items-saga-state
2022-08-05 21:52:50.038 +04:00 [DBG] Bind exchange: source: MassTransit:Fault--Contracts:IGetItemsRequest--, destination: buy-items-saga-state
2022-08-05 21:52:50.138 +04:00 [DBG] Consumer Ok: "rabbitmq://localhost/buy-items-saga-state" - amq.ctag-pAK3Mi6HKEwfITWtPnFIyw
2022-08-05 21:52:50.140 +04:00 [DBG] Endpoint Ready: "rabbitmq://localhost/buy-items-saga-state"
2022-08-05 21:52:50.146 +04:00 [INF] Bus started: "rabbitmq://localhost/"
2022-08-05 21:52:50.175 +04:00 [DBG] Connection id "0HMJN1D84KBTL" accepted.
2022-08-05 21:52:50.177 +04:00 [DBG] Connection id "0HMJN1D84KBTL" started.
2022-08-05 21:52:50.180 +04:00 [DBG] Connection id "0HMJN1D84KBTM" accepted.
2022-08-05 21:52:50.181 +04:00 [DBG] Connection id "0HMJN1D84KBTM" started.
2022-08-05 21:52:50.503 +04:00 [DBG] Connection id "0HMJN1D84KBTN" accepted.
2022-08-05 21:52:50.505 +04:00 [DBG] Connection id "0HMJN1D84KBTN" started.
2022-08-05 21:52:50.591 +04:00 [INF] Request starting HTTP/1.1 GET http://localhost:5180/swagger - -
2022-08-05 21:52:50.639 +04:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2022-08-05 21:52:50.649 +04:00 [DBG] No candidates found for the request path '/swagger'
2022-08-05 21:52:50.651 +04:00 [DBG] Request did not match any endpoints
2022-08-05 21:52:50.704 +04:00 [DBG] Connection id "0HMJN1D84KBTN" completed keep alive response.
2022-08-05 21:52:50.709 +04:00 [INF] Request finished HTTP/1.1 GET http://localhost:5180/swagger - - - 301 0 - 122.0263ms
2022-08-05 21:52:50.734 +04:00 [INF] Request starting HTTP/1.1 GET http://localhost:5180/swagger/index.html - -
2022-08-05 21:52:50.737 +04:00 [DBG] No candidates found for the request path '/swagger/index.html'
2022-08-05 21:52:50.738 +04:00 [DBG] Request did not match any endpoints
2022-08-05 21:52:50.811 +04:00 [DBG] Response markup is scheduled to include browser refresh script injection.
2022-08-05 21:52:50.963 +04:00 [DBG] Response markup was updated to include browser refresh script injection.
2022-08-05 21:52:50.965 +04:00 [DBG] Connection id "0HMJN1D84KBTN" completed keep alive response.
2022-08-05 21:52:50.967 +04:00 [INF] Request finished HTTP/1.1 GET http://localhost:5180/swagger/index.html - - - 200 - text/html;charset=utf-8 233.5271ms
2022-08-05 21:52:51.021 +04:00 [INF] Request starting HTTP/1.1 GET http://localhost:5180/swagger/swagger-ui.css - -
2022-08-05 21:52:51.021 +04:00 [DBG] Connection id "0HMJN1D84KBTO" accepted.
2022-08-05 21:52:51.024 +04:00 [DBG] No candidates found for the request path '/swagger/swagger-ui.css'
2022-08-05 21:52:51.026 +04:00 [DBG] Connection id "0HMJN1D84KBTO" started.
2022-08-05 21:52:51.033 +04:00 [DBG] Connection id "0HMJN1D84KBTP" accepted.
2022-08-05 21:52:51.033 +04:00 [DBG] Request did not match any endpoints
2022-08-05 21:52:51.035 +04:00 [INF] Request starting HTTP/1.1 GET http://localhost:5180/swagger/swagger-ui-bundle.js - -
2022-08-05 21:52:51.036 +04:00 [DBG] Connection id "0HMJN1D84KBTP" started.
2022-08-05 21:52:51.037 +04:00 [DBG] Connection id "0HMJN1D84KBTQ" accepted.
2022-08-05 21:52:51.038 +04:00 [DBG] No candidates found for the request path '/swagger/swagger-ui-bundle.js'
2022-08-05 21:52:51.039 +04:00 [INF] Request starting HTTP/1.1 GET http://localhost:5180/swagger/swagger-ui-standalone-preset.js - -
2022-08-05 21:52:51.041 +04:00 [DBG] Connection id "0HMJN1D84KBTQ" started.
2022-08-05 21:52:51.043 +04:00 [DBG] Request did not match any endpoints
2022-08-05 21:52:51.044 +04:00 [DBG] No candidates found for the request path '/swagger/swagger-ui-standalone-preset.js'
2022-08-05 21:52:51.046 +04:00 [INF] Request starting HTTP/1.1 GET http://localhost:5180/_framework/aspnetcore-browser-refresh.js - -
2022-08-05 21:52:51.048 +04:00 [DBG] Request did not match any endpoints
2022-08-05 21:52:51.053 +04:00 [DBG] Connection id "0HMJN1D84KBTQ" completed keep alive response.
2022-08-05 21:52:51.055 +04:00 [INF] Request finished HTTP/1.1 GET http://localhost:5180/_framework/aspnetcore-browser-refresh.js - - - 200 11951 application/javascript;+charset=utf-8 9.2011ms
2022-08-05 21:52:51.065 +04:00 [INF] Sending file. Request path: '/swagger-ui.css'. Physical path: 'N/A'
2022-08-05 21:52:51.065 +04:00 [INF] Sending file. Request path: '/swagger-ui-standalone-preset.js'. Physical path: 'N/A'
2022-08-05 21:52:51.073 +04:00 [DBG] Connection id "0HMJN1D84KBTN" completed keep alive response.
2022-08-05 21:52:51.078 +04:00 [INF] Sending file. Request path: '/swagger-ui-bundle.js'. Physical path: 'N/A'
2022-08-05 21:52:51.081 +04:00 [DBG] Connection id "0HMJN1D84KBTP" completed keep alive response.
2022-08-05 21:52:51.083 +04:00 [INF] Request finished HTTP/1.1 GET http://localhost:5180/swagger/swagger-ui.css - - - 200 143821 text/css 62.6169ms
2022-08-05 21:52:51.085 +04:00 [DBG] Connection id "0HMJN1D84KBTO" completed keep alive response.
2022-08-05 21:52:51.088 +04:00 [INF] Request finished HTTP/1.1 GET http://localhost:5180/swagger/swagger-ui-standalone-preset.js - - - 200 319705 application/javascript 48.0336ms
2022-08-05 21:52:51.092 +04:00 [INF] Request finished HTTP/1.1 GET http://localhost:5180/swagger/swagger-ui-bundle.js - - - 200 1079362 application/javascript 57.1222ms
2022-08-05 21:52:51.356 +04:00 [INF] Request starting HTTP/1.1 GET http://localhost:5180/swagger/favicon-32x32.png - -
2022-08-05 21:52:51.357 +04:00 [DBG] No candidates found for the request path '/swagger/favicon-32x32.png'
2022-08-05 21:52:51.358 +04:00 [DBG] Request did not match any endpoints
2022-08-05 21:52:51.360 +04:00 [INF] Sending file. Request path: '/favicon-32x32.png'. Physical path: 'N/A'
2022-08-05 21:52:51.363 +04:00 [DBG] Connection id "0HMJN1D84KBTO" completed keep alive response.
2022-08-05 21:52:51.365 +04:00 [INF] Request finished HTTP/1.1 GET http://localhost:5180/swagger/favicon-32x32.png - - - 200 628 image/png 9.2218ms
2022-08-05 21:52:51.540 +04:00 [INF] Request starting HTTP/1.1 GET http://localhost:5180/swagger/v1/swagger.json - -
2022-08-05 21:52:51.545 +04:00 [DBG] No candidates found for the request path '/swagger/v1/swagger.json'
2022-08-05 21:52:51.548 +04:00 [DBG] Request did not match any endpoints
2022-08-05 21:52:51.589 +04:00 [DBG] Connection id "0HMJN1D84KBTO" completed keep alive response.
2022-08-05 21:52:51.592 +04:00 [INF] Request finished HTTP/1.1 GET http://localhost:5180/swagger/v1/swagger.json - - - 200 - application/json;charset=utf-8 52.0947ms
2022-08-05 21:53:29.141 +04:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2022-08-05 21:53:30.178 +04:00 [INF] Entity Framework Core 6.0.3 initialized 'SagasDbContext' using provider 'Npgsql.EntityFrameworkCore.PostgreSQL:6.0.3+94d0a8eaeb9cf5af6ce55a9e59153c1a1be3244f' with options: None
2022-08-05 21:53:30.235 +04:00 [DBG] Opening connection to database 'sagas_db' on server ''.
2022-08-05 21:53:30.473 +04:00 [DBG] Opened connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:53:30.478 +04:00 [DBG] Closing connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:53:30.483 +04:00 [DBG] Closed connection to database 'sagas_db' on server ''.
2022-08-05 21:53:30.493 +04:00 [DBG] Creating DbCommand for 'ExecuteScalar'.
2022-08-05 21:53:30.501 +04:00 [DBG] Created DbCommand for 'ExecuteScalar' (6ms).
2022-08-05 21:53:30.503 +04:00 [DBG] Opening connection to database 'sagas_db' on server ''.
2022-08-05 21:53:30.562 +04:00 [DBG] Opened connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:53:30.572 +04:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']

SELECT CASE WHEN COUNT(*) = 0 THEN FALSE ELSE TRUE END
FROM pg_class AS cls
JOIN pg_namespace AS ns ON ns.oid = cls.relnamespace
WHERE
        cls.relkind IN ('r', 'v', 'm', 'f', 'p') AND
        ns.nspname NOT IN ('pg_catalog', 'information_schema') AND
        -- Exclude tables which are members of PG extensions
        NOT EXISTS (
            SELECT 1 FROM pg_depend WHERE
                classid=(
                    SELECT cls.oid
                    FROM pg_class AS cls
                             JOIN pg_namespace AS ns ON ns.oid = cls.relnamespace
                    WHERE relname='pg_class' AND ns.nspname='pg_catalog'
                ) AND
                objid=cls.oid AND
                deptype IN ('e', 'x')
        )
2022-08-05 21:53:30.658 +04:00 [INF] Executed DbCommand (86ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

SELECT CASE WHEN COUNT(*) = 0 THEN FALSE ELSE TRUE END
FROM pg_class AS cls
JOIN pg_namespace AS ns ON ns.oid = cls.relnamespace
WHERE
        cls.relkind IN ('r', 'v', 'm', 'f', 'p') AND
        ns.nspname NOT IN ('pg_catalog', 'information_schema') AND
        -- Exclude tables which are members of PG extensions
        NOT EXISTS (
            SELECT 1 FROM pg_depend WHERE
                classid=(
                    SELECT cls.oid
                    FROM pg_class AS cls
                             JOIN pg_namespace AS ns ON ns.oid = cls.relnamespace
                    WHERE relname='pg_class' AND ns.nspname='pg_catalog'
                ) AND
                objid=cls.oid AND
                deptype IN ('e', 'x')
        )
2022-08-05 21:53:30.666 +04:00 [DBG] Closing connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:53:30.669 +04:00 [DBG] Closed connection to database 'sagas_db' on server ''.
2022-08-05 21:53:30.680 +04:00 [DBG] 'SagasDbContext' disposed.
2022-08-05 21:53:30.745 +04:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2022-08-05 21:53:30.787 +04:00 [DBG] Hosting starting
2022-08-05 21:53:31.084 +04:00 [INF] Configured endpoint buy-items-saga-state, Saga: BuyItemsSagaState, State Machine: BuyItemsSaga
2022-08-05 21:53:31.223 +04:00 [DBG] Starting bus instances: IBus
2022-08-05 21:53:31.231 +04:00 [DBG] Starting bus: "rabbitmq://localhost/"
2022-08-05 21:53:31.287 +04:00 [DBG] Connect: rabbitmq@localhost:5672/
2022-08-05 21:53:31.388 +04:00 [INF] Now listening on: http://localhost:5180
2022-08-05 21:53:31.390 +04:00 [DBG] Loaded hosting startup assembly SagasMicroservice
2022-08-05 21:53:31.391 +04:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2022-08-05 21:53:31.393 +04:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2022-08-05 21:53:31.394 +04:00 [INF] Application started. Press Ctrl+C to shut down.
2022-08-05 21:53:31.395 +04:00 [INF] Hosting environment: Development
2022-08-05 21:53:31.396 +04:00 [INF] Content root path: D:\github\microservices-archetecture\src\SagasMicroservice\
2022-08-05 21:53:31.398 +04:00 [DBG] Hosting started
2022-08-05 21:53:31.416 +04:00 [DBG] Connected: rabbitmq@localhost:5672/ (address: amqp://localhost:5672, local: 50071)
2022-08-05 21:53:31.467 +04:00 [DBG] Endpoint Ready: "rabbitmq://localhost/SMS2104090_SagasMicroservice_bus_eteyyyn76cybkqzhbdp8qn5er1?temporary=true"
2022-08-05 21:53:31.485 +04:00 [DBG] Declare queue: name: buy-items-saga-state, durable, consumer-count: 0 message-count: 0
2022-08-05 21:53:31.509 +04:00 [DBG] Declare exchange: name: buy-items-saga-state, type: fanout, durable
2022-08-05 21:53:31.514 +04:00 [DBG] Declare exchange: name: Contracts:BuyItemsRequest, type: fanout, durable
2022-08-05 21:53:31.516 +04:00 [DBG] Declare exchange: name: Contracts:IGetItemsResponse, type: fanout, durable
2022-08-05 21:53:31.518 +04:00 [DBG] Declare exchange: name: MassTransit.Contracts:RequestTimeoutExpired--Contracts:IGetMoneyRequest--, type: fanout, durable
2022-08-05 21:53:31.519 +04:00 [DBG] Declare exchange: name: Contracts:IGetMoneyResponse, type: fanout, durable
2022-08-05 21:53:31.520 +04:00 [DBG] Declare exchange: name: MassTransit:Fault--Contracts:IGetMoneyRequest--, type: fanout, durable
2022-08-05 21:53:31.522 +04:00 [DBG] Declare exchange: name: MassTransit.Contracts:RequestTimeoutExpired--Contracts:IGetItemsRequest--, type: fanout, durable
2022-08-05 21:53:31.527 +04:00 [DBG] Declare exchange: name: MassTransit:Fault--Contracts:IGetItemsRequest--, type: fanout, durable
2022-08-05 21:53:31.533 +04:00 [DBG] Bind queue: source: buy-items-saga-state, destination: buy-items-saga-state
2022-08-05 21:53:31.557 +04:00 [DBG] Bind exchange: source: Contracts:BuyItemsRequest, destination: buy-items-saga-state
2022-08-05 21:53:31.561 +04:00 [DBG] Bind exchange: source: Contracts:IGetItemsResponse, destination: buy-items-saga-state
2022-08-05 21:53:31.563 +04:00 [DBG] Bind exchange: source: MassTransit.Contracts:RequestTimeoutExpired--Contracts:IGetMoneyRequest--, destination: buy-items-saga-state
2022-08-05 21:53:31.565 +04:00 [DBG] Bind exchange: source: Contracts:IGetMoneyResponse, destination: buy-items-saga-state
2022-08-05 21:53:31.566 +04:00 [DBG] Bind exchange: source: MassTransit:Fault--Contracts:IGetMoneyRequest--, destination: buy-items-saga-state
2022-08-05 21:53:31.568 +04:00 [DBG] Bind exchange: source: MassTransit.Contracts:RequestTimeoutExpired--Contracts:IGetItemsRequest--, destination: buy-items-saga-state
2022-08-05 21:53:31.570 +04:00 [DBG] Bind exchange: source: MassTransit:Fault--Contracts:IGetItemsRequest--, destination: buy-items-saga-state
2022-08-05 21:53:31.831 +04:00 [DBG] Connection id "0HMJN1DKHSP8C" accepted.
2022-08-05 21:53:31.834 +04:00 [DBG] Connection id "0HMJN1DKHSP8C" started.
2022-08-05 21:53:31.835 +04:00 [DBG] Connection id "0HMJN1DKHSP8D" accepted.
2022-08-05 21:53:31.838 +04:00 [DBG] Connection id "0HMJN1DKHSP8D" started.
2022-08-05 21:53:31.855 +04:00 [DBG] Connection id "0HMJN1DKHSP8C" received FIN.
2022-08-05 21:53:31.859 +04:00 [DBG] Connection id "0HMJN1DKHSP8C" sending FIN because: "The client closed the connection."
2022-08-05 21:53:31.863 +04:00 [DBG] Connection id "0HMJN1DKHSP8C" disconnecting.
2022-08-05 21:53:31.866 +04:00 [DBG] Connection id "0HMJN1DKHSP8C" stopped.
2022-08-05 21:53:32.317 +04:00 [DBG] Connection id "0HMJN1DKHSP8D" received FIN.
2022-08-05 21:53:32.319 +04:00 [DBG] Connection id "0HMJN1DKHSP8D" sending FIN because: "The client closed the connection."
2022-08-05 21:53:32.320 +04:00 [DBG] Connection id "0HMJN1DKHSP8D" disconnecting.
2022-08-05 21:53:32.322 +04:00 [DBG] Connection id "0HMJN1DKHSP8D" stopped.
2022-08-05 21:53:32.361 +04:00 [DBG] Consumer Ok: "rabbitmq://localhost/buy-items-saga-state" - amq.ctag-1ToI1nn_2ntzTELg3t2E3w
2022-08-05 21:53:32.364 +04:00 [DBG] Endpoint Ready: "rabbitmq://localhost/buy-items-saga-state"
2022-08-05 21:53:32.370 +04:00 [INF] Bus started: "rabbitmq://localhost/"
2022-08-05 21:53:32.504 +04:00 [DBG] Connection id "0HMJN1DKHSP8E" accepted.
2022-08-05 21:53:32.505 +04:00 [DBG] Connection id "0HMJN1DKHSP8E" started.
2022-08-05 21:53:32.529 +04:00 [DBG] Connection id "0HMJN1DKHSP8E" received FIN.
2022-08-05 21:53:32.531 +04:00 [DBG] Connection id "0HMJN1DKHSP8E" sending FIN because: "The client closed the connection."
2022-08-05 21:53:32.534 +04:00 [DBG] Connection id "0HMJN1DKHSP8E" disconnecting.
2022-08-05 21:53:32.538 +04:00 [DBG] Connection id "0HMJN1DKHSP8F" accepted.
2022-08-05 21:53:32.546 +04:00 [DBG] Connection id "0HMJN1DKHSP8F" started.
2022-08-05 21:53:32.573 +04:00 [INF] Request starting HTTP/1.1 GET http://localhost:5180/swagger/index.html - -
2022-08-05 21:53:32.573 +04:00 [INF] Request starting HTTP/1.1 GET http://localhost:5180/swagger - -
2022-08-05 21:53:32.617 +04:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2022-08-05 21:53:32.617 +04:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2022-08-05 21:53:32.627 +04:00 [DBG] No candidates found for the request path '/swagger'
2022-08-05 21:53:32.627 +04:00 [DBG] No candidates found for the request path '/swagger/index.html'
2022-08-05 21:53:32.629 +04:00 [DBG] Request did not match any endpoints
2022-08-05 21:53:32.634 +04:00 [DBG] Request did not match any endpoints
2022-08-05 21:53:32.669 +04:00 [INF] Request finished HTTP/1.1 GET http://localhost:5180/swagger - - - 0 - - 98.9035ms
2022-08-05 21:53:32.682 +04:00 [DBG] Connection id "0HMJN1DKHSP8E" stopped.
2022-08-05 21:53:32.741 +04:00 [DBG] Response markup is scheduled to include browser refresh script injection.
2022-08-05 21:53:32.830 +04:00 [DBG] Response markup was updated to include browser refresh script injection.
2022-08-05 21:53:32.832 +04:00 [DBG] Connection id "0HMJN1DKHSP8F" completed keep alive response.
2022-08-05 21:53:32.834 +04:00 [INF] Request finished HTTP/1.1 GET http://localhost:5180/swagger/index.html - - - 200 - text/html;charset=utf-8 264.8295ms
2022-08-05 21:53:32.900 +04:00 [DBG] Connection id "0HMJN1DKHSP8G" accepted.
2022-08-05 21:53:32.900 +04:00 [DBG] Connection id "0HMJN1DKHSP8G" received FIN.
2022-08-05 21:53:32.902 +04:00 [DBG] Connection id "0HMJN1DKHSP8G" started.
2022-08-05 21:53:32.903 +04:00 [INF] Request starting HTTP/1.1 GET http://localhost:5180/_framework/aspnetcore-browser-refresh.js - -
2022-08-05 21:53:32.913 +04:00 [DBG] Connection id "0HMJN1DKHSP8G" sending FIN because: "The client closed the connection."
2022-08-05 21:53:32.919 +04:00 [DBG] Connection id "0HMJN1DKHSP8G" disconnecting.
2022-08-05 21:53:32.920 +04:00 [DBG] Connection id "0HMJN1DKHSP8F" completed keep alive response.
2022-08-05 21:53:32.921 +04:00 [DBG] Connection id "0HMJN1DKHSP8G" stopped.
2022-08-05 21:53:32.931 +04:00 [INF] Request finished HTTP/1.1 GET http://localhost:5180/_framework/aspnetcore-browser-refresh.js - - - 200 11951 application/javascript;+charset=utf-8 27.4752ms
2022-08-05 21:53:33.121 +04:00 [INF] Request starting HTTP/1.1 GET http://localhost:5180/swagger/favicon-32x32.png - -
2022-08-05 21:53:33.121 +04:00 [DBG] Connection id "0HMJN1DKHSP8F" received FIN.
2022-08-05 21:53:33.123 +04:00 [DBG] No candidates found for the request path '/swagger/favicon-32x32.png'
2022-08-05 21:53:33.125 +04:00 [DBG] Connection id "0HMJN1DKHSP8F" sending FIN because: "The client closed the connection."
2022-08-05 21:53:33.129 +04:00 [DBG] Request did not match any endpoints
2022-08-05 21:53:33.133 +04:00 [DBG] Connection id "0HMJN1DKHSP8F" disconnecting.
2022-08-05 21:53:33.142 +04:00 [DBG] The file transmission was cancelled
System.OperationCanceledException: The operation was canceled.
   at System.Threading.CancellationToken.ThrowOperationCanceledException()
   at System.Threading.CancellationToken.ThrowIfCancellationRequested()
   at Microsoft.AspNetCore.Http.SendFileResponseExtensions.SendFileAsyncCore(HttpResponse response, IFileInfo file, Int64 offset, Nullable`1 count, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.StaticFiles.StaticFileContext.SendAsync()
2022-08-05 21:53:33.214 +04:00 [INF] Sending file. Request path: '/favicon-32x32.png'. Physical path: 'N/A'
2022-08-05 21:53:33.215 +04:00 [INF] Request finished HTTP/1.1 GET http://localhost:5180/swagger/favicon-32x32.png - - - 0 628 image/png 94.0692ms
2022-08-05 21:53:33.217 +04:00 [DBG] Connection id "0HMJN1DKHSP8F" stopped.
2022-08-05 21:53:33.253 +04:00 [DBG] Connection id "0HMJN1DKHSP8H" accepted.
2022-08-05 21:53:33.256 +04:00 [DBG] Connection id "0HMJN1DKHSP8H" started.
2022-08-05 21:53:33.259 +04:00 [INF] Request starting HTTP/1.1 GET http://localhost:5180/swagger/v1/swagger.json - -
2022-08-05 21:53:33.261 +04:00 [DBG] No candidates found for the request path '/swagger/v1/swagger.json'
2022-08-05 21:53:33.262 +04:00 [DBG] Request did not match any endpoints
2022-08-05 21:53:33.293 +04:00 [DBG] Connection id "0HMJN1DKHSP8H" completed keep alive response.
2022-08-05 21:53:33.296 +04:00 [INF] Request finished HTTP/1.1 GET http://localhost:5180/swagger/v1/swagger.json - - - 200 - application/json;charset=utf-8 36.9319ms
2022-08-05 21:54:12.291 +04:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2022-08-05 21:54:13.198 +04:00 [INF] Entity Framework Core 6.0.3 initialized 'SagasDbContext' using provider 'Npgsql.EntityFrameworkCore.PostgreSQL:6.0.3+94d0a8eaeb9cf5af6ce55a9e59153c1a1be3244f' with options: None
2022-08-05 21:54:13.272 +04:00 [DBG] Opening connection to database 'sagas_db' on server ''.
2022-08-05 21:54:13.500 +04:00 [DBG] An error occurred using the connection to database 'sagas_db' on server ''.
2022-08-05 21:54:13.526 +04:00 [DBG] Opening connection to database 'postgres' on server ''.
2022-08-05 21:54:13.982 +04:00 [DBG] Opened connection to database 'postgres' on server 'tcp://localhost:5432'.
2022-08-05 21:54:14.000 +04:00 [DBG] Creating DbCommand for 'ExecuteNonQuery'.
2022-08-05 21:54:14.016 +04:00 [DBG] Created DbCommand for 'ExecuteNonQuery' (13ms).
2022-08-05 21:54:14.037 +04:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE DATABASE sagas_db;
2022-08-05 21:54:15.577 +04:00 [INF] Executed DbCommand (1,548ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE DATABASE sagas_db;
2022-08-05 21:54:15.580 +04:00 [DBG] Closing connection to database 'postgres' on server 'tcp://localhost:5432'.
2022-08-05 21:54:15.584 +04:00 [DBG] Closed connection to database 'postgres' on server ''.
2022-08-05 21:54:15.587 +04:00 [DBG] Opening connection to database 'sagas_db' on server ''.
2022-08-05 21:54:15.927 +04:00 [DBG] Opened connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:54:15.929 +04:00 [DBG] Closing connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:54:15.932 +04:00 [DBG] Closed connection to database 'sagas_db' on server ''.
2022-08-05 21:54:16.012 +04:00 [DBG] DetectChanges starting for 'SagasDbContext'.
2022-08-05 21:54:16.017 +04:00 [DBG] DetectChanges completed for 'SagasDbContext'.
2022-08-05 21:54:16.029 +04:00 [DBG] Opening connection to database 'sagas_db' on server ''.
2022-08-05 21:54:16.102 +04:00 [DBG] Opened connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:54:16.106 +04:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2022-08-05 21:54:16.114 +04:00 [DBG] Began transaction with isolation level 'ReadCommitted'.
2022-08-05 21:54:16.117 +04:00 [DBG] Creating DbCommand for 'ExecuteNonQuery'.
2022-08-05 21:54:16.119 +04:00 [DBG] Created DbCommand for 'ExecuteNonQuery' (2ms).
2022-08-05 21:54:16.121 +04:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "BuyItemsSagaState" (
    "CorrelationId" uuid NOT NULL,
    "CurrentState" character varying(255) NULL,
    "RequestId" uuid NULL,
    "ResponseAddress" text NULL,
    CONSTRAINT "PK_BuyItemsSagaState" PRIMARY KEY ("CorrelationId")
);
2022-08-05 21:54:16.260 +04:00 [INF] Executed DbCommand (139ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "BuyItemsSagaState" (
    "CorrelationId" uuid NOT NULL,
    "CurrentState" character varying(255) NULL,
    "RequestId" uuid NULL,
    "ResponseAddress" text NULL,
    CONSTRAINT "PK_BuyItemsSagaState" PRIMARY KEY ("CorrelationId")
);
2022-08-05 21:54:16.264 +04:00 [DBG] Committing transaction.
2022-08-05 21:54:16.273 +04:00 [DBG] Committed transaction.
2022-08-05 21:54:16.276 +04:00 [DBG] Disposing transaction.
2022-08-05 21:54:16.277 +04:00 [DBG] Closing connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:54:16.279 +04:00 [DBG] Closed connection to database 'sagas_db' on server ''.
2022-08-05 21:54:16.283 +04:00 [DBG] 'SagasDbContext' disposed.
2022-08-05 21:54:16.357 +04:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2022-08-05 21:54:16.394 +04:00 [DBG] Hosting starting
2022-08-05 21:54:16.754 +04:00 [INF] Configured endpoint buy-items-saga-state, Saga: BuyItemsSagaState, State Machine: BuyItemsSaga
2022-08-05 21:54:16.925 +04:00 [DBG] Starting bus instances: IBus
2022-08-05 21:54:16.931 +04:00 [DBG] Starting bus: "rabbitmq://localhost/"
2022-08-05 21:54:17.000 +04:00 [DBG] Connect: rabbitmq@localhost:5672/
2022-08-05 21:54:17.119 +04:00 [INF] Now listening on: http://localhost:5180
2022-08-05 21:54:17.121 +04:00 [DBG] Loaded hosting startup assembly SagasMicroservice
2022-08-05 21:54:17.125 +04:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2022-08-05 21:54:17.127 +04:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2022-08-05 21:54:17.128 +04:00 [INF] Application started. Press Ctrl+C to shut down.
2022-08-05 21:54:17.129 +04:00 [INF] Hosting environment: Development
2022-08-05 21:54:17.131 +04:00 [INF] Content root path: D:\github\microservices-archetecture\src\SagasMicroservice\
2022-08-05 21:54:17.132 +04:00 [DBG] Hosting started
2022-08-05 21:54:17.154 +04:00 [DBG] Connected: rabbitmq@localhost:5672/ (address: amqp://localhost:5672, local: 50248)
2022-08-05 21:54:17.209 +04:00 [DBG] Endpoint Ready: "rabbitmq://localhost/SMS2104090_SagasMicroservice_bus_nt8oyyn76cybkuygbdp8qnhdgr?temporary=true"
2022-08-05 21:54:17.230 +04:00 [DBG] Declare queue: name: buy-items-saga-state, durable, consumer-count: 0 message-count: 0
2022-08-05 21:54:17.248 +04:00 [DBG] Declare exchange: name: buy-items-saga-state, type: fanout, durable
2022-08-05 21:54:17.252 +04:00 [DBG] Declare exchange: name: Contracts:BuyItemsRequest, type: fanout, durable
2022-08-05 21:54:17.254 +04:00 [DBG] Declare exchange: name: MassTransit:Fault--Contracts:IGetMoneyRequest--, type: fanout, durable
2022-08-05 21:54:17.256 +04:00 [DBG] Declare exchange: name: Contracts:IGetItemsResponse, type: fanout, durable
2022-08-05 21:54:17.258 +04:00 [DBG] Declare exchange: name: MassTransit:Fault--Contracts:IGetItemsRequest--, type: fanout, durable
2022-08-05 21:54:17.260 +04:00 [DBG] Declare exchange: name: Contracts:IGetMoneyResponse, type: fanout, durable
2022-08-05 21:54:17.264 +04:00 [DBG] Declare exchange: name: MassTransit.Contracts:RequestTimeoutExpired--Contracts:IGetItemsRequest--, type: fanout, durable
2022-08-05 21:54:17.266 +04:00 [DBG] Declare exchange: name: MassTransit.Contracts:RequestTimeoutExpired--Contracts:IGetMoneyRequest--, type: fanout, durable
2022-08-05 21:54:17.273 +04:00 [DBG] Bind queue: source: buy-items-saga-state, destination: buy-items-saga-state
2022-08-05 21:54:17.280 +04:00 [DBG] Connection id "0HMJN1E239SSU" accepted.
2022-08-05 21:54:17.280 +04:00 [DBG] Connection id "0HMJN1E239SSV" accepted.
2022-08-05 21:54:17.283 +04:00 [DBG] Connection id "0HMJN1E239SSU" started.
2022-08-05 21:54:17.284 +04:00 [DBG] Connection id "0HMJN1E239SSV" started.
2022-08-05 21:54:17.306 +04:00 [DBG] Bind exchange: source: Contracts:BuyItemsRequest, destination: buy-items-saga-state
2022-08-05 21:54:17.317 +04:00 [DBG] Bind exchange: source: MassTransit:Fault--Contracts:IGetMoneyRequest--, destination: buy-items-saga-state
2022-08-05 21:54:17.319 +04:00 [DBG] Connection id "0HMJN1E239SSV" received FIN.
2022-08-05 21:54:17.319 +04:00 [DBG] Connection id "0HMJN1E239SSU" received FIN.
2022-08-05 21:54:17.320 +04:00 [DBG] Bind exchange: source: Contracts:IGetItemsResponse, destination: buy-items-saga-state
2022-08-05 21:54:17.323 +04:00 [DBG] Connection id "0HMJN1E239SSV" sending FIN because: "The client closed the connection."
2022-08-05 21:54:17.326 +04:00 [DBG] Connection id "0HMJN1E239SSU" sending FIN because: "The client closed the connection."
2022-08-05 21:54:17.329 +04:00 [DBG] Bind exchange: source: MassTransit:Fault--Contracts:IGetItemsRequest--, destination: buy-items-saga-state
2022-08-05 21:54:17.331 +04:00 [DBG] Connection id "0HMJN1E239SSV" disconnecting.
2022-08-05 21:54:17.333 +04:00 [DBG] Connection id "0HMJN1E239SSU" disconnecting.
2022-08-05 21:54:17.335 +04:00 [DBG] Bind exchange: source: Contracts:IGetMoneyResponse, destination: buy-items-saga-state
2022-08-05 21:54:17.339 +04:00 [DBG] Connection id "0HMJN1E239SSV" stopped.
2022-08-05 21:54:17.341 +04:00 [DBG] Connection id "0HMJN1E239SSU" stopped.
2022-08-05 21:54:17.346 +04:00 [DBG] Bind exchange: source: MassTransit.Contracts:RequestTimeoutExpired--Contracts:IGetItemsRequest--, destination: buy-items-saga-state
2022-08-05 21:54:17.352 +04:00 [DBG] Bind exchange: source: MassTransit.Contracts:RequestTimeoutExpired--Contracts:IGetMoneyRequest--, destination: buy-items-saga-state
2022-08-05 21:54:17.442 +04:00 [DBG] Consumer Ok: "rabbitmq://localhost/buy-items-saga-state" - amq.ctag-ynJ4mPtZuWBQLoKkdFLbBw
2022-08-05 21:54:17.445 +04:00 [DBG] Endpoint Ready: "rabbitmq://localhost/buy-items-saga-state"
2022-08-05 21:54:17.453 +04:00 [INF] Bus started: "rabbitmq://localhost/"
2022-08-05 21:54:17.548 +04:00 [DBG] Connection id "0HMJN1E239ST0" accepted.
2022-08-05 21:54:17.549 +04:00 [DBG] Connection id "0HMJN1E239ST0" started.
2022-08-05 21:54:17.574 +04:00 [DBG] Connection id "0HMJN1E239ST0" received FIN.
2022-08-05 21:54:17.576 +04:00 [DBG] Connection id "0HMJN1E239ST0" sending FIN because: "The client closed the connection."
2022-08-05 21:54:17.581 +04:00 [DBG] Connection id "0HMJN1E239ST0" disconnecting.
2022-08-05 21:54:17.584 +04:00 [DBG] Connection id "0HMJN1E239ST1" accepted.
2022-08-05 21:54:17.593 +04:00 [DBG] Connection id "0HMJN1E239ST1" started.
2022-08-05 21:54:17.645 +04:00 [INF] Request starting HTTP/1.1 GET http://localhost:5180/swagger/index.html - -
2022-08-05 21:54:17.645 +04:00 [INF] Request starting HTTP/1.1 GET http://localhost:5180/swagger - -
2022-08-05 21:54:17.711 +04:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2022-08-05 21:54:17.711 +04:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2022-08-05 21:54:17.730 +04:00 [DBG] No candidates found for the request path '/swagger/index.html'
2022-08-05 21:54:17.730 +04:00 [DBG] No candidates found for the request path '/swagger'
2022-08-05 21:54:17.733 +04:00 [DBG] Request did not match any endpoints
2022-08-05 21:54:17.740 +04:00 [DBG] Request did not match any endpoints
2022-08-05 21:54:17.799 +04:00 [INF] Request finished HTTP/1.1 GET http://localhost:5180/swagger - - - 0 - - 159.6069ms
2022-08-05 21:54:17.818 +04:00 [DBG] Connection id "0HMJN1E239ST0" stopped.
2022-08-05 21:54:17.926 +04:00 [DBG] Response markup is scheduled to include browser refresh script injection.
2022-08-05 21:54:18.057 +04:00 [DBG] Response markup was updated to include browser refresh script injection.
2022-08-05 21:54:18.060 +04:00 [DBG] Connection id "0HMJN1E239ST1" completed keep alive response.
2022-08-05 21:54:18.063 +04:00 [INF] Request finished HTTP/1.1 GET http://localhost:5180/swagger/index.html - - - 200 - text/html;charset=utf-8 425.5911ms
2022-08-05 21:54:18.184 +04:00 [INF] Request starting HTTP/1.1 GET http://localhost:5180/_framework/aspnetcore-browser-refresh.js - -
2022-08-05 21:54:18.232 +04:00 [DBG] Connection id "0HMJN1E239ST1" completed keep alive response.
2022-08-05 21:54:18.247 +04:00 [INF] Request finished HTTP/1.1 GET http://localhost:5180/_framework/aspnetcore-browser-refresh.js - - - 200 11951 application/javascript;+charset=utf-8 64.3829ms
2022-08-05 21:54:18.603 +04:00 [DBG] Connection id "0HMJN1E239ST1" received FIN.
2022-08-05 21:54:18.603 +04:00 [INF] Request starting HTTP/1.1 GET http://localhost:5180/swagger/favicon-32x32.png - -
2022-08-05 21:54:18.609 +04:00 [DBG] No candidates found for the request path '/swagger/favicon-32x32.png'
2022-08-05 21:54:18.607 +04:00 [DBG] Connection id "0HMJN1E239ST1" sending FIN because: "The client closed the connection."
2022-08-05 21:54:18.612 +04:00 [DBG] Request did not match any endpoints
2022-08-05 21:54:18.615 +04:00 [DBG] Connection id "0HMJN1E239ST1" disconnecting.
2022-08-05 21:54:18.638 +04:00 [DBG] The file transmission was cancelled
System.OperationCanceledException: The operation was canceled.
   at System.Threading.CancellationToken.ThrowOperationCanceledException()
   at System.Threading.CancellationToken.ThrowIfCancellationRequested()
   at Microsoft.AspNetCore.Http.SendFileResponseExtensions.SendFileAsyncCore(HttpResponse response, IFileInfo file, Int64 offset, Nullable`1 count, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.StaticFiles.StaticFileContext.SendAsync()
2022-08-05 21:54:18.729 +04:00 [INF] Sending file. Request path: '/favicon-32x32.png'. Physical path: 'N/A'
2022-08-05 21:54:18.732 +04:00 [INF] Request finished HTTP/1.1 GET http://localhost:5180/swagger/favicon-32x32.png - - - 0 628 image/png 128.8213ms
2022-08-05 21:54:18.735 +04:00 [DBG] Connection id "0HMJN1E239ST1" stopped.
2022-08-05 21:54:18.938 +04:00 [DBG] Connection id "0HMJN1E239ST2" accepted.
2022-08-05 21:54:18.941 +04:00 [DBG] Connection id "0HMJN1E239ST2" started.
2022-08-05 21:54:18.951 +04:00 [INF] Request starting HTTP/1.1 GET http://localhost:5180/swagger/v1/swagger.json - -
2022-08-05 21:54:18.953 +04:00 [DBG] No candidates found for the request path '/swagger/v1/swagger.json'
2022-08-05 21:54:18.958 +04:00 [DBG] Request did not match any endpoints
2022-08-05 21:54:19.014 +04:00 [DBG] Connection id "0HMJN1E239ST2" completed keep alive response.
2022-08-05 21:54:19.017 +04:00 [INF] Request finished HTTP/1.1 GET http://localhost:5180/swagger/v1/swagger.json - - - 200 - application/json;charset=utf-8 66.2974ms
2022-08-05 21:55:37.303 +04:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2022-08-05 21:55:39.404 +04:00 [INF] Entity Framework Core 6.0.3 initialized 'SagasDbContext' using provider 'Npgsql.EntityFrameworkCore.PostgreSQL:6.0.3+94d0a8eaeb9cf5af6ce55a9e59153c1a1be3244f' with options: None
2022-08-05 21:55:39.817 +04:00 [DBG] Opening connection to database 'sagas_db' on server ''.
2022-08-05 21:55:40.861 +04:00 [DBG] Opened connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:55:40.880 +04:00 [DBG] Closing connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:55:40.932 +04:00 [DBG] Closed connection to database 'sagas_db' on server ''.
2022-08-05 21:55:40.973 +04:00 [DBG] Creating DbCommand for 'ExecuteScalar'.
2022-08-05 21:55:40.998 +04:00 [DBG] Created DbCommand for 'ExecuteScalar' (26ms).
2022-08-05 21:55:41.005 +04:00 [DBG] Opening connection to database 'sagas_db' on server ''.
2022-08-05 21:55:44.421 +04:00 [DBG] Opened connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:55:44.441 +04:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']

SELECT CASE WHEN COUNT(*) = 0 THEN FALSE ELSE TRUE END
FROM pg_class AS cls
JOIN pg_namespace AS ns ON ns.oid = cls.relnamespace
WHERE
        cls.relkind IN ('r', 'v', 'm', 'f', 'p') AND
        ns.nspname NOT IN ('pg_catalog', 'information_schema') AND
        -- Exclude tables which are members of PG extensions
        NOT EXISTS (
            SELECT 1 FROM pg_depend WHERE
                classid=(
                    SELECT cls.oid
                    FROM pg_class AS cls
                             JOIN pg_namespace AS ns ON ns.oid = cls.relnamespace
                    WHERE relname='pg_class' AND ns.nspname='pg_catalog'
                ) AND
                objid=cls.oid AND
                deptype IN ('e', 'x')
        )
2022-08-05 21:55:44.710 +04:00 [INF] Executed DbCommand (269ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

SELECT CASE WHEN COUNT(*) = 0 THEN FALSE ELSE TRUE END
FROM pg_class AS cls
JOIN pg_namespace AS ns ON ns.oid = cls.relnamespace
WHERE
        cls.relkind IN ('r', 'v', 'm', 'f', 'p') AND
        ns.nspname NOT IN ('pg_catalog', 'information_schema') AND
        -- Exclude tables which are members of PG extensions
        NOT EXISTS (
            SELECT 1 FROM pg_depend WHERE
                classid=(
                    SELECT cls.oid
                    FROM pg_class AS cls
                             JOIN pg_namespace AS ns ON ns.oid = cls.relnamespace
                    WHERE relname='pg_class' AND ns.nspname='pg_catalog'
                ) AND
                objid=cls.oid AND
                deptype IN ('e', 'x')
        )
2022-08-05 21:55:44.750 +04:00 [DBG] Closing connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:55:44.767 +04:00 [DBG] Closed connection to database 'sagas_db' on server ''.
2022-08-05 21:55:44.785 +04:00 [DBG] 'SagasDbContext' disposed.
2022-08-05 21:55:44.930 +04:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2022-08-05 21:55:45.018 +04:00 [DBG] Hosting starting
2022-08-05 21:55:45.891 +04:00 [INF] Configured endpoint buy-items-saga-state, Saga: BuyItemsSagaState, State Machine: BuyItemsSaga
2022-08-05 21:55:46.322 +04:00 [DBG] Starting bus instances: IBus
2022-08-05 21:55:46.334 +04:00 [DBG] Starting bus: "rabbitmq://localhost/"
2022-08-05 21:55:46.437 +04:00 [DBG] Connect: rabbitmq@localhost:5672/
2022-08-05 21:55:46.649 +04:00 [INF] Now listening on: http://localhost:5180
2022-08-05 21:55:46.686 +04:00 [DBG] Loaded hosting startup assembly SagasMicroservice
2022-08-05 21:55:46.688 +04:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2022-08-05 21:55:46.693 +04:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2022-08-05 21:55:46.695 +04:00 [INF] Application started. Press Ctrl+C to shut down.
2022-08-05 21:55:46.697 +04:00 [INF] Hosting environment: Development
2022-08-05 21:55:46.699 +04:00 [INF] Content root path: D:\github\microservices-archetecture\src\SagasMicroservice\
2022-08-05 21:55:46.701 +04:00 [DBG] Hosting started
2022-08-05 21:55:46.732 +04:00 [DBG] Connected: rabbitmq@localhost:5672/ (address: amqp://localhost:5672, local: 55394)
2022-08-05 21:55:46.832 +04:00 [DBG] Endpoint Ready: "rabbitmq://localhost/SMS2104090_SagasMicroservice_bus_hy3oyyn76cybkickbdp8qn7afm?temporary=true"
2022-08-05 21:55:46.868 +04:00 [DBG] Declare queue: name: buy-items-saga-state, durable, consumer-count: 0 message-count: 0
2022-08-05 21:55:46.895 +04:00 [DBG] Declare exchange: name: buy-items-saga-state, type: fanout, durable
2022-08-05 21:55:46.905 +04:00 [DBG] Declare exchange: name: Contracts:BuyItemsRequest, type: fanout, durable
2022-08-05 21:55:46.915 +04:00 [DBG] Declare exchange: name: Contracts:IGetItemsResponse, type: fanout, durable
2022-08-05 21:55:46.919 +04:00 [DBG] Declare exchange: name: MassTransit.Contracts:RequestTimeoutExpired--Contracts:IGetMoneyRequest--, type: fanout, durable
2022-08-05 21:55:46.929 +04:00 [DBG] Declare exchange: name: Contracts:IGetMoneyResponse, type: fanout, durable
2022-08-05 21:55:46.932 +04:00 [DBG] Declare exchange: name: MassTransit:Fault--Contracts:IGetMoneyRequest--, type: fanout, durable
2022-08-05 21:55:46.935 +04:00 [DBG] Declare exchange: name: MassTransit.Contracts:RequestTimeoutExpired--Contracts:IGetItemsRequest--, type: fanout, durable
2022-08-05 21:55:46.943 +04:00 [DBG] Declare exchange: name: MassTransit:Fault--Contracts:IGetItemsRequest--, type: fanout, durable
2022-08-05 21:55:46.993 +04:00 [DBG] Bind queue: source: buy-items-saga-state, destination: buy-items-saga-state
2022-08-05 21:55:46.996 +04:00 [DBG] Connection id "0HMJN1ESQTA0R" received FIN.
2022-08-05 21:55:46.997 +04:00 [DBG] Connection id "0HMJN1ESQTA0R" accepted.
2022-08-05 21:55:47.045 +04:00 [DBG] Connection id "0HMJN1ESQTA0R" started.
2022-08-05 21:55:47.069 +04:00 [DBG] Bind exchange: source: Contracts:BuyItemsRequest, destination: buy-items-saga-state
2022-08-05 21:55:47.080 +04:00 [DBG] Connection id "0HMJN1ESQTA0R" sending FIN because: "The client closed the connection."
2022-08-05 21:55:47.150 +04:00 [DBG] Bind exchange: source: Contracts:IGetItemsResponse, destination: buy-items-saga-state
2022-08-05 21:55:47.151 +04:00 [DBG] Connection id "0HMJN1ESQTA0R" disconnecting.
2022-08-05 21:55:47.160 +04:00 [DBG] Bind exchange: source: MassTransit.Contracts:RequestTimeoutExpired--Contracts:IGetMoneyRequest--, destination: buy-items-saga-state
2022-08-05 21:55:47.167 +04:00 [DBG] Bind exchange: source: Contracts:IGetMoneyResponse, destination: buy-items-saga-state
2022-08-05 21:55:47.174 +04:00 [DBG] Connection id "0HMJN1ESQTA0R" stopped.
2022-08-05 21:55:47.179 +04:00 [DBG] Bind exchange: source: MassTransit:Fault--Contracts:IGetMoneyRequest--, destination: buy-items-saga-state
2022-08-05 21:55:47.195 +04:00 [DBG] Bind exchange: source: MassTransit.Contracts:RequestTimeoutExpired--Contracts:IGetItemsRequest--, destination: buy-items-saga-state
2022-08-05 21:55:47.198 +04:00 [DBG] Bind exchange: source: MassTransit:Fault--Contracts:IGetItemsRequest--, destination: buy-items-saga-state
2022-08-05 21:55:47.385 +04:00 [DBG] Consumer Ok: "rabbitmq://localhost/buy-items-saga-state" - amq.ctag-JE7Xpa35d6FFvDJBzLz23A
2022-08-05 21:55:47.479 +04:00 [DBG] Connection id "0HMJN1ESQTA0S" accepted.
2022-08-05 21:55:47.555 +04:00 [DBG] Connection id "0HMJN1ESQTA0S" started.
2022-08-05 21:55:47.562 +04:00 [DBG] Endpoint Ready: "rabbitmq://localhost/buy-items-saga-state"
2022-08-05 21:55:47.583 +04:00 [INF] Bus started: "rabbitmq://localhost/"
2022-08-05 21:55:47.683 +04:00 [INF] Request starting HTTP/1.1 GET http://localhost:5180/swagger/index.html - -
2022-08-05 21:55:47.793 +04:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2022-08-05 21:55:47.819 +04:00 [DBG] No candidates found for the request path '/swagger/index.html'
2022-08-05 21:55:47.824 +04:00 [DBG] Request did not match any endpoints
2022-08-05 21:55:48.022 +04:00 [DBG] Response markup is scheduled to include browser refresh script injection.
2022-08-05 21:55:48.187 +04:00 [DBG] Response markup was updated to include browser refresh script injection.
2022-08-05 21:55:48.195 +04:00 [DBG] Connection id "0HMJN1ESQTA0S" completed keep alive response.
2022-08-05 21:55:48.204 +04:00 [INF] Request finished HTTP/1.1 GET http://localhost:5180/swagger/index.html - - - 200 - text/html;charset=utf-8 541.2910ms
2022-08-05 21:55:48.420 +04:00 [DBG] Connection id "0HMJN1ESQTA0T" reset.
2022-08-05 21:55:48.429 +04:00 [INF] Request starting HTTP/1.1 GET http://localhost:5180/_framework/aspnetcore-browser-refresh.js - -
2022-08-05 21:55:48.432 +04:00 [DBG] Connection id "0HMJN1ESQTA0T" accepted.
2022-08-05 21:55:48.439 +04:00 [DBG] Connection id "0HMJN1ESQTA0S" completed keep alive response.
2022-08-05 21:55:48.441 +04:00 [DBG] Connection id "0HMJN1ESQTA0T" started.
2022-08-05 21:55:48.446 +04:00 [INF] Request finished HTTP/1.1 GET http://localhost:5180/_framework/aspnetcore-browser-refresh.js - - - 200 11951 application/javascript;+charset=utf-8 15.8702ms
2022-08-05 21:55:48.460 +04:00 [DBG] Connection id "0HMJN1ESQTA0T" sending FIN because: "The client closed the connection."
2022-08-05 21:55:48.483 +04:00 [DBG] Connection id "0HMJN1ESQTA0T" disconnecting.
2022-08-05 21:55:48.488 +04:00 [DBG] Connection id "0HMJN1ESQTA0T" stopped.
2022-08-05 21:55:49.009 +04:00 [DBG] Connection id "0HMJN1ESQTA0S" received FIN.
2022-08-05 21:55:49.010 +04:00 [INF] Request starting HTTP/1.1 GET http://localhost:5180/swagger/favicon-32x32.png - -
2022-08-05 21:55:49.012 +04:00 [DBG] Connection id "0HMJN1ESQTA0S" sending FIN because: "The client closed the connection."
2022-08-05 21:55:49.015 +04:00 [DBG] No candidates found for the request path '/swagger/favicon-32x32.png'
2022-08-05 21:55:49.017 +04:00 [DBG] Connection id "0HMJN1ESQTA0S" disconnecting.
2022-08-05 21:55:49.020 +04:00 [DBG] Request did not match any endpoints
2022-08-05 21:55:49.036 +04:00 [DBG] The file transmission was cancelled
System.OperationCanceledException: The operation was canceled.
   at System.Threading.CancellationToken.ThrowOperationCanceledException()
   at System.Threading.CancellationToken.ThrowIfCancellationRequested()
   at Microsoft.AspNetCore.Http.SendFileResponseExtensions.SendFileAsyncCore(HttpResponse response, IFileInfo file, Int64 offset, Nullable`1 count, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.StaticFiles.StaticFileContext.SendAsync()
2022-08-05 21:55:49.092 +04:00 [INF] Sending file. Request path: '/favicon-32x32.png'. Physical path: 'N/A'
2022-08-05 21:55:49.094 +04:00 [INF] Request finished HTTP/1.1 GET http://localhost:5180/swagger/favicon-32x32.png - - - 0 628 image/png 84.8981ms
2022-08-05 21:55:49.099 +04:00 [DBG] Connection id "0HMJN1ESQTA0S" stopped.
2022-08-05 21:55:49.246 +04:00 [DBG] Connection id "0HMJN1ESQTA0U" accepted.
2022-08-05 21:55:49.248 +04:00 [DBG] Connection id "0HMJN1ESQTA0U" started.
2022-08-05 21:55:49.251 +04:00 [INF] Request starting HTTP/1.1 GET http://localhost:5180/swagger/v1/swagger.json - -
2022-08-05 21:55:49.253 +04:00 [DBG] No candidates found for the request path '/swagger/v1/swagger.json'
2022-08-05 21:55:49.256 +04:00 [DBG] Request did not match any endpoints
2022-08-05 21:55:49.311 +04:00 [DBG] Connection id "0HMJN1ESQTA0U" completed keep alive response.
2022-08-05 21:55:49.315 +04:00 [INF] Request finished HTTP/1.1 GET http://localhost:5180/swagger/v1/swagger.json - - - 200 - application/json;charset=utf-8 63.6317ms
2022-08-05 21:56:19.660 +04:00 [INF] Entity Framework Core 6.0.3 initialized 'SagasDbContext' using provider 'Npgsql.EntityFrameworkCore.PostgreSQL:6.0.3+94d0a8eaeb9cf5af6ce55a9e59153c1a1be3244f' with options: None
2022-08-05 21:56:19.679 +04:00 [DBG] Opening connection to database 'sagas_db' on server ''.
2022-08-05 21:56:19.682 +04:00 [DBG] Opened connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:56:19.684 +04:00 [DBG] Beginning transaction with isolation level 'Serializable'.
2022-08-05 21:56:19.693 +04:00 [DBG] Began transaction with isolation level 'Serializable'.
2022-08-05 21:56:19.779 +04:00 [DBG] Compiling query expression: 
'DbSet<BuyItemsSagaState>().FromSql(SELECT * FROM "public"."BuyItemsSagaState" WHERE "CorrelationId" = @p0 FOR UPDATE, __p_0)
    .SingleOrDefault()'
2022-08-05 21:56:19.956 +04:00 [DBG] Generated query execution expression: 
'queryContext => ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync<BuyItemsSagaState>(
    asyncEnumerable: new SingleQueryingEnumerable<BuyItemsSagaState>(
        (RelationalQueryContext)queryContext, 
        RelationalCommandCache.SelectExpression(
            Projection Mapping:
                EmptyProjectionMember -> Dictionary<IProperty, int> { [Property: BuyItemsSagaState.CorrelationId (Guid) Required PK AfterSave:Throw, 0], [Property: BuyItemsSagaState.CurrentState (string) MaxLength(255), 1], [Property: BuyItemsSagaState.RequestId (Guid?), 2], [Property: BuyItemsSagaState.ResponseAddress (Uri), 3] }
            SELECT TOP(2) b.CorrelationId, b.CurrentState, b.RequestId, b.ResponseAddress
            FROM SELECT * FROM "public"."BuyItemsSagaState" WHERE "CorrelationId" = @p0 FOR UPDATE), 
        Func<QueryContext, DbDataReader, ResultContext, SingleQueryResultCoordinator, BuyItemsSagaState>, 
        SagasDbContext, 
        False, 
        False, 
        True
    ), 
    cancellationToken: queryContext.CancellationToken)'
2022-08-05 21:56:20.043 +04:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2022-08-05 21:56:20.049 +04:00 [DBG] Created DbCommand for 'ExecuteReader' (5ms).
2022-08-05 21:56:20.075 +04:00 [DBG] Executing DbCommand [Parameters=[p0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT b."CorrelationId", b."CurrentState", b."RequestId", b."ResponseAddress"
FROM (
    SELECT * FROM "public"."BuyItemsSagaState" WHERE "CorrelationId" = @p0 FOR UPDATE
) AS b
LIMIT 2
2022-08-05 21:56:20.114 +04:00 [INF] Executed DbCommand (53ms) [Parameters=[p0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT b."CorrelationId", b."CurrentState", b."RequestId", b."ResponseAddress"
FROM (
    SELECT * FROM "public"."BuyItemsSagaState" WHERE "CorrelationId" = @p0 FOR UPDATE
) AS b
LIMIT 2
2022-08-05 21:56:20.126 +04:00 [DBG] A data reader was disposed.
2022-08-05 21:56:20.147 +04:00 [DBG] SAGA:BuyItemsSagaState:"3fa85f64-5717-4562-b3fc-2c963f66afa6" Created Contracts.BuyItemsRequest
2022-08-05 21:56:20.154 +04:00 [DBG] SAGA:BuyItemsSagaState:"3fa85f64-5717-4562-b3fc-2c963f66afa6" Added Contracts.BuyItemsRequest
2022-08-05 21:56:20.442 +04:00 [DBG] Create send transport: "rabbitmq://localhost/buy-items-saga-state"
2022-08-05 21:56:20.482 +04:00 [DBG] Declare exchange: name: buy-items-saga-state, type: fanout, durable
2022-08-05 21:56:20.548 +04:00 [DBG] Declare exchange: name: buy-items-saga-state_delay, type: x-delayed-message, durable, x-delayed-type: fanout
2022-08-05 21:56:20.550 +04:00 [DBG] Declare exchange: name: buy-items-saga-state, type: fanout, durable
2022-08-05 21:56:20.554 +04:00 [DBG] Bind exchange: source: buy-items-saga-state_delay, destination: buy-items-saga-state
2022-08-05 21:56:20.615 +04:00 [DBG] SEND "rabbitmq://localhost/buy-items-saga-state" "e0330000-5df3-0015-2dac-08da770bcda6" MassTransit.Contracts.RequestTimeoutExpired<Contracts.IGetMoneyRequest>
2022-08-05 21:56:20.779 +04:00 [DBG] Context 'SagasDbContext' started tracking 'BuyItemsSagaState' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2022-08-05 21:56:20.785 +04:00 [DBG] SaveChanges starting for 'SagasDbContext'.
2022-08-05 21:56:20.791 +04:00 [DBG] DetectChanges starting for 'SagasDbContext'.
2022-08-05 21:56:20.805 +04:00 [DBG] DetectChanges completed for 'SagasDbContext'.
2022-08-05 21:56:20.829 +04:00 [DBG] Creating transaction savepoint.
2022-08-05 21:56:20.846 +04:00 [DBG] Created transaction savepoint.
2022-08-05 21:56:20.913 +04:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2022-08-05 21:56:20.915 +04:00 [DBG] Created DbCommand for 'ExecuteReader' (2ms).
2022-08-05 21:56:20.920 +04:00 [DBG] Executing DbCommand [Parameters=[@p0='?' (DbType = Guid), @p1='?', @p2='?' (DbType = Guid), @p3='?'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "BuyItemsSagaState" ("CorrelationId", "CurrentState", "RequestId", "ResponseAddress")
VALUES (@p0, @p1, @p2, @p3);
2022-08-05 21:56:20.934 +04:00 [INF] Executed DbCommand (14ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?', @p2='?' (DbType = Guid), @p3='?'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "BuyItemsSagaState" ("CorrelationId", "CurrentState", "RequestId", "ResponseAddress")
VALUES (@p0, @p1, @p2, @p3);
2022-08-05 21:56:20.945 +04:00 [DBG] A data reader was disposed.
2022-08-05 21:56:20.951 +04:00 [DBG] Releasing transaction savepoint.
2022-08-05 21:56:20.957 +04:00 [DBG] Released transaction savepoint.
2022-08-05 21:56:20.978 +04:00 [DBG] An entity of type 'BuyItemsSagaState' tracked by 'SagasDbContext' changed state from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2022-08-05 21:56:20.984 +04:00 [DBG] SaveChanges completed for 'SagasDbContext' with 1 entities written to the database.
2022-08-05 21:56:20.993 +04:00 [DBG] Committing transaction.
2022-08-05 21:56:21.003 +04:00 [DBG] Committed transaction.
2022-08-05 21:56:21.009 +04:00 [DBG] Closing connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:56:21.013 +04:00 [DBG] Closed connection to database 'sagas_db' on server ''.
2022-08-05 21:56:21.017 +04:00 [DBG] Disposing transaction.
2022-08-05 21:56:21.021 +04:00 [DBG] 'SagasDbContext' disposed.
2022-08-05 21:56:21.034 +04:00 [DBG] RECEIVE "rabbitmq://localhost/buy-items-saga-state" "da210000-5df3-0015-24e4-08da770bcce7" Contracts.BuyItemsRequest BuyItemsSagaState("00:00:01.3845325")
2022-08-05 21:56:21.048 +04:00 [DBG] Declare exchange: name: Contracts:IGetMoneyRequest, type: fanout, durable
2022-08-05 21:56:21.091 +04:00 [DBG] SEND "rabbitmq://localhost/Contracts:IGetMoneyRequest" "e0330000-5df3-0015-0a68-08da770bcdfd" Contracts.IGetMoneyRequest
2022-08-05 21:56:21.960 +04:00 [INF] Entity Framework Core 6.0.3 initialized 'SagasDbContext' using provider 'Npgsql.EntityFrameworkCore.PostgreSQL:6.0.3+94d0a8eaeb9cf5af6ce55a9e59153c1a1be3244f' with options: None
2022-08-05 21:56:21.975 +04:00 [DBG] Opening connection to database 'sagas_db' on server ''.
2022-08-05 21:56:21.977 +04:00 [DBG] Opened connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:56:21.979 +04:00 [DBG] Beginning transaction with isolation level 'Serializable'.
2022-08-05 21:56:21.980 +04:00 [DBG] Began transaction with isolation level 'Serializable'.
2022-08-05 21:56:21.985 +04:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2022-08-05 21:56:21.987 +04:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2022-08-05 21:56:21.989 +04:00 [DBG] Executing DbCommand [Parameters=[p0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT b."CorrelationId", b."CurrentState", b."RequestId", b."ResponseAddress"
FROM (
    SELECT * FROM "public"."BuyItemsSagaState" WHERE "CorrelationId" = @p0 FOR UPDATE
) AS b
LIMIT 2
2022-08-05 21:56:22.002 +04:00 [INF] Executed DbCommand (13ms) [Parameters=[p0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT b."CorrelationId", b."CurrentState", b."RequestId", b."ResponseAddress"
FROM (
    SELECT * FROM "public"."BuyItemsSagaState" WHERE "CorrelationId" = @p0 FOR UPDATE
) AS b
LIMIT 2
2022-08-05 21:56:22.017 +04:00 [DBG] Context 'SagasDbContext' started tracking 'BuyItemsSagaState' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2022-08-05 21:56:22.020 +04:00 [DBG] A data reader was disposed.
2022-08-05 21:56:22.022 +04:00 [DBG] SAGA:BuyItemsSagaState:"3fa85f64-5717-4562-b3fc-2c963f66afa6" Used Contracts.IGetMoneyResponse
2022-08-05 21:56:22.052 +04:00 [DBG] SEND "rabbitmq://localhost/buy-items-saga-state" "e0330000-5df3-0015-4fd0-08da770bce93" MassTransit.Contracts.RequestTimeoutExpired<Contracts.IGetItemsRequest>
2022-08-05 21:56:22.060 +04:00 [DBG] An entity of type 'BuyItemsSagaState' tracked by 'SagasDbContext' changed state from '"Unchanged"' to '"Modified"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2022-08-05 21:56:22.063 +04:00 [DBG] SaveChanges starting for 'SagasDbContext'.
2022-08-05 21:56:22.065 +04:00 [DBG] DetectChanges starting for 'SagasDbContext'.
2022-08-05 21:56:22.066 +04:00 [DBG] DetectChanges completed for 'SagasDbContext'.
2022-08-05 21:56:22.068 +04:00 [DBG] Creating transaction savepoint.
2022-08-05 21:56:22.070 +04:00 [DBG] Created transaction savepoint.
2022-08-05 21:56:22.078 +04:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2022-08-05 21:56:22.080 +04:00 [DBG] Created DbCommand for 'ExecuteReader' (2ms).
2022-08-05 21:56:22.082 +04:00 [DBG] Executing DbCommand [Parameters=[@p3='?' (DbType = Guid), @p0='?', @p1='?' (DbType = Guid), @p2='?'], CommandType='"Text"', CommandTimeout='30']
UPDATE "BuyItemsSagaState" SET "CurrentState" = @p0, "RequestId" = @p1, "ResponseAddress" = @p2
WHERE "CorrelationId" = @p3;
2022-08-05 21:56:22.087 +04:00 [INF] Executed DbCommand (5ms) [Parameters=[@p3='?' (DbType = Guid), @p0='?', @p1='?' (DbType = Guid), @p2='?'], CommandType='"Text"', CommandTimeout='30']
UPDATE "BuyItemsSagaState" SET "CurrentState" = @p0, "RequestId" = @p1, "ResponseAddress" = @p2
WHERE "CorrelationId" = @p3;
2022-08-05 21:56:22.093 +04:00 [DBG] A data reader was disposed.
2022-08-05 21:56:22.094 +04:00 [DBG] Releasing transaction savepoint.
2022-08-05 21:56:22.096 +04:00 [DBG] Released transaction savepoint.
2022-08-05 21:56:22.098 +04:00 [DBG] An entity of type 'BuyItemsSagaState' tracked by 'SagasDbContext' changed state from '"Modified"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2022-08-05 21:56:22.102 +04:00 [DBG] SaveChanges completed for 'SagasDbContext' with 1 entities written to the database.
2022-08-05 21:56:22.105 +04:00 [DBG] Committing transaction.
2022-08-05 21:56:22.108 +04:00 [DBG] Committed transaction.
2022-08-05 21:56:22.110 +04:00 [DBG] Closing connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:56:22.112 +04:00 [DBG] Closed connection to database 'sagas_db' on server ''.
2022-08-05 21:56:22.115 +04:00 [DBG] Disposing transaction.
2022-08-05 21:56:22.116 +04:00 [DBG] 'SagasDbContext' disposed.
2022-08-05 21:56:22.119 +04:00 [DBG] RECEIVE "rabbitmq://localhost/buy-items-saga-state" "da210000-5df3-0015-e9ee-08da770bce60" Contracts.IGetMoneyResponse BuyItemsSagaState("00:00:00.2526214")
2022-08-05 21:56:22.129 +04:00 [DBG] Declare exchange: name: Contracts:IGetItemsRequest, type: fanout, durable
2022-08-05 21:56:22.153 +04:00 [DBG] SEND "rabbitmq://localhost/Contracts:IGetItemsRequest" "e0330000-5df3-0015-421e-08da770bcea1" Contracts.IGetItemsRequest
2022-08-05 21:56:22.832 +04:00 [INF] Entity Framework Core 6.0.3 initialized 'SagasDbContext' using provider 'Npgsql.EntityFrameworkCore.PostgreSQL:6.0.3+94d0a8eaeb9cf5af6ce55a9e59153c1a1be3244f' with options: None
2022-08-05 21:56:22.836 +04:00 [DBG] Opening connection to database 'sagas_db' on server ''.
2022-08-05 21:56:22.838 +04:00 [DBG] Opened connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:56:22.841 +04:00 [DBG] Beginning transaction with isolation level 'Serializable'.
2022-08-05 21:56:22.843 +04:00 [DBG] Began transaction with isolation level 'Serializable'.
2022-08-05 21:56:22.846 +04:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2022-08-05 21:56:22.847 +04:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2022-08-05 21:56:22.850 +04:00 [DBG] Executing DbCommand [Parameters=[p0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT b."CorrelationId", b."CurrentState", b."RequestId", b."ResponseAddress"
FROM (
    SELECT * FROM "public"."BuyItemsSagaState" WHERE "CorrelationId" = @p0 FOR UPDATE
) AS b
LIMIT 2
2022-08-05 21:56:22.855 +04:00 [INF] Executed DbCommand (4ms) [Parameters=[p0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT b."CorrelationId", b."CurrentState", b."RequestId", b."ResponseAddress"
FROM (
    SELECT * FROM "public"."BuyItemsSagaState" WHERE "CorrelationId" = @p0 FOR UPDATE
) AS b
LIMIT 2
2022-08-05 21:56:22.861 +04:00 [DBG] Context 'SagasDbContext' started tracking 'BuyItemsSagaState' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2022-08-05 21:56:22.863 +04:00 [DBG] A data reader was disposed.
2022-08-05 21:56:22.864 +04:00 [DBG] SAGA:BuyItemsSagaState:"3fa85f64-5717-4562-b3fc-2c963f66afa6" Used Contracts.IGetItemsResponse
2022-08-05 21:56:22.874 +04:00 [DBG] Create send transport: "rabbitmq://localhost:0/SMS2104090_ApiGateway_bus_5eooyyn76cybk44kbdp8qn71rz?temporary=true"
2022-08-05 21:56:22.879 +04:00 [DBG] An entity of type 'BuyItemsSagaState' tracked by 'SagasDbContext' changed state from '"Unchanged"' to '"Modified"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2022-08-05 21:56:22.881 +04:00 [DBG] SaveChanges starting for 'SagasDbContext'.
2022-08-05 21:56:22.882 +04:00 [DBG] DetectChanges starting for 'SagasDbContext'.
2022-08-05 21:56:22.883 +04:00 [DBG] DetectChanges completed for 'SagasDbContext'.
2022-08-05 21:56:22.884 +04:00 [DBG] Creating transaction savepoint.
2022-08-05 21:56:22.887 +04:00 [DBG] Created transaction savepoint.
2022-08-05 21:56:22.889 +04:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2022-08-05 21:56:22.890 +04:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2022-08-05 21:56:22.892 +04:00 [DBG] Executing DbCommand [Parameters=[@p3='?' (DbType = Guid), @p0='?', @p1='?' (DbType = Guid), @p2='?'], CommandType='"Text"', CommandTimeout='30']
UPDATE "BuyItemsSagaState" SET "CurrentState" = @p0, "RequestId" = @p1, "ResponseAddress" = @p2
WHERE "CorrelationId" = @p3;
2022-08-05 21:56:22.896 +04:00 [INF] Executed DbCommand (4ms) [Parameters=[@p3='?' (DbType = Guid), @p0='?', @p1='?' (DbType = Guid), @p2='?'], CommandType='"Text"', CommandTimeout='30']
UPDATE "BuyItemsSagaState" SET "CurrentState" = @p0, "RequestId" = @p1, "ResponseAddress" = @p2
WHERE "CorrelationId" = @p3;
2022-08-05 21:56:22.899 +04:00 [DBG] A data reader was disposed.
2022-08-05 21:56:22.900 +04:00 [DBG] Releasing transaction savepoint.
2022-08-05 21:56:22.901 +04:00 [DBG] Released transaction savepoint.
2022-08-05 21:56:22.902 +04:00 [DBG] An entity of type 'BuyItemsSagaState' tracked by 'SagasDbContext' changed state from '"Modified"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2022-08-05 21:56:22.904 +04:00 [DBG] SaveChanges completed for 'SagasDbContext' with 1 entities written to the database.
2022-08-05 21:56:22.907 +04:00 [DBG] Committing transaction.
2022-08-05 21:56:22.909 +04:00 [DBG] Committed transaction.
2022-08-05 21:56:22.910 +04:00 [DBG] Closing connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:56:22.911 +04:00 [DBG] Closed connection to database 'sagas_db' on server ''.
2022-08-05 21:56:22.913 +04:00 [DBG] Disposing transaction.
2022-08-05 21:56:22.914 +04:00 [DBG] 'SagasDbContext' disposed.
2022-08-05 21:56:22.916 +04:00 [DBG] RECEIVE "rabbitmq://localhost/buy-items-saga-state" "da210000-5df3-0015-4256-08da770bcef7" Contracts.IGetItemsResponse BuyItemsSagaState("00:00:00.0899195")
2022-08-05 21:56:22.919 +04:00 [DBG] Declare exchange: name: SMS2104090_ApiGateway_bus_5eooyyn76cybk44kbdp8qn71rz, type: fanout, auto-delete
2022-08-05 21:56:22.934 +04:00 [DBG] SEND "rabbitmq://localhost:0/SMS2104090_ApiGateway_bus_5eooyyn76cybk44kbdp8qn71rz?temporary=true" "e0330000-5df3-0015-4171-08da770bcf19" Contracts.BuyItemsResponse
2022-08-05 21:56:50.434 +04:00 [INF] Entity Framework Core 6.0.3 initialized 'SagasDbContext' using provider 'Npgsql.EntityFrameworkCore.PostgreSQL:6.0.3+94d0a8eaeb9cf5af6ce55a9e59153c1a1be3244f' with options: None
2022-08-05 21:56:50.435 +04:00 [DBG] Opening connection to database 'sagas_db' on server ''.
2022-08-05 21:56:50.436 +04:00 [DBG] Opened connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:56:50.438 +04:00 [DBG] Beginning transaction with isolation level 'Serializable'.
2022-08-05 21:56:50.439 +04:00 [DBG] Began transaction with isolation level 'Serializable'.
2022-08-05 21:56:50.440 +04:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2022-08-05 21:56:50.441 +04:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2022-08-05 21:56:50.443 +04:00 [DBG] Executing DbCommand [Parameters=[p0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT b."CorrelationId", b."CurrentState", b."RequestId", b."ResponseAddress"
FROM (
    SELECT * FROM "public"."BuyItemsSagaState" WHERE "CorrelationId" = @p0 FOR UPDATE
) AS b
LIMIT 2
2022-08-05 21:56:50.446 +04:00 [INF] Executed DbCommand (3ms) [Parameters=[p0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT b."CorrelationId", b."CurrentState", b."RequestId", b."ResponseAddress"
FROM (
    SELECT * FROM "public"."BuyItemsSagaState" WHERE "CorrelationId" = @p0 FOR UPDATE
) AS b
LIMIT 2
2022-08-05 21:56:50.448 +04:00 [DBG] Context 'SagasDbContext' started tracking 'BuyItemsSagaState' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2022-08-05 21:56:50.449 +04:00 [DBG] A data reader was disposed.
2022-08-05 21:56:50.450 +04:00 [DBG] SAGA:BuyItemsSagaState:"3fa85f64-5717-4562-b3fc-2c963f66afa6" Used MassTransit.Contracts.RequestTimeoutExpired<Contracts.IGetMoneyRequest>
2022-08-05 21:56:50.457 +04:00 [DBG] Rolling back transaction.
2022-08-05 21:56:50.464 +04:00 [DBG] Rolled back transaction.
2022-08-05 21:56:50.464 +04:00 [DBG] Closing connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:56:50.465 +04:00 [DBG] Closed connection to database 'sagas_db' on server ''.
2022-08-05 21:56:50.467 +04:00 [DBG] Disposing transaction.
2022-08-05 21:56:50.469 +04:00 [DBG] 'SagasDbContext' disposed.
2022-08-05 21:56:50.473 +04:00 [WRN] R-RETRY "rabbitmq://localhost/buy-items-saga-state" "e0330000-5df3-0015-2dac-08da770bcda6" MassTransit.RetryPolicies.RetryConsumeContext<MassTransit.Contracts.RequestTimeoutExpired<Contracts.IGetMoneyRequest>>
MassTransit.NotAcceptedStateMachineException: BuyItemsSagaState(3fa85f64-5717-4562-b3fc-2c963f66afa6) Saga exception on receipt of MassTransit.Contracts.RequestTimeoutExpired<Contracts.IGetMoneyRequest>: Not accepted in state Final
 ---> MassTransit.UnhandledEventException: The GetMoney.TimeoutExpired event is not handled during the Final state for the BuyItemsSaga state machine
   at MassTransit.MassTransitStateMachine`1.DefaultUnhandledEventCallback(UnhandledEventContext`1 context) in /_/src/MassTransit/SagaStateMachine/MassTransitStateMachine.cs:line 221
   at MassTransit.MassTransitStateMachine`1.UnhandledEvent(BehaviorContext`1 context, State state) in /_/src/MassTransit/SagaStateMachine/MassTransitStateMachine.cs:line 1288
   at MassTransit.MassTransitStateMachine`1.<.ctor>b__14_2(BehaviorContext`1 context, State state) in /_/src/MassTransit/SagaStateMachine/MassTransitStateMachine.cs:line 54
   at MassTransit.SagaStateMachine.StateMachineState`1.MassTransit.State<TSaga>.Raise[T](BehaviorContext`2 context) in /_/src/MassTransit/SagaStateMachine/SagaStateMachine/StateMachineState.cs:line 162
   at MassTransit.MassTransitStateMachine`1.MassTransit.StateMachine<TInstance>.RaiseEvent[T](BehaviorContext`2 context) in /_/src/MassTransit/SagaStateMachine/MassTransitStateMachine.cs:line 134
   at MassTransit.Middleware.StateMachineSagaMessageFilter`2.Send(SagaConsumeContext`2 context, IPipe`1 next) in /_/src/MassTransit/Middleware/StateMachineSagaMessageFilter.cs:line 60
   --- End of inner exception stack trace ---
   at MassTransit.Middleware.StateMachineSagaMessageFilter`2.Send(SagaConsumeContext`2 context, IPipe`1 next) in /_/src/MassTransit/Middleware/StateMachineSagaMessageFilter.cs:line 69
   at MassTransit.Middleware.StateMachineSagaMessageFilter`2.Send(SagaConsumeContext`2 context, IPipe`1 next) in /_/src/MassTransit/Middleware/StateMachineSagaMessageFilter.cs:line 74
   at MassTransit.Middleware.SendSagaPipe`2.Send(SagaRepositoryContext`2 context) in /_/src/MassTransit/Middleware/SendSagaPipe.cs:line 43
   at MassTransit.Middleware.SendSagaPipe`2.Send(SagaRepositoryContext`2 context) in /_/src/MassTransit/Middleware/SendSagaPipe.cs:line 67
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.<>c__DisplayClass5_0`1.<<Send>b__1>d.MoveNext() in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 56
--- End of stack trace from previous location ---
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.<>c__DisplayClass8_0.<<WithinTransaction>g__Create|0>d.MoveNext() in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 139
--- End of stack trace from previous location ---
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.WithinTransaction[T](DbContext context, CancellationToken cancellationToken, Func`1 callback) in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 164
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.WithinTransaction[T](DbContext context, CancellationToken cancellationToken, Func`1 callback) in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 183
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.WithinTransaction[T](DbContext context, CancellationToken cancellationToken, Func`1 callback) in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 183
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.Send[T](ConsumeContext`1 context, IPipe`1 next) in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 64
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.Send[T](ConsumeContext`1 context, IPipe`1 next) in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 68
   at MassTransit.DependencyInjection.DependencyInjectionSagaRepositoryContextFactory`1.<>c__DisplayClass6_0`1.<<Send>g__CreateScope|0>d.MoveNext() in /_/src/MassTransit/DependencyInjection/DependencyInjection/DependencyInjectionSagaRepositoryContextFactory.cs:line 84
--- End of stack trace from previous location ---
   at MassTransit.DependencyInjection.DependencyInjectionSagaRepositoryContextFactory`1.<>c__DisplayClass6_0`1.<<Send>g__CreateScope|0>d.MoveNext() in /_/src/MassTransit/DependencyInjection/DependencyInjection/DependencyInjectionSagaRepositoryContextFactory.cs:line 91
--- End of stack trace from previous location ---
   at MassTransit.Middleware.CorrelatedSagaFilter`2.MassTransit.IFilter<MassTransit.ConsumeContext<TMessage>>.Send(ConsumeContext`1 context, IPipe`1 next) in /_/src/MassTransit/Middleware/CorrelatedSagaFilter.cs:line 46
   at MassTransit.Middleware.CorrelatedSagaFilter`2.MassTransit.IFilter<MassTransit.ConsumeContext<TMessage>>.Send(ConsumeContext`1 context, IPipe`1 next) in /_/src/MassTransit/Middleware/CorrelatedSagaFilter.cs:line 64
   at MassTransit.Middleware.RetryFilter`1.MassTransit.IFilter<TContext>.Send(TContext context, IPipe`1 next) in /_/src/MassTransit/Middleware/RetryFilter.cs:line 47
2022-08-05 21:56:51.530 +04:00 [INF] Entity Framework Core 6.0.3 initialized 'SagasDbContext' using provider 'Npgsql.EntityFrameworkCore.PostgreSQL:6.0.3+94d0a8eaeb9cf5af6ce55a9e59153c1a1be3244f' with options: None
2022-08-05 21:56:51.533 +04:00 [DBG] Opening connection to database 'sagas_db' on server ''.
2022-08-05 21:56:51.534 +04:00 [DBG] Opened connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:56:51.535 +04:00 [DBG] Beginning transaction with isolation level 'Serializable'.
2022-08-05 21:56:51.535 +04:00 [DBG] Began transaction with isolation level 'Serializable'.
2022-08-05 21:56:51.536 +04:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2022-08-05 21:56:51.537 +04:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2022-08-05 21:56:51.538 +04:00 [DBG] Executing DbCommand [Parameters=[p0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT b."CorrelationId", b."CurrentState", b."RequestId", b."ResponseAddress"
FROM (
    SELECT * FROM "public"."BuyItemsSagaState" WHERE "CorrelationId" = @p0 FOR UPDATE
) AS b
LIMIT 2
2022-08-05 21:56:51.543 +04:00 [INF] Executed DbCommand (5ms) [Parameters=[p0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT b."CorrelationId", b."CurrentState", b."RequestId", b."ResponseAddress"
FROM (
    SELECT * FROM "public"."BuyItemsSagaState" WHERE "CorrelationId" = @p0 FOR UPDATE
) AS b
LIMIT 2
2022-08-05 21:56:51.545 +04:00 [DBG] Context 'SagasDbContext' started tracking 'BuyItemsSagaState' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2022-08-05 21:56:51.546 +04:00 [DBG] A data reader was disposed.
2022-08-05 21:56:51.547 +04:00 [DBG] SAGA:BuyItemsSagaState:"3fa85f64-5717-4562-b3fc-2c963f66afa6" Used MassTransit.Contracts.RequestTimeoutExpired<Contracts.IGetMoneyRequest>
2022-08-05 21:56:51.549 +04:00 [DBG] Rolling back transaction.
2022-08-05 21:56:51.550 +04:00 [DBG] Rolled back transaction.
2022-08-05 21:56:51.551 +04:00 [DBG] Closing connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:56:51.551 +04:00 [DBG] Closed connection to database 'sagas_db' on server ''.
2022-08-05 21:56:51.552 +04:00 [DBG] Disposing transaction.
2022-08-05 21:56:51.553 +04:00 [DBG] 'SagasDbContext' disposed.
2022-08-05 21:56:52.059 +04:00 [INF] Entity Framework Core 6.0.3 initialized 'SagasDbContext' using provider 'Npgsql.EntityFrameworkCore.PostgreSQL:6.0.3+94d0a8eaeb9cf5af6ce55a9e59153c1a1be3244f' with options: None
2022-08-05 21:56:52.060 +04:00 [DBG] Opening connection to database 'sagas_db' on server ''.
2022-08-05 21:56:52.061 +04:00 [DBG] Opened connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:56:52.062 +04:00 [DBG] Beginning transaction with isolation level 'Serializable'.
2022-08-05 21:56:52.062 +04:00 [DBG] Began transaction with isolation level 'Serializable'.
2022-08-05 21:56:52.063 +04:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2022-08-05 21:56:52.064 +04:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2022-08-05 21:56:52.064 +04:00 [DBG] Executing DbCommand [Parameters=[p0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT b."CorrelationId", b."CurrentState", b."RequestId", b."ResponseAddress"
FROM (
    SELECT * FROM "public"."BuyItemsSagaState" WHERE "CorrelationId" = @p0 FOR UPDATE
) AS b
LIMIT 2
2022-08-05 21:56:52.067 +04:00 [INF] Executed DbCommand (2ms) [Parameters=[p0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT b."CorrelationId", b."CurrentState", b."RequestId", b."ResponseAddress"
FROM (
    SELECT * FROM "public"."BuyItemsSagaState" WHERE "CorrelationId" = @p0 FOR UPDATE
) AS b
LIMIT 2
2022-08-05 21:56:52.068 +04:00 [DBG] Context 'SagasDbContext' started tracking 'BuyItemsSagaState' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2022-08-05 21:56:52.069 +04:00 [DBG] A data reader was disposed.
2022-08-05 21:56:52.070 +04:00 [DBG] SAGA:BuyItemsSagaState:"3fa85f64-5717-4562-b3fc-2c963f66afa6" Used MassTransit.Contracts.RequestTimeoutExpired<Contracts.IGetItemsRequest>
2022-08-05 21:56:52.072 +04:00 [DBG] Rolling back transaction.
2022-08-05 21:56:52.073 +04:00 [DBG] Rolled back transaction.
2022-08-05 21:56:52.074 +04:00 [DBG] Closing connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:56:52.074 +04:00 [DBG] Closed connection to database 'sagas_db' on server ''.
2022-08-05 21:56:52.075 +04:00 [DBG] Disposing transaction.
2022-08-05 21:56:52.076 +04:00 [DBG] 'SagasDbContext' disposed.
2022-08-05 21:56:52.078 +04:00 [WRN] R-RETRY "rabbitmq://localhost/buy-items-saga-state" "e0330000-5df3-0015-4fd0-08da770bce93" MassTransit.RetryPolicies.RetryConsumeContext<MassTransit.Contracts.RequestTimeoutExpired<Contracts.IGetItemsRequest>>
MassTransit.NotAcceptedStateMachineException: BuyItemsSagaState(3fa85f64-5717-4562-b3fc-2c963f66afa6) Saga exception on receipt of MassTransit.Contracts.RequestTimeoutExpired<Contracts.IGetItemsRequest>: Not accepted in state Final
 ---> MassTransit.UnhandledEventException: The GetItems.TimeoutExpired event is not handled during the Final state for the BuyItemsSaga state machine
   at MassTransit.MassTransitStateMachine`1.DefaultUnhandledEventCallback(UnhandledEventContext`1 context) in /_/src/MassTransit/SagaStateMachine/MassTransitStateMachine.cs:line 221
   at MassTransit.MassTransitStateMachine`1.UnhandledEvent(BehaviorContext`1 context, State state) in /_/src/MassTransit/SagaStateMachine/MassTransitStateMachine.cs:line 1288
   at MassTransit.MassTransitStateMachine`1.<.ctor>b__14_2(BehaviorContext`1 context, State state) in /_/src/MassTransit/SagaStateMachine/MassTransitStateMachine.cs:line 54
   at MassTransit.SagaStateMachine.StateMachineState`1.MassTransit.State<TSaga>.Raise[T](BehaviorContext`2 context) in /_/src/MassTransit/SagaStateMachine/SagaStateMachine/StateMachineState.cs:line 162
   at MassTransit.MassTransitStateMachine`1.MassTransit.StateMachine<TInstance>.RaiseEvent[T](BehaviorContext`2 context) in /_/src/MassTransit/SagaStateMachine/MassTransitStateMachine.cs:line 134
   at MassTransit.Middleware.StateMachineSagaMessageFilter`2.Send(SagaConsumeContext`2 context, IPipe`1 next) in /_/src/MassTransit/Middleware/StateMachineSagaMessageFilter.cs:line 60
   --- End of inner exception stack trace ---
   at MassTransit.Middleware.StateMachineSagaMessageFilter`2.Send(SagaConsumeContext`2 context, IPipe`1 next) in /_/src/MassTransit/Middleware/StateMachineSagaMessageFilter.cs:line 69
   at MassTransit.Middleware.StateMachineSagaMessageFilter`2.Send(SagaConsumeContext`2 context, IPipe`1 next) in /_/src/MassTransit/Middleware/StateMachineSagaMessageFilter.cs:line 74
   at MassTransit.Middleware.SendSagaPipe`2.Send(SagaRepositoryContext`2 context) in /_/src/MassTransit/Middleware/SendSagaPipe.cs:line 43
   at MassTransit.Middleware.SendSagaPipe`2.Send(SagaRepositoryContext`2 context) in /_/src/MassTransit/Middleware/SendSagaPipe.cs:line 67
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.<>c__DisplayClass5_0`1.<<Send>b__1>d.MoveNext() in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 56
--- End of stack trace from previous location ---
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.<>c__DisplayClass8_0.<<WithinTransaction>g__Create|0>d.MoveNext() in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 139
--- End of stack trace from previous location ---
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.WithinTransaction[T](DbContext context, CancellationToken cancellationToken, Func`1 callback) in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 164
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.WithinTransaction[T](DbContext context, CancellationToken cancellationToken, Func`1 callback) in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 183
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.WithinTransaction[T](DbContext context, CancellationToken cancellationToken, Func`1 callback) in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 183
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.Send[T](ConsumeContext`1 context, IPipe`1 next) in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 64
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.Send[T](ConsumeContext`1 context, IPipe`1 next) in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 68
   at MassTransit.DependencyInjection.DependencyInjectionSagaRepositoryContextFactory`1.<>c__DisplayClass6_0`1.<<Send>g__CreateScope|0>d.MoveNext() in /_/src/MassTransit/DependencyInjection/DependencyInjection/DependencyInjectionSagaRepositoryContextFactory.cs:line 84
--- End of stack trace from previous location ---
   at MassTransit.DependencyInjection.DependencyInjectionSagaRepositoryContextFactory`1.<>c__DisplayClass6_0`1.<<Send>g__CreateScope|0>d.MoveNext() in /_/src/MassTransit/DependencyInjection/DependencyInjection/DependencyInjectionSagaRepositoryContextFactory.cs:line 91
--- End of stack trace from previous location ---
   at MassTransit.Middleware.CorrelatedSagaFilter`2.MassTransit.IFilter<MassTransit.ConsumeContext<TMessage>>.Send(ConsumeContext`1 context, IPipe`1 next) in /_/src/MassTransit/Middleware/CorrelatedSagaFilter.cs:line 46
   at MassTransit.Middleware.CorrelatedSagaFilter`2.MassTransit.IFilter<MassTransit.ConsumeContext<TMessage>>.Send(ConsumeContext`1 context, IPipe`1 next) in /_/src/MassTransit/Middleware/CorrelatedSagaFilter.cs:line 64
   at MassTransit.Middleware.RetryFilter`1.MassTransit.IFilter<TContext>.Send(TContext context, IPipe`1 next) in /_/src/MassTransit/Middleware/RetryFilter.cs:line 47
2022-08-05 21:56:53.099 +04:00 [INF] Entity Framework Core 6.0.3 initialized 'SagasDbContext' using provider 'Npgsql.EntityFrameworkCore.PostgreSQL:6.0.3+94d0a8eaeb9cf5af6ce55a9e59153c1a1be3244f' with options: None
2022-08-05 21:56:53.101 +04:00 [DBG] Opening connection to database 'sagas_db' on server ''.
2022-08-05 21:56:53.102 +04:00 [DBG] Opened connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:56:53.103 +04:00 [DBG] Beginning transaction with isolation level 'Serializable'.
2022-08-05 21:56:53.103 +04:00 [DBG] Began transaction with isolation level 'Serializable'.
2022-08-05 21:56:53.104 +04:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2022-08-05 21:56:53.105 +04:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2022-08-05 21:56:53.106 +04:00 [DBG] Executing DbCommand [Parameters=[p0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT b."CorrelationId", b."CurrentState", b."RequestId", b."ResponseAddress"
FROM (
    SELECT * FROM "public"."BuyItemsSagaState" WHERE "CorrelationId" = @p0 FOR UPDATE
) AS b
LIMIT 2
2022-08-05 21:56:53.108 +04:00 [INF] Executed DbCommand (2ms) [Parameters=[p0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT b."CorrelationId", b."CurrentState", b."RequestId", b."ResponseAddress"
FROM (
    SELECT * FROM "public"."BuyItemsSagaState" WHERE "CorrelationId" = @p0 FOR UPDATE
) AS b
LIMIT 2
2022-08-05 21:56:53.110 +04:00 [DBG] Context 'SagasDbContext' started tracking 'BuyItemsSagaState' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2022-08-05 21:56:53.111 +04:00 [DBG] A data reader was disposed.
2022-08-05 21:56:53.112 +04:00 [DBG] SAGA:BuyItemsSagaState:"3fa85f64-5717-4562-b3fc-2c963f66afa6" Used MassTransit.Contracts.RequestTimeoutExpired<Contracts.IGetItemsRequest>
2022-08-05 21:56:53.114 +04:00 [DBG] Rolling back transaction.
2022-08-05 21:56:53.116 +04:00 [DBG] Rolled back transaction.
2022-08-05 21:56:53.116 +04:00 [DBG] Closing connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:56:53.117 +04:00 [DBG] Closed connection to database 'sagas_db' on server ''.
2022-08-05 21:56:53.118 +04:00 [DBG] Disposing transaction.
2022-08-05 21:56:53.119 +04:00 [DBG] 'SagasDbContext' disposed.
2022-08-05 21:56:53.565 +04:00 [INF] Entity Framework Core 6.0.3 initialized 'SagasDbContext' using provider 'Npgsql.EntityFrameworkCore.PostgreSQL:6.0.3+94d0a8eaeb9cf5af6ce55a9e59153c1a1be3244f' with options: None
2022-08-05 21:56:53.569 +04:00 [DBG] Opening connection to database 'sagas_db' on server ''.
2022-08-05 21:56:53.569 +04:00 [DBG] Opened connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:56:53.570 +04:00 [DBG] Beginning transaction with isolation level 'Serializable'.
2022-08-05 21:56:53.572 +04:00 [DBG] Began transaction with isolation level 'Serializable'.
2022-08-05 21:56:53.573 +04:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2022-08-05 21:56:53.573 +04:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2022-08-05 21:56:53.574 +04:00 [DBG] Executing DbCommand [Parameters=[p0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT b."CorrelationId", b."CurrentState", b."RequestId", b."ResponseAddress"
FROM (
    SELECT * FROM "public"."BuyItemsSagaState" WHERE "CorrelationId" = @p0 FOR UPDATE
) AS b
LIMIT 2
2022-08-05 21:56:53.577 +04:00 [INF] Executed DbCommand (2ms) [Parameters=[p0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT b."CorrelationId", b."CurrentState", b."RequestId", b."ResponseAddress"
FROM (
    SELECT * FROM "public"."BuyItemsSagaState" WHERE "CorrelationId" = @p0 FOR UPDATE
) AS b
LIMIT 2
2022-08-05 21:56:53.578 +04:00 [DBG] Context 'SagasDbContext' started tracking 'BuyItemsSagaState' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2022-08-05 21:56:53.579 +04:00 [DBG] A data reader was disposed.
2022-08-05 21:56:53.580 +04:00 [DBG] SAGA:BuyItemsSagaState:"3fa85f64-5717-4562-b3fc-2c963f66afa6" Used MassTransit.Contracts.RequestTimeoutExpired<Contracts.IGetMoneyRequest>
2022-08-05 21:56:53.582 +04:00 [DBG] Rolling back transaction.
2022-08-05 21:56:53.583 +04:00 [DBG] Rolled back transaction.
2022-08-05 21:56:53.584 +04:00 [DBG] Closing connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:56:53.585 +04:00 [DBG] Closed connection to database 'sagas_db' on server ''.
2022-08-05 21:56:53.585 +04:00 [DBG] Disposing transaction.
2022-08-05 21:56:53.586 +04:00 [DBG] 'SagasDbContext' disposed.
2022-08-05 21:56:55.135 +04:00 [INF] Entity Framework Core 6.0.3 initialized 'SagasDbContext' using provider 'Npgsql.EntityFrameworkCore.PostgreSQL:6.0.3+94d0a8eaeb9cf5af6ce55a9e59153c1a1be3244f' with options: None
2022-08-05 21:56:55.140 +04:00 [DBG] Opening connection to database 'sagas_db' on server ''.
2022-08-05 21:56:55.141 +04:00 [DBG] Opened connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:56:55.142 +04:00 [DBG] Beginning transaction with isolation level 'Serializable'.
2022-08-05 21:56:55.143 +04:00 [DBG] Began transaction with isolation level 'Serializable'.
2022-08-05 21:56:55.144 +04:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2022-08-05 21:56:55.146 +04:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2022-08-05 21:56:55.147 +04:00 [DBG] Executing DbCommand [Parameters=[p0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT b."CorrelationId", b."CurrentState", b."RequestId", b."ResponseAddress"
FROM (
    SELECT * FROM "public"."BuyItemsSagaState" WHERE "CorrelationId" = @p0 FOR UPDATE
) AS b
LIMIT 2
2022-08-05 21:56:55.149 +04:00 [INF] Executed DbCommand (2ms) [Parameters=[p0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT b."CorrelationId", b."CurrentState", b."RequestId", b."ResponseAddress"
FROM (
    SELECT * FROM "public"."BuyItemsSagaState" WHERE "CorrelationId" = @p0 FOR UPDATE
) AS b
LIMIT 2
2022-08-05 21:56:55.151 +04:00 [DBG] Context 'SagasDbContext' started tracking 'BuyItemsSagaState' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2022-08-05 21:56:55.152 +04:00 [DBG] A data reader was disposed.
2022-08-05 21:56:55.153 +04:00 [DBG] SAGA:BuyItemsSagaState:"3fa85f64-5717-4562-b3fc-2c963f66afa6" Used MassTransit.Contracts.RequestTimeoutExpired<Contracts.IGetItemsRequest>
2022-08-05 21:56:55.155 +04:00 [DBG] Rolling back transaction.
2022-08-05 21:56:55.157 +04:00 [DBG] Rolled back transaction.
2022-08-05 21:56:55.157 +04:00 [DBG] Closing connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:56:55.158 +04:00 [DBG] Closed connection to database 'sagas_db' on server ''.
2022-08-05 21:56:55.159 +04:00 [DBG] Disposing transaction.
2022-08-05 21:56:55.160 +04:00 [DBG] 'SagasDbContext' disposed.
2022-08-05 21:56:56.609 +04:00 [INF] Entity Framework Core 6.0.3 initialized 'SagasDbContext' using provider 'Npgsql.EntityFrameworkCore.PostgreSQL:6.0.3+94d0a8eaeb9cf5af6ce55a9e59153c1a1be3244f' with options: None
2022-08-05 21:56:56.614 +04:00 [DBG] Opening connection to database 'sagas_db' on server ''.
2022-08-05 21:56:56.615 +04:00 [DBG] Opened connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:56:56.616 +04:00 [DBG] Beginning transaction with isolation level 'Serializable'.
2022-08-05 21:56:56.617 +04:00 [DBG] Began transaction with isolation level 'Serializable'.
2022-08-05 21:56:56.618 +04:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2022-08-05 21:56:56.618 +04:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2022-08-05 21:56:56.619 +04:00 [DBG] Executing DbCommand [Parameters=[p0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT b."CorrelationId", b."CurrentState", b."RequestId", b."ResponseAddress"
FROM (
    SELECT * FROM "public"."BuyItemsSagaState" WHERE "CorrelationId" = @p0 FOR UPDATE
) AS b
LIMIT 2
2022-08-05 21:56:56.622 +04:00 [INF] Executed DbCommand (2ms) [Parameters=[p0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT b."CorrelationId", b."CurrentState", b."RequestId", b."ResponseAddress"
FROM (
    SELECT * FROM "public"."BuyItemsSagaState" WHERE "CorrelationId" = @p0 FOR UPDATE
) AS b
LIMIT 2
2022-08-05 21:56:56.625 +04:00 [DBG] Context 'SagasDbContext' started tracking 'BuyItemsSagaState' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2022-08-05 21:56:56.627 +04:00 [DBG] A data reader was disposed.
2022-08-05 21:56:56.627 +04:00 [DBG] SAGA:BuyItemsSagaState:"3fa85f64-5717-4562-b3fc-2c963f66afa6" Used MassTransit.Contracts.RequestTimeoutExpired<Contracts.IGetMoneyRequest>
2022-08-05 21:56:56.630 +04:00 [DBG] Rolling back transaction.
2022-08-05 21:56:56.631 +04:00 [DBG] Rolled back transaction.
2022-08-05 21:56:56.632 +04:00 [DBG] Closing connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:56:56.633 +04:00 [DBG] Closed connection to database 'sagas_db' on server ''.
2022-08-05 21:56:56.633 +04:00 [DBG] Disposing transaction.
2022-08-05 21:56:56.634 +04:00 [DBG] 'SagasDbContext' disposed.
2022-08-05 21:56:56.663 +04:00 [DBG] Declare exchange: name: MassTransit:Fault--MassTransit.Contracts:RequestTimeoutExpired--Contracts:IGetMoneyRequest----, type: fanout, durable
2022-08-05 21:56:56.677 +04:00 [DBG] Declare exchange: name: MassTransit:Fault, type: fanout, durable
2022-08-05 21:56:56.679 +04:00 [DBG] Bind exchange: source: MassTransit:Fault--MassTransit.Contracts:RequestTimeoutExpired--Contracts:IGetMoneyRequest----, destination: MassTransit:Fault
2022-08-05 21:56:56.762 +04:00 [DBG] SEND "rabbitmq://localhost/MassTransit:Fault--MassTransit.Contracts:RequestTimeoutExpired--Contracts:IGetMoneyRequest----" "e0330000-5df3-0015-7a91-08da770be33b" MassTransit.Fault<MassTransit.Contracts.RequestTimeoutExpired<Contracts.IGetMoneyRequest>>
2022-08-05 21:56:56.766 +04:00 [ERR] R-FAULT "rabbitmq://localhost/buy-items-saga-state" "e0330000-5df3-0015-2dac-08da770bcda6" MassTransit.Contracts.RequestTimeoutExpired<Contracts.IGetMoneyRequest> BuyItemsSagaState("00:00:00.0277027")
MassTransit.NotAcceptedStateMachineException: BuyItemsSagaState(3fa85f64-5717-4562-b3fc-2c963f66afa6) Saga exception on receipt of MassTransit.Contracts.RequestTimeoutExpired<Contracts.IGetMoneyRequest>: Not accepted in state Final
 ---> MassTransit.UnhandledEventException: The GetMoney.TimeoutExpired event is not handled during the Final state for the BuyItemsSaga state machine
   at MassTransit.MassTransitStateMachine`1.DefaultUnhandledEventCallback(UnhandledEventContext`1 context) in /_/src/MassTransit/SagaStateMachine/MassTransitStateMachine.cs:line 221
   at MassTransit.MassTransitStateMachine`1.UnhandledEvent(BehaviorContext`1 context, State state) in /_/src/MassTransit/SagaStateMachine/MassTransitStateMachine.cs:line 1288
   at MassTransit.MassTransitStateMachine`1.<.ctor>b__14_2(BehaviorContext`1 context, State state) in /_/src/MassTransit/SagaStateMachine/MassTransitStateMachine.cs:line 54
   at MassTransit.SagaStateMachine.StateMachineState`1.MassTransit.State<TSaga>.Raise[T](BehaviorContext`2 context) in /_/src/MassTransit/SagaStateMachine/SagaStateMachine/StateMachineState.cs:line 162
   at MassTransit.MassTransitStateMachine`1.MassTransit.StateMachine<TInstance>.RaiseEvent[T](BehaviorContext`2 context) in /_/src/MassTransit/SagaStateMachine/MassTransitStateMachine.cs:line 134
   at MassTransit.Middleware.StateMachineSagaMessageFilter`2.Send(SagaConsumeContext`2 context, IPipe`1 next) in /_/src/MassTransit/Middleware/StateMachineSagaMessageFilter.cs:line 60
   --- End of inner exception stack trace ---
   at MassTransit.Middleware.StateMachineSagaMessageFilter`2.Send(SagaConsumeContext`2 context, IPipe`1 next) in /_/src/MassTransit/Middleware/StateMachineSagaMessageFilter.cs:line 69
   at MassTransit.Middleware.StateMachineSagaMessageFilter`2.Send(SagaConsumeContext`2 context, IPipe`1 next) in /_/src/MassTransit/Middleware/StateMachineSagaMessageFilter.cs:line 74
   at MassTransit.Middleware.SendSagaPipe`2.Send(SagaRepositoryContext`2 context) in /_/src/MassTransit/Middleware/SendSagaPipe.cs:line 43
   at MassTransit.Middleware.SendSagaPipe`2.Send(SagaRepositoryContext`2 context) in /_/src/MassTransit/Middleware/SendSagaPipe.cs:line 67
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.<>c__DisplayClass5_0`1.<<Send>b__1>d.MoveNext() in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 56
--- End of stack trace from previous location ---
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.<>c__DisplayClass8_0.<<WithinTransaction>g__Create|0>d.MoveNext() in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 139
--- End of stack trace from previous location ---
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.WithinTransaction[T](DbContext context, CancellationToken cancellationToken, Func`1 callback) in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 164
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.WithinTransaction[T](DbContext context, CancellationToken cancellationToken, Func`1 callback) in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 183
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.WithinTransaction[T](DbContext context, CancellationToken cancellationToken, Func`1 callback) in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 183
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.Send[T](ConsumeContext`1 context, IPipe`1 next) in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 64
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.Send[T](ConsumeContext`1 context, IPipe`1 next) in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 68
   at MassTransit.DependencyInjection.DependencyInjectionSagaRepositoryContextFactory`1.<>c__DisplayClass6_0`1.<<Send>g__CreateScope|0>d.MoveNext() in /_/src/MassTransit/DependencyInjection/DependencyInjection/DependencyInjectionSagaRepositoryContextFactory.cs:line 84
--- End of stack trace from previous location ---
   at MassTransit.DependencyInjection.DependencyInjectionSagaRepositoryContextFactory`1.<>c__DisplayClass6_0`1.<<Send>g__CreateScope|0>d.MoveNext() in /_/src/MassTransit/DependencyInjection/DependencyInjection/DependencyInjectionSagaRepositoryContextFactory.cs:line 91
--- End of stack trace from previous location ---
   at MassTransit.Middleware.CorrelatedSagaFilter`2.MassTransit.IFilter<MassTransit.ConsumeContext<TMessage>>.Send(ConsumeContext`1 context, IPipe`1 next) in /_/src/MassTransit/Middleware/CorrelatedSagaFilter.cs:line 46
   at MassTransit.Middleware.CorrelatedSagaFilter`2.MassTransit.IFilter<MassTransit.ConsumeContext<TMessage>>.Send(ConsumeContext`1 context, IPipe`1 next) in /_/src/MassTransit/Middleware/CorrelatedSagaFilter.cs:line 64
   at MassTransit.Middleware.RetryFilter`1.Attempt(TContext context, RetryContext`1 retryContext, IPipe`1 next) in /_/src/MassTransit/Middleware/RetryFilter.cs:line 158
2022-08-05 21:56:56.785 +04:00 [DBG] Declare queue: name: buy-items-saga-state_error, durable, consumer-count: 0 message-count: 3
2022-08-05 21:56:56.810 +04:00 [DBG] Declare exchange: name: buy-items-saga-state_error, type: fanout, durable
2022-08-05 21:56:56.812 +04:00 [DBG] Bind queue: source: buy-items-saga-state_error, destination: buy-items-saga-state_error
2022-08-05 21:56:58.176 +04:00 [INF] Entity Framework Core 6.0.3 initialized 'SagasDbContext' using provider 'Npgsql.EntityFrameworkCore.PostgreSQL:6.0.3+94d0a8eaeb9cf5af6ce55a9e59153c1a1be3244f' with options: None
2022-08-05 21:56:58.183 +04:00 [DBG] Opening connection to database 'sagas_db' on server ''.
2022-08-05 21:56:58.184 +04:00 [DBG] Opened connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:56:58.184 +04:00 [DBG] Beginning transaction with isolation level 'Serializable'.
2022-08-05 21:56:58.185 +04:00 [DBG] Began transaction with isolation level 'Serializable'.
2022-08-05 21:56:58.186 +04:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2022-08-05 21:56:58.188 +04:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2022-08-05 21:56:58.189 +04:00 [DBG] Executing DbCommand [Parameters=[p0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT b."CorrelationId", b."CurrentState", b."RequestId", b."ResponseAddress"
FROM (
    SELECT * FROM "public"."BuyItemsSagaState" WHERE "CorrelationId" = @p0 FOR UPDATE
) AS b
LIMIT 2
2022-08-05 21:56:58.191 +04:00 [INF] Executed DbCommand (2ms) [Parameters=[p0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT b."CorrelationId", b."CurrentState", b."RequestId", b."ResponseAddress"
FROM (
    SELECT * FROM "public"."BuyItemsSagaState" WHERE "CorrelationId" = @p0 FOR UPDATE
) AS b
LIMIT 2
2022-08-05 21:56:58.193 +04:00 [DBG] Context 'SagasDbContext' started tracking 'BuyItemsSagaState' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2022-08-05 21:56:58.194 +04:00 [DBG] A data reader was disposed.
2022-08-05 21:56:58.195 +04:00 [DBG] SAGA:BuyItemsSagaState:"3fa85f64-5717-4562-b3fc-2c963f66afa6" Used MassTransit.Contracts.RequestTimeoutExpired<Contracts.IGetItemsRequest>
2022-08-05 21:56:58.197 +04:00 [DBG] Rolling back transaction.
2022-08-05 21:56:58.198 +04:00 [DBG] Rolled back transaction.
2022-08-05 21:56:58.198 +04:00 [DBG] Closing connection to database 'sagas_db' on server 'tcp://localhost:5432'.
2022-08-05 21:56:58.199 +04:00 [DBG] Closed connection to database 'sagas_db' on server ''.
2022-08-05 21:56:58.200 +04:00 [DBG] Disposing transaction.
2022-08-05 21:56:58.201 +04:00 [DBG] 'SagasDbContext' disposed.
2022-08-05 21:56:58.206 +04:00 [DBG] Declare exchange: name: MassTransit:Fault--MassTransit.Contracts:RequestTimeoutExpired--Contracts:IGetItemsRequest----, type: fanout, durable
2022-08-05 21:56:58.207 +04:00 [DBG] Declare exchange: name: MassTransit:Fault, type: fanout, durable
2022-08-05 21:56:58.209 +04:00 [DBG] Bind exchange: source: MassTransit:Fault--MassTransit.Contracts:RequestTimeoutExpired--Contracts:IGetItemsRequest----, destination: MassTransit:Fault
2022-08-05 21:56:58.294 +04:00 [DBG] SEND "rabbitmq://localhost/MassTransit:Fault--MassTransit.Contracts:RequestTimeoutExpired--Contracts:IGetItemsRequest----" "e0330000-5df3-0015-eb4f-08da770be425" MassTransit.Fault<MassTransit.Contracts.RequestTimeoutExpired<Contracts.IGetItemsRequest>>
2022-08-05 21:56:58.298 +04:00 [ERR] R-FAULT "rabbitmq://localhost/buy-items-saga-state" "e0330000-5df3-0015-4fd0-08da770bce93" MassTransit.Contracts.RequestTimeoutExpired<Contracts.IGetItemsRequest> BuyItemsSagaState("00:00:00.0266153")
MassTransit.NotAcceptedStateMachineException: BuyItemsSagaState(3fa85f64-5717-4562-b3fc-2c963f66afa6) Saga exception on receipt of MassTransit.Contracts.RequestTimeoutExpired<Contracts.IGetItemsRequest>: Not accepted in state Final
 ---> MassTransit.UnhandledEventException: The GetItems.TimeoutExpired event is not handled during the Final state for the BuyItemsSaga state machine
   at MassTransit.MassTransitStateMachine`1.DefaultUnhandledEventCallback(UnhandledEventContext`1 context) in /_/src/MassTransit/SagaStateMachine/MassTransitStateMachine.cs:line 221
   at MassTransit.MassTransitStateMachine`1.UnhandledEvent(BehaviorContext`1 context, State state) in /_/src/MassTransit/SagaStateMachine/MassTransitStateMachine.cs:line 1288
   at MassTransit.MassTransitStateMachine`1.<.ctor>b__14_2(BehaviorContext`1 context, State state) in /_/src/MassTransit/SagaStateMachine/MassTransitStateMachine.cs:line 54
   at MassTransit.SagaStateMachine.StateMachineState`1.MassTransit.State<TSaga>.Raise[T](BehaviorContext`2 context) in /_/src/MassTransit/SagaStateMachine/SagaStateMachine/StateMachineState.cs:line 162
   at MassTransit.MassTransitStateMachine`1.MassTransit.StateMachine<TInstance>.RaiseEvent[T](BehaviorContext`2 context) in /_/src/MassTransit/SagaStateMachine/MassTransitStateMachine.cs:line 134
   at MassTransit.Middleware.StateMachineSagaMessageFilter`2.Send(SagaConsumeContext`2 context, IPipe`1 next) in /_/src/MassTransit/Middleware/StateMachineSagaMessageFilter.cs:line 60
   --- End of inner exception stack trace ---
   at MassTransit.Middleware.StateMachineSagaMessageFilter`2.Send(SagaConsumeContext`2 context, IPipe`1 next) in /_/src/MassTransit/Middleware/StateMachineSagaMessageFilter.cs:line 69
   at MassTransit.Middleware.StateMachineSagaMessageFilter`2.Send(SagaConsumeContext`2 context, IPipe`1 next) in /_/src/MassTransit/Middleware/StateMachineSagaMessageFilter.cs:line 74
   at MassTransit.Middleware.SendSagaPipe`2.Send(SagaRepositoryContext`2 context) in /_/src/MassTransit/Middleware/SendSagaPipe.cs:line 43
   at MassTransit.Middleware.SendSagaPipe`2.Send(SagaRepositoryContext`2 context) in /_/src/MassTransit/Middleware/SendSagaPipe.cs:line 67
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.<>c__DisplayClass5_0`1.<<Send>b__1>d.MoveNext() in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 56
--- End of stack trace from previous location ---
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.<>c__DisplayClass8_0.<<WithinTransaction>g__Create|0>d.MoveNext() in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 139
--- End of stack trace from previous location ---
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.WithinTransaction[T](DbContext context, CancellationToken cancellationToken, Func`1 callback) in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 164
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.WithinTransaction[T](DbContext context, CancellationToken cancellationToken, Func`1 callback) in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 183
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.WithinTransaction[T](DbContext context, CancellationToken cancellationToken, Func`1 callback) in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 183
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.Send[T](ConsumeContext`1 context, IPipe`1 next) in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 64
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.Send[T](ConsumeContext`1 context, IPipe`1 next) in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 68
   at MassTransit.DependencyInjection.DependencyInjectionSagaRepositoryContextFactory`1.<>c__DisplayClass6_0`1.<<Send>g__CreateScope|0>d.MoveNext() in /_/src/MassTransit/DependencyInjection/DependencyInjection/DependencyInjectionSagaRepositoryContextFactory.cs:line 84
--- End of stack trace from previous location ---
   at MassTransit.DependencyInjection.DependencyInjectionSagaRepositoryContextFactory`1.<>c__DisplayClass6_0`1.<<Send>g__CreateScope|0>d.MoveNext() in /_/src/MassTransit/DependencyInjection/DependencyInjection/DependencyInjectionSagaRepositoryContextFactory.cs:line 91
--- End of stack trace from previous location ---
   at MassTransit.Middleware.CorrelatedSagaFilter`2.MassTransit.IFilter<MassTransit.ConsumeContext<TMessage>>.Send(ConsumeContext`1 context, IPipe`1 next) in /_/src/MassTransit/Middleware/CorrelatedSagaFilter.cs:line 46
   at MassTransit.Middleware.CorrelatedSagaFilter`2.MassTransit.IFilter<MassTransit.ConsumeContext<TMessage>>.Send(ConsumeContext`1 context, IPipe`1 next) in /_/src/MassTransit/Middleware/CorrelatedSagaFilter.cs:line 64
   at MassTransit.Middleware.RetryFilter`1.Attempt(TContext context, RetryContext`1 retryContext, IPipe`1 next) in /_/src/MassTransit/Middleware/RetryFilter.cs:line 158
2022-08-05 21:57:45.084 +04:00 [DBG] Connection id "0HMJN1ESQTA0U" received FIN.
2022-08-05 21:57:45.089 +04:00 [DBG] Connection id "0HMJN1ESQTA0U" sending FIN because: "The client closed the connection."
2022-08-05 21:57:45.095 +04:00 [DBG] Connection id "0HMJN1ESQTA0U" disconnecting.
2022-08-05 21:57:45.096 +04:00 [DBG] Connection id "0HMJN1ESQTA0U" stopped.
2022-08-05 22:06:18.493 +04:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2022-08-05 22:06:20.894 +04:00 [INF] Entity Framework Core 6.0.3 initialized 'SagasDbContext' using provider 'Npgsql.EntityFrameworkCore.PostgreSQL:6.0.3+94d0a8eaeb9cf5af6ce55a9e59153c1a1be3244f' with options: None
2022-08-05 22:06:21.020 +04:00 [DBG] Opening connection to database 'sagas_db' on server ''.
2022-08-05 22:06:24.151 +04:00 [DBG] An error occurred using the connection to database 'sagas_db' on server ''.
2022-08-05 22:06:24.183 +04:00 [DBG] Opening connection to database 'postgres' on server ''.
2022-08-05 22:06:24.303 +04:00 [DBG] Opened connection to database 'postgres' on server 'tcp://localhost:3462'.
2022-08-05 22:06:24.316 +04:00 [DBG] Creating DbCommand for 'ExecuteNonQuery'.
2022-08-05 22:06:24.327 +04:00 [DBG] Created DbCommand for 'ExecuteNonQuery' (8ms).
2022-08-05 22:06:24.338 +04:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE DATABASE sagas_db;
2022-08-05 22:06:24.712 +04:00 [INF] Executed DbCommand (369ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE DATABASE sagas_db;
2022-08-05 22:06:24.719 +04:00 [DBG] Closing connection to database 'postgres' on server 'tcp://localhost:3462'.
2022-08-05 22:06:24.726 +04:00 [DBG] Closed connection to database 'postgres' on server ''.
2022-08-05 22:06:24.732 +04:00 [DBG] Opening connection to database 'sagas_db' on server ''.
2022-08-05 22:06:24.786 +04:00 [DBG] Opened connection to database 'sagas_db' on server 'tcp://localhost:3462'.
2022-08-05 22:06:24.788 +04:00 [DBG] Closing connection to database 'sagas_db' on server 'tcp://localhost:3462'.
2022-08-05 22:06:24.790 +04:00 [DBG] Closed connection to database 'sagas_db' on server ''.
2022-08-05 22:06:24.906 +04:00 [DBG] DetectChanges starting for 'SagasDbContext'.
2022-08-05 22:06:24.913 +04:00 [DBG] DetectChanges completed for 'SagasDbContext'.
2022-08-05 22:06:24.932 +04:00 [DBG] Opening connection to database 'sagas_db' on server ''.
2022-08-05 22:06:24.971 +04:00 [DBG] Opened connection to database 'sagas_db' on server 'tcp://localhost:3462'.
2022-08-05 22:06:24.977 +04:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2022-08-05 22:06:24.989 +04:00 [DBG] Began transaction with isolation level 'ReadCommitted'.
2022-08-05 22:06:24.993 +04:00 [DBG] Creating DbCommand for 'ExecuteNonQuery'.
2022-08-05 22:06:24.994 +04:00 [DBG] Created DbCommand for 'ExecuteNonQuery' (1ms).
2022-08-05 22:06:24.997 +04:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "BuyItemsSagaState" (
    "CorrelationId" uuid NOT NULL,
    "CurrentState" character varying(255) NULL,
    "RequestId" uuid NULL,
    "ResponseAddress" text NULL,
    CONSTRAINT "PK_BuyItemsSagaState" PRIMARY KEY ("CorrelationId")
);
2022-08-05 22:06:25.025 +04:00 [INF] Executed DbCommand (27ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "BuyItemsSagaState" (
    "CorrelationId" uuid NOT NULL,
    "CurrentState" character varying(255) NULL,
    "RequestId" uuid NULL,
    "ResponseAddress" text NULL,
    CONSTRAINT "PK_BuyItemsSagaState" PRIMARY KEY ("CorrelationId")
);
2022-08-05 22:06:25.031 +04:00 [DBG] Committing transaction.
2022-08-05 22:06:25.046 +04:00 [DBG] Committed transaction.
2022-08-05 22:06:25.051 +04:00 [DBG] Disposing transaction.
2022-08-05 22:06:25.053 +04:00 [DBG] Closing connection to database 'sagas_db' on server 'tcp://localhost:3462'.
2022-08-05 22:06:25.058 +04:00 [DBG] Closed connection to database 'sagas_db' on server ''.
2022-08-05 22:06:25.062 +04:00 [DBG] 'SagasDbContext' disposed.
2022-08-05 22:06:25.143 +04:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2022-08-05 22:06:25.204 +04:00 [DBG] Hosting starting
2022-08-05 22:06:25.853 +04:00 [INF] Configured endpoint buy-items-saga-state, Saga: BuyItemsSagaState, State Machine: BuyItemsSaga
2022-08-05 22:06:26.169 +04:00 [DBG] Starting bus instances: IBus
2022-08-05 22:06:26.183 +04:00 [DBG] Starting bus: "rabbitmq://localhost/"
2022-08-05 22:06:26.279 +04:00 [DBG] Connect: rabbitmq@localhost:5672/
2022-08-05 22:06:26.434 +04:00 [INF] Now listening on: http://localhost:5180
2022-08-05 22:06:26.451 +04:00 [DBG] Loaded hosting startup assembly SagasMicroservice
2022-08-05 22:06:26.453 +04:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2022-08-05 22:06:26.454 +04:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2022-08-05 22:06:26.456 +04:00 [INF] Application started. Press Ctrl+C to shut down.
2022-08-05 22:06:26.458 +04:00 [INF] Hosting environment: Development
2022-08-05 22:06:26.460 +04:00 [INF] Content root path: D:\github\microservices-archetecture\src\SagasMicroservice\
2022-08-05 22:06:26.461 +04:00 [DBG] Hosting started
2022-08-05 22:06:26.499 +04:00 [DBG] Connected: rabbitmq@localhost:5672/ (address: amqp://localhost:5672, local: 53103)
2022-08-05 22:06:26.583 +04:00 [DBG] Endpoint Ready: "rabbitmq://localhost/SMS2104090_SagasMicroservice_bus_btpoyyn76cybk8imbdp8qdjsbs?temporary=true"
2022-08-05 22:06:26.623 +04:00 [DBG] Declare queue: name: buy-items-saga-state, durable, consumer-count: 0 message-count: 0
2022-08-05 22:06:26.639 +04:00 [DBG] Connection id "0HMJN1KRF0J7G" accepted.
2022-08-05 22:06:26.648 +04:00 [DBG] Connection id "0HMJN1KRF0J7G" started.
2022-08-05 22:06:26.653 +04:00 [DBG] Connection id "0HMJN1KRF0J7H" accepted.
2022-08-05 22:06:26.657 +04:00 [DBG] Connection id "0HMJN1KRF0J7H" started.
2022-08-05 22:06:26.662 +04:00 [DBG] Declare exchange: name: buy-items-saga-state, type: fanout, durable
2022-08-05 22:06:26.680 +04:00 [DBG] Declare exchange: name: Contracts:BuyItemsRequest, type: fanout, durable
2022-08-05 22:06:26.681 +04:00 [DBG] Connection id "0HMJN1KRF0J7H" received FIN.
2022-08-05 22:06:26.684 +04:00 [DBG] Declare exchange: name: MassTransit:Fault--Contracts:IGetMoneyRequest--, type: fanout, durable
2022-08-05 22:06:26.681 +04:00 [DBG] Connection id "0HMJN1KRF0J7G" received FIN.
2022-08-05 22:06:26.693 +04:00 [DBG] Declare exchange: name: Contracts:IGetItemsResponse, type: fanout, durable
2022-08-05 22:06:26.697 +04:00 [DBG] Connection id "0HMJN1KRF0J7H" sending FIN because: "The client closed the connection."
2022-08-05 22:06:26.719 +04:00 [DBG] Connection id "0HMJN1KRF0J7G" sending FIN because: "The client closed the connection."
2022-08-05 22:06:26.725 +04:00 [DBG] Declare exchange: name: MassTransit:Fault--Contracts:IGetItemsRequest--, type: fanout, durable
2022-08-05 22:06:26.731 +04:00 [DBG] Connection id "0HMJN1KRF0J7H" disconnecting.
2022-08-05 22:06:26.734 +04:00 [DBG] Connection id "0HMJN1KRF0J7G" disconnecting.
2022-08-05 22:06:26.738 +04:00 [DBG] Declare exchange: name: Contracts:IGetMoneyResponse, type: fanout, durable
2022-08-05 22:06:26.753 +04:00 [DBG] Connection id "0HMJN1KRF0J7H" stopped.
2022-08-05 22:06:26.753 +04:00 [DBG] Connection id "0HMJN1KRF0J7G" stopped.
2022-08-05 22:06:26.765 +04:00 [DBG] Declare exchange: name: MassTransit.Contracts:RequestTimeoutExpired--Contracts:IGetItemsRequest--, type: fanout, durable
2022-08-05 22:06:26.797 +04:00 [DBG] Declare exchange: name: MassTransit.Contracts:RequestTimeoutExpired--Contracts:IGetMoneyRequest--, type: fanout, durable
2022-08-05 22:06:26.908 +04:00 [DBG] Bind queue: source: buy-items-saga-state, destination: buy-items-saga-state
2022-08-05 22:06:26.949 +04:00 [DBG] Bind exchange: source: Contracts:BuyItemsRequest, destination: buy-items-saga-state
2022-08-05 22:06:26.955 +04:00 [DBG] Bind exchange: source: MassTransit:Fault--Contracts:IGetMoneyRequest--, destination: buy-items-saga-state
2022-08-05 22:06:26.959 +04:00 [DBG] Bind exchange: source: Contracts:IGetItemsResponse, destination: buy-items-saga-state
2022-08-05 22:06:26.963 +04:00 [DBG] Bind exchange: source: MassTransit:Fault--Contracts:IGetItemsRequest--, destination: buy-items-saga-state
2022-08-05 22:06:26.966 +04:00 [DBG] Bind exchange: source: Contracts:IGetMoneyResponse, destination: buy-items-saga-state
2022-08-05 22:06:26.969 +04:00 [DBG] Bind exchange: source: MassTransit.Contracts:RequestTimeoutExpired--Contracts:IGetItemsRequest--, destination: buy-items-saga-state
2022-08-05 22:06:26.979 +04:00 [DBG] Bind exchange: source: MassTransit.Contracts:RequestTimeoutExpired--Contracts:IGetMoneyRequest--, destination: buy-items-saga-state
2022-08-05 22:06:27.101 +04:00 [DBG] Connection id "0HMJN1KRF0J7I" accepted.
2022-08-05 22:06:27.119 +04:00 [DBG] Connection id "0HMJN1KRF0J7I" started.
2022-08-05 22:06:27.158 +04:00 [DBG] Connection id "0HMJN1KRF0J7J" accepted.
2022-08-05 22:06:27.167 +04:00 [DBG] Connection id "0HMJN1KRF0J7I" received FIN.
2022-08-05 22:06:27.185 +04:00 [DBG] Connection id "0HMJN1KRF0J7J" started.
2022-08-05 22:06:27.188 +04:00 [DBG] Connection id "0HMJN1KRF0J7I" sending FIN because: "The client closed the connection."
2022-08-05 22:06:27.195 +04:00 [DBG] Connection id "0HMJN1KRF0J7I" disconnecting.
2022-08-05 22:06:27.236 +04:00 [INF] Request starting HTTP/1.1 GET http://localhost:5180/swagger - -
2022-08-05 22:06:27.236 +04:00 [INF] Request starting HTTP/1.1 GET http://localhost:5180/swagger/index.html - -
2022-08-05 22:06:27.286 +04:00 [DBG] Consumer Ok: "rabbitmq://localhost/buy-items-saga-state" - amq.ctag-_SQ1u-ljuBmfk7DHVQwogQ
2022-08-05 22:06:27.290 +04:00 [DBG] Endpoint Ready: "rabbitmq://localhost/buy-items-saga-state"
2022-08-05 22:06:27.298 +04:00 [INF] Bus started: "rabbitmq://localhost/"
2022-08-05 22:06:27.301 +04:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2022-08-05 22:06:27.301 +04:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2022-08-05 22:06:27.317 +04:00 [DBG] No candidates found for the request path '/swagger/index.html'
2022-08-05 22:06:27.317 +04:00 [DBG] No candidates found for the request path '/swagger'
2022-08-05 22:06:27.320 +04:00 [DBG] Request did not match any endpoints
2022-08-05 22:06:27.321 +04:00 [DBG] Request did not match any endpoints
2022-08-05 22:06:27.370 +04:00 [INF] Request finished HTTP/1.1 GET http://localhost:5180/swagger - - - 0 - - 140.2933ms
2022-08-05 22:06:27.385 +04:00 [DBG] Connection id "0HMJN1KRF0J7I" stopped.
2022-08-05 22:06:27.466 +04:00 [DBG] Response markup is scheduled to include browser refresh script injection.
2022-08-05 22:06:27.589 +04:00 [DBG] Response markup was updated to include browser refresh script injection.
2022-08-05 22:06:27.591 +04:00 [DBG] Connection id "0HMJN1KRF0J7J" completed keep alive response.
2022-08-05 22:06:27.593 +04:00 [INF] Request finished HTTP/1.1 GET http://localhost:5180/swagger/index.html - - - 200 - text/html;charset=utf-8 363.8793ms
2022-08-05 22:06:27.688 +04:00 [INF] Request starting HTTP/1.1 GET http://localhost:5180/_framework/aspnetcore-browser-refresh.js - -
2022-08-05 22:06:27.702 +04:00 [DBG] Connection id "0HMJN1KRF0J7J" completed keep alive response.
2022-08-05 22:06:27.712 +04:00 [INF] Request finished HTTP/1.1 GET http://localhost:5180/_framework/aspnetcore-browser-refresh.js - - - 200 11951 application/javascript;+charset=utf-8 23.8980ms
2022-08-05 22:06:27.832 +04:00 [INF] Request starting HTTP/1.1 GET http://localhost:5180/swagger/favicon-32x32.png - -
2022-08-05 22:06:27.835 +04:00 [DBG] No candidates found for the request path '/swagger/favicon-32x32.png'
2022-08-05 22:06:27.836 +04:00 [DBG] Connection id "0HMJN1KRF0J7J" received FIN.
2022-08-05 22:06:27.840 +04:00 [DBG] Request did not match any endpoints
2022-08-05 22:06:27.842 +04:00 [DBG] Connection id "0HMJN1KRF0J7J" sending FIN because: "The client closed the connection."
2022-08-05 22:06:27.850 +04:00 [DBG] Connection id "0HMJN1KRF0J7J" disconnecting.
2022-08-05 22:06:27.859 +04:00 [DBG] The file transmission was cancelled
System.OperationCanceledException: The operation was canceled.
   at System.Threading.CancellationToken.ThrowOperationCanceledException()
   at System.Threading.CancellationToken.ThrowIfCancellationRequested()
   at Microsoft.AspNetCore.Http.SendFileResponseExtensions.SendFileAsyncCore(HttpResponse response, IFileInfo file, Int64 offset, Nullable`1 count, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.StaticFiles.StaticFileContext.SendAsync()
2022-08-05 22:06:27.915 +04:00 [INF] Sending file. Request path: '/favicon-32x32.png'. Physical path: 'N/A'
2022-08-05 22:06:27.917 +04:00 [INF] Request finished HTTP/1.1 GET http://localhost:5180/swagger/favicon-32x32.png - - - 0 628 image/png 85.0882ms
2022-08-05 22:06:27.919 +04:00 [DBG] Connection id "0HMJN1KRF0J7J" stopped.
2022-08-05 22:06:27.994 +04:00 [DBG] Connection id "0HMJN1KRF0J7K" accepted.
2022-08-05 22:06:27.996 +04:00 [DBG] Connection id "0HMJN1KRF0J7K" started.
2022-08-05 22:06:27.998 +04:00 [INF] Request starting HTTP/1.1 GET http://localhost:5180/swagger/v1/swagger.json - -
2022-08-05 22:06:28.000 +04:00 [DBG] No candidates found for the request path '/swagger/v1/swagger.json'
2022-08-05 22:06:28.004 +04:00 [DBG] Request did not match any endpoints
2022-08-05 22:06:28.037 +04:00 [DBG] Connection id "0HMJN1KRF0J7K" completed keep alive response.
2022-08-05 22:06:28.040 +04:00 [INF] Request finished HTTP/1.1 GET http://localhost:5180/swagger/v1/swagger.json - - - 200 - application/json;charset=utf-8 41.1521ms
2022-08-05 22:07:13.233 +04:00 [INF] Entity Framework Core 6.0.3 initialized 'SagasDbContext' using provider 'Npgsql.EntityFrameworkCore.PostgreSQL:6.0.3+94d0a8eaeb9cf5af6ce55a9e59153c1a1be3244f' with options: None
2022-08-05 22:07:13.250 +04:00 [DBG] Opening connection to database 'sagas_db' on server ''.
2022-08-05 22:07:13.253 +04:00 [DBG] Opened connection to database 'sagas_db' on server 'tcp://localhost:3462'.
2022-08-05 22:07:13.254 +04:00 [DBG] Beginning transaction with isolation level 'Serializable'.
2022-08-05 22:07:13.256 +04:00 [DBG] Began transaction with isolation level 'Serializable'.
2022-08-05 22:07:13.326 +04:00 [DBG] Compiling query expression: 
'DbSet<BuyItemsSagaState>().FromSql(SELECT * FROM "public"."BuyItemsSagaState" WHERE "CorrelationId" = @p0 FOR UPDATE, __p_0)
    .SingleOrDefault()'
2022-08-05 22:07:13.468 +04:00 [DBG] Generated query execution expression: 
'queryContext => ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync<BuyItemsSagaState>(
    asyncEnumerable: new SingleQueryingEnumerable<BuyItemsSagaState>(
        (RelationalQueryContext)queryContext, 
        RelationalCommandCache.SelectExpression(
            Projection Mapping:
                EmptyProjectionMember -> Dictionary<IProperty, int> { [Property: BuyItemsSagaState.CorrelationId (Guid) Required PK AfterSave:Throw, 0], [Property: BuyItemsSagaState.CurrentState (string) MaxLength(255), 1], [Property: BuyItemsSagaState.RequestId (Guid?), 2], [Property: BuyItemsSagaState.ResponseAddress (Uri), 3] }
            SELECT TOP(2) b.CorrelationId, b.CurrentState, b.RequestId, b.ResponseAddress
            FROM SELECT * FROM "public"."BuyItemsSagaState" WHERE "CorrelationId" = @p0 FOR UPDATE), 
        Func<QueryContext, DbDataReader, ResultContext, SingleQueryResultCoordinator, BuyItemsSagaState>, 
        SagasDbContext, 
        False, 
        False, 
        True
    ), 
    cancellationToken: queryContext.CancellationToken)'
2022-08-05 22:07:13.502 +04:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2022-08-05 22:07:13.504 +04:00 [DBG] Created DbCommand for 'ExecuteReader' (2ms).
2022-08-05 22:07:13.511 +04:00 [DBG] Executing DbCommand [Parameters=[p0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT b."CorrelationId", b."CurrentState", b."RequestId", b."ResponseAddress"
FROM (
    SELECT * FROM "public"."BuyItemsSagaState" WHERE "CorrelationId" = @p0 FOR UPDATE
) AS b
LIMIT 2
2022-08-05 22:07:13.531 +04:00 [INF] Executed DbCommand (23ms) [Parameters=[p0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT b."CorrelationId", b."CurrentState", b."RequestId", b."ResponseAddress"
FROM (
    SELECT * FROM "public"."BuyItemsSagaState" WHERE "CorrelationId" = @p0 FOR UPDATE
) AS b
LIMIT 2
2022-08-05 22:07:13.540 +04:00 [DBG] A data reader was disposed.
2022-08-05 22:07:13.551 +04:00 [DBG] SAGA:BuyItemsSagaState:"3fa85f64-5717-4562-b3fc-2c963f66afa6" Created Contracts.BuyItemsRequest
2022-08-05 22:07:13.555 +04:00 [DBG] SAGA:BuyItemsSagaState:"3fa85f64-5717-4562-b3fc-2c963f66afa6" Added Contracts.BuyItemsRequest
2022-08-05 22:07:13.652 +04:00 [DBG] Create send transport: "rabbitmq://localhost/buy-items-saga-state"
2022-08-05 22:07:13.664 +04:00 [DBG] Declare exchange: name: buy-items-saga-state, type: fanout, durable
2022-08-05 22:07:13.699 +04:00 [DBG] Declare exchange: name: buy-items-saga-state_delay, type: x-delayed-message, durable, x-delayed-type: fanout
2022-08-05 22:07:13.701 +04:00 [DBG] Declare exchange: name: buy-items-saga-state, type: fanout, durable
2022-08-05 22:07:13.710 +04:00 [DBG] Bind exchange: source: buy-items-saga-state_delay, destination: buy-items-saga-state
2022-08-05 22:07:13.769 +04:00 [DBG] SEND "rabbitmq://localhost/buy-items-saga-state" "0c5b0000-5df3-0015-22d9-08da770d52f9" MassTransit.Contracts.RequestTimeoutExpired<Contracts.IGetMoneyRequest>
2022-08-05 22:07:13.832 +04:00 [DBG] Context 'SagasDbContext' started tracking 'BuyItemsSagaState' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2022-08-05 22:07:13.837 +04:00 [DBG] SaveChanges starting for 'SagasDbContext'.
2022-08-05 22:07:13.840 +04:00 [DBG] DetectChanges starting for 'SagasDbContext'.
2022-08-05 22:07:13.845 +04:00 [DBG] DetectChanges completed for 'SagasDbContext'.
2022-08-05 22:07:13.858 +04:00 [DBG] Creating transaction savepoint.
2022-08-05 22:07:13.863 +04:00 [DBG] Created transaction savepoint.
2022-08-05 22:07:13.895 +04:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2022-08-05 22:07:13.897 +04:00 [DBG] Created DbCommand for 'ExecuteReader' (2ms).
2022-08-05 22:07:13.900 +04:00 [DBG] Executing DbCommand [Parameters=[@p0='?' (DbType = Guid), @p1='?', @p2='?' (DbType = Guid), @p3='?'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "BuyItemsSagaState" ("CorrelationId", "CurrentState", "RequestId", "ResponseAddress")
VALUES (@p0, @p1, @p2, @p3);
2022-08-05 22:07:13.907 +04:00 [INF] Executed DbCommand (8ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?', @p2='?' (DbType = Guid), @p3='?'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "BuyItemsSagaState" ("CorrelationId", "CurrentState", "RequestId", "ResponseAddress")
VALUES (@p0, @p1, @p2, @p3);
2022-08-05 22:07:13.912 +04:00 [DBG] A data reader was disposed.
2022-08-05 22:07:13.914 +04:00 [DBG] Releasing transaction savepoint.
2022-08-05 22:07:13.921 +04:00 [DBG] Released transaction savepoint.
2022-08-05 22:07:13.930 +04:00 [DBG] An entity of type 'BuyItemsSagaState' tracked by 'SagasDbContext' changed state from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2022-08-05 22:07:13.932 +04:00 [DBG] SaveChanges completed for 'SagasDbContext' with 1 entities written to the database.
2022-08-05 22:07:13.935 +04:00 [DBG] Committing transaction.
2022-08-05 22:07:13.941 +04:00 [DBG] Committed transaction.
2022-08-05 22:07:13.943 +04:00 [DBG] Closing connection to database 'sagas_db' on server 'tcp://localhost:3462'.
2022-08-05 22:07:13.944 +04:00 [DBG] Closed connection to database 'sagas_db' on server ''.
2022-08-05 22:07:13.947 +04:00 [DBG] Disposing transaction.
2022-08-05 22:07:13.948 +04:00 [DBG] 'SagasDbContext' disposed.
2022-08-05 22:07:13.954 +04:00 [DBG] RECEIVE "rabbitmq://localhost/buy-items-saga-state" "da210000-5df3-0015-0f44-08da770d527f" Contracts.BuyItemsRequest BuyItemsSagaState("00:00:00.7407556")
2022-08-05 22:07:13.961 +04:00 [DBG] Declare exchange: name: Contracts:IGetMoneyRequest, type: fanout, durable
2022-08-05 22:07:13.985 +04:00 [DBG] SEND "rabbitmq://localhost/Contracts:IGetMoneyRequest" "0c5b0000-5df3-0015-c6b7-08da770d5326" Contracts.IGetMoneyRequest
2022-08-05 22:07:14.350 +04:00 [INF] Entity Framework Core 6.0.3 initialized 'SagasDbContext' using provider 'Npgsql.EntityFrameworkCore.PostgreSQL:6.0.3+94d0a8eaeb9cf5af6ce55a9e59153c1a1be3244f' with options: None
2022-08-05 22:07:14.358 +04:00 [DBG] Opening connection to database 'sagas_db' on server ''.
2022-08-05 22:07:14.358 +04:00 [DBG] Opened connection to database 'sagas_db' on server 'tcp://localhost:3462'.
2022-08-05 22:07:14.359 +04:00 [DBG] Beginning transaction with isolation level 'Serializable'.
2022-08-05 22:07:14.360 +04:00 [DBG] Began transaction with isolation level 'Serializable'.
2022-08-05 22:07:14.363 +04:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2022-08-05 22:07:14.364 +04:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2022-08-05 22:07:14.365 +04:00 [DBG] Executing DbCommand [Parameters=[p0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT b."CorrelationId", b."CurrentState", b."RequestId", b."ResponseAddress"
FROM (
    SELECT * FROM "public"."BuyItemsSagaState" WHERE "CorrelationId" = @p0 FOR UPDATE
) AS b
LIMIT 2
2022-08-05 22:07:14.371 +04:00 [INF] Executed DbCommand (6ms) [Parameters=[p0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT b."CorrelationId", b."CurrentState", b."RequestId", b."ResponseAddress"
FROM (
    SELECT * FROM "public"."BuyItemsSagaState" WHERE "CorrelationId" = @p0 FOR UPDATE
) AS b
LIMIT 2
2022-08-05 22:07:14.378 +04:00 [DBG] Context 'SagasDbContext' started tracking 'BuyItemsSagaState' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2022-08-05 22:07:14.381 +04:00 [DBG] A data reader was disposed.
2022-08-05 22:07:14.383 +04:00 [DBG] SAGA:BuyItemsSagaState:"3fa85f64-5717-4562-b3fc-2c963f66afa6" Used Contracts.IGetMoneyResponse
2022-08-05 22:07:14.402 +04:00 [DBG] SEND "rabbitmq://localhost/buy-items-saga-state" "0c5b0000-5df3-0015-ff7e-08da770d5367" MassTransit.Contracts.RequestTimeoutExpired<Contracts.IGetItemsRequest>
2022-08-05 22:07:14.407 +04:00 [DBG] An entity of type 'BuyItemsSagaState' tracked by 'SagasDbContext' changed state from '"Unchanged"' to '"Modified"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2022-08-05 22:07:14.408 +04:00 [DBG] SaveChanges starting for 'SagasDbContext'.
2022-08-05 22:07:14.409 +04:00 [DBG] DetectChanges starting for 'SagasDbContext'.
2022-08-05 22:07:14.410 +04:00 [DBG] DetectChanges completed for 'SagasDbContext'.
2022-08-05 22:07:14.412 +04:00 [DBG] Creating transaction savepoint.
2022-08-05 22:07:14.415 +04:00 [DBG] Created transaction savepoint.
2022-08-05 22:07:14.419 +04:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2022-08-05 22:07:14.419 +04:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2022-08-05 22:07:14.421 +04:00 [DBG] Executing DbCommand [Parameters=[@p3='?' (DbType = Guid), @p0='?', @p1='?' (DbType = Guid), @p2='?'], CommandType='"Text"', CommandTimeout='30']
UPDATE "BuyItemsSagaState" SET "CurrentState" = @p0, "RequestId" = @p1, "ResponseAddress" = @p2
WHERE "CorrelationId" = @p3;
2022-08-05 22:07:14.424 +04:00 [INF] Executed DbCommand (3ms) [Parameters=[@p3='?' (DbType = Guid), @p0='?', @p1='?' (DbType = Guid), @p2='?'], CommandType='"Text"', CommandTimeout='30']
UPDATE "BuyItemsSagaState" SET "CurrentState" = @p0, "RequestId" = @p1, "ResponseAddress" = @p2
WHERE "CorrelationId" = @p3;
2022-08-05 22:07:14.427 +04:00 [DBG] A data reader was disposed.
2022-08-05 22:07:14.429 +04:00 [DBG] Releasing transaction savepoint.
2022-08-05 22:07:14.432 +04:00 [DBG] Released transaction savepoint.
2022-08-05 22:07:14.432 +04:00 [DBG] An entity of type 'BuyItemsSagaState' tracked by 'SagasDbContext' changed state from '"Modified"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2022-08-05 22:07:14.434 +04:00 [DBG] SaveChanges completed for 'SagasDbContext' with 1 entities written to the database.
2022-08-05 22:07:14.437 +04:00 [DBG] Committing transaction.
2022-08-05 22:07:14.443 +04:00 [DBG] Committed transaction.
2022-08-05 22:07:14.444 +04:00 [DBG] Closing connection to database 'sagas_db' on server 'tcp://localhost:3462'.
2022-08-05 22:07:14.445 +04:00 [DBG] Closed connection to database 'sagas_db' on server ''.
2022-08-05 22:07:14.446 +04:00 [DBG] Disposing transaction.
2022-08-05 22:07:14.448 +04:00 [DBG] 'SagasDbContext' disposed.
2022-08-05 22:07:14.449 +04:00 [DBG] RECEIVE "rabbitmq://localhost/buy-items-saga-state" "da210000-5df3-0015-6226-08da770d5350" Contracts.IGetMoneyResponse BuyItemsSagaState("00:00:00.1290207")
2022-08-05 22:07:14.452 +04:00 [DBG] Declare exchange: name: Contracts:IGetItemsRequest, type: fanout, durable
2022-08-05 22:07:14.466 +04:00 [DBG] SEND "rabbitmq://localhost/Contracts:IGetItemsRequest" "0c5b0000-5df3-0015-252a-08da770d5371" Contracts.IGetItemsRequest
2022-08-05 22:07:14.942 +04:00 [INF] Entity Framework Core 6.0.3 initialized 'SagasDbContext' using provider 'Npgsql.EntityFrameworkCore.PostgreSQL:6.0.3+94d0a8eaeb9cf5af6ce55a9e59153c1a1be3244f' with options: None
2022-08-05 22:07:14.946 +04:00 [DBG] Opening connection to database 'sagas_db' on server ''.
2022-08-05 22:07:14.948 +04:00 [DBG] Opened connection to database 'sagas_db' on server 'tcp://localhost:3462'.
2022-08-05 22:07:14.950 +04:00 [DBG] Beginning transaction with isolation level 'Serializable'.
2022-08-05 22:07:14.951 +04:00 [DBG] Began transaction with isolation level 'Serializable'.
2022-08-05 22:07:14.955 +04:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2022-08-05 22:07:14.956 +04:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2022-08-05 22:07:14.958 +04:00 [DBG] Executing DbCommand [Parameters=[p0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT b."CorrelationId", b."CurrentState", b."RequestId", b."ResponseAddress"
FROM (
    SELECT * FROM "public"."BuyItemsSagaState" WHERE "CorrelationId" = @p0 FOR UPDATE
) AS b
LIMIT 2
2022-08-05 22:07:14.965 +04:00 [INF] Executed DbCommand (7ms) [Parameters=[p0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT b."CorrelationId", b."CurrentState", b."RequestId", b."ResponseAddress"
FROM (
    SELECT * FROM "public"."BuyItemsSagaState" WHERE "CorrelationId" = @p0 FOR UPDATE
) AS b
LIMIT 2
2022-08-05 22:07:14.969 +04:00 [DBG] Context 'SagasDbContext' started tracking 'BuyItemsSagaState' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2022-08-05 22:07:14.971 +04:00 [DBG] A data reader was disposed.
2022-08-05 22:07:14.973 +04:00 [DBG] SAGA:BuyItemsSagaState:"3fa85f64-5717-4562-b3fc-2c963f66afa6" Used Contracts.IGetItemsResponse
2022-08-05 22:07:14.981 +04:00 [DBG] Create send transport: "rabbitmq://localhost:0/SMS2104090_ApiGateway_bus_5eooyyn76cybkadnbdp8qdj1ys?temporary=true"
2022-08-05 22:07:14.984 +04:00 [DBG] An entity of type 'BuyItemsSagaState' tracked by 'SagasDbContext' changed state from '"Unchanged"' to '"Modified"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2022-08-05 22:07:14.987 +04:00 [DBG] SaveChanges starting for 'SagasDbContext'.
2022-08-05 22:07:14.988 +04:00 [DBG] DetectChanges starting for 'SagasDbContext'.
2022-08-05 22:07:14.991 +04:00 [DBG] DetectChanges completed for 'SagasDbContext'.
2022-08-05 22:07:14.992 +04:00 [DBG] Creating transaction savepoint.
2022-08-05 22:07:14.995 +04:00 [DBG] Created transaction savepoint.
2022-08-05 22:07:14.996 +04:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2022-08-05 22:07:14.997 +04:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2022-08-05 22:07:14.999 +04:00 [DBG] Executing DbCommand [Parameters=[@p3='?' (DbType = Guid), @p0='?', @p1='?' (DbType = Guid), @p2='?'], CommandType='"Text"', CommandTimeout='30']
UPDATE "BuyItemsSagaState" SET "CurrentState" = @p0, "RequestId" = @p1, "ResponseAddress" = @p2
WHERE "CorrelationId" = @p3;
2022-08-05 22:07:15.004 +04:00 [INF] Executed DbCommand (5ms) [Parameters=[@p3='?' (DbType = Guid), @p0='?', @p1='?' (DbType = Guid), @p2='?'], CommandType='"Text"', CommandTimeout='30']
UPDATE "BuyItemsSagaState" SET "CurrentState" = @p0, "RequestId" = @p1, "ResponseAddress" = @p2
WHERE "CorrelationId" = @p3;
2022-08-05 22:07:15.009 +04:00 [DBG] A data reader was disposed.
2022-08-05 22:07:15.010 +04:00 [DBG] Releasing transaction savepoint.
2022-08-05 22:07:15.013 +04:00 [DBG] Released transaction savepoint.
2022-08-05 22:07:15.014 +04:00 [DBG] An entity of type 'BuyItemsSagaState' tracked by 'SagasDbContext' changed state from '"Modified"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2022-08-05 22:07:15.016 +04:00 [DBG] SaveChanges completed for 'SagasDbContext' with 1 entities written to the database.
2022-08-05 22:07:15.018 +04:00 [DBG] Committing transaction.
2022-08-05 22:07:15.025 +04:00 [DBG] Committed transaction.
2022-08-05 22:07:15.026 +04:00 [DBG] Closing connection to database 'sagas_db' on server 'tcp://localhost:3462'.
2022-08-05 22:07:15.028 +04:00 [DBG] Closed connection to database 'sagas_db' on server ''.
2022-08-05 22:07:15.029 +04:00 [DBG] Disposing transaction.
2022-08-05 22:07:15.030 +04:00 [DBG] 'SagasDbContext' disposed.
2022-08-05 22:07:15.032 +04:00 [DBG] RECEIVE "rabbitmq://localhost/buy-items-saga-state" "da210000-5df3-0015-d647-08da770d53ab" Contracts.IGetItemsResponse BuyItemsSagaState("00:00:00.0972564")
2022-08-05 22:07:15.036 +04:00 [DBG] Declare exchange: name: SMS2104090_ApiGateway_bus_5eooyyn76cybkadnbdp8qdj1ys, type: fanout, auto-delete
2022-08-05 22:07:15.047 +04:00 [DBG] SEND "rabbitmq://localhost:0/SMS2104090_ApiGateway_bus_5eooyyn76cybkadnbdp8qdj1ys?temporary=true" "0c5b0000-5df3-0015-7114-08da770d53ca" Contracts.BuyItemsResponse
2022-08-05 22:07:43.726 +04:00 [INF] Entity Framework Core 6.0.3 initialized 'SagasDbContext' using provider 'Npgsql.EntityFrameworkCore.PostgreSQL:6.0.3+94d0a8eaeb9cf5af6ce55a9e59153c1a1be3244f' with options: None
2022-08-05 22:07:43.728 +04:00 [DBG] Opening connection to database 'sagas_db' on server ''.
2022-08-05 22:07:43.729 +04:00 [DBG] Opened connection to database 'sagas_db' on server 'tcp://localhost:3462'.
2022-08-05 22:07:43.729 +04:00 [DBG] Beginning transaction with isolation level 'Serializable'.
2022-08-05 22:07:43.730 +04:00 [DBG] Began transaction with isolation level 'Serializable'.
2022-08-05 22:07:43.732 +04:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2022-08-05 22:07:43.732 +04:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2022-08-05 22:07:43.733 +04:00 [DBG] Executing DbCommand [Parameters=[p0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT b."CorrelationId", b."CurrentState", b."RequestId", b."ResponseAddress"
FROM (
    SELECT * FROM "public"."BuyItemsSagaState" WHERE "CorrelationId" = @p0 FOR UPDATE
) AS b
LIMIT 2
2022-08-05 22:07:43.737 +04:00 [INF] Executed DbCommand (4ms) [Parameters=[p0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT b."CorrelationId", b."CurrentState", b."RequestId", b."ResponseAddress"
FROM (
    SELECT * FROM "public"."BuyItemsSagaState" WHERE "CorrelationId" = @p0 FOR UPDATE
) AS b
LIMIT 2
2022-08-05 22:07:43.741 +04:00 [DBG] Context 'SagasDbContext' started tracking 'BuyItemsSagaState' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2022-08-05 22:07:43.742 +04:00 [DBG] A data reader was disposed.
2022-08-05 22:07:43.743 +04:00 [DBG] SAGA:BuyItemsSagaState:"3fa85f64-5717-4562-b3fc-2c963f66afa6" Used MassTransit.Contracts.RequestTimeoutExpired<Contracts.IGetMoneyRequest>
2022-08-05 22:07:43.750 +04:00 [DBG] Rolling back transaction.
2022-08-05 22:07:43.758 +04:00 [DBG] Rolled back transaction.
2022-08-05 22:07:43.759 +04:00 [DBG] Closing connection to database 'sagas_db' on server 'tcp://localhost:3462'.
2022-08-05 22:07:43.760 +04:00 [DBG] Closed connection to database 'sagas_db' on server ''.
2022-08-05 22:07:43.762 +04:00 [DBG] Disposing transaction.
2022-08-05 22:07:43.764 +04:00 [DBG] 'SagasDbContext' disposed.
2022-08-05 22:07:43.768 +04:00 [WRN] R-RETRY "rabbitmq://localhost/buy-items-saga-state" "0c5b0000-5df3-0015-22d9-08da770d52f9" MassTransit.RetryPolicies.RetryConsumeContext<MassTransit.Contracts.RequestTimeoutExpired<Contracts.IGetMoneyRequest>>
MassTransit.NotAcceptedStateMachineException: BuyItemsSagaState(3fa85f64-5717-4562-b3fc-2c963f66afa6) Saga exception on receipt of MassTransit.Contracts.RequestTimeoutExpired<Contracts.IGetMoneyRequest>: Not accepted in state Final
 ---> MassTransit.UnhandledEventException: The GetMoney.TimeoutExpired event is not handled during the Final state for the BuyItemsSaga state machine
   at MassTransit.MassTransitStateMachine`1.DefaultUnhandledEventCallback(UnhandledEventContext`1 context) in /_/src/MassTransit/SagaStateMachine/MassTransitStateMachine.cs:line 221
   at MassTransit.MassTransitStateMachine`1.UnhandledEvent(BehaviorContext`1 context, State state) in /_/src/MassTransit/SagaStateMachine/MassTransitStateMachine.cs:line 1288
   at MassTransit.MassTransitStateMachine`1.<.ctor>b__14_2(BehaviorContext`1 context, State state) in /_/src/MassTransit/SagaStateMachine/MassTransitStateMachine.cs:line 54
   at MassTransit.SagaStateMachine.StateMachineState`1.MassTransit.State<TSaga>.Raise[T](BehaviorContext`2 context) in /_/src/MassTransit/SagaStateMachine/SagaStateMachine/StateMachineState.cs:line 162
   at MassTransit.MassTransitStateMachine`1.MassTransit.StateMachine<TInstance>.RaiseEvent[T](BehaviorContext`2 context) in /_/src/MassTransit/SagaStateMachine/MassTransitStateMachine.cs:line 134
   at MassTransit.Middleware.StateMachineSagaMessageFilter`2.Send(SagaConsumeContext`2 context, IPipe`1 next) in /_/src/MassTransit/Middleware/StateMachineSagaMessageFilter.cs:line 60
   --- End of inner exception stack trace ---
   at MassTransit.Middleware.StateMachineSagaMessageFilter`2.Send(SagaConsumeContext`2 context, IPipe`1 next) in /_/src/MassTransit/Middleware/StateMachineSagaMessageFilter.cs:line 69
   at MassTransit.Middleware.StateMachineSagaMessageFilter`2.Send(SagaConsumeContext`2 context, IPipe`1 next) in /_/src/MassTransit/Middleware/StateMachineSagaMessageFilter.cs:line 74
   at MassTransit.Middleware.SendSagaPipe`2.Send(SagaRepositoryContext`2 context) in /_/src/MassTransit/Middleware/SendSagaPipe.cs:line 43
   at MassTransit.Middleware.SendSagaPipe`2.Send(SagaRepositoryContext`2 context) in /_/src/MassTransit/Middleware/SendSagaPipe.cs:line 67
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.<>c__DisplayClass5_0`1.<<Send>b__1>d.MoveNext() in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 56
--- End of stack trace from previous location ---
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.<>c__DisplayClass8_0.<<WithinTransaction>g__Create|0>d.MoveNext() in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 139
--- End of stack trace from previous location ---
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.WithinTransaction[T](DbContext context, CancellationToken cancellationToken, Func`1 callback) in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 164
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.WithinTransaction[T](DbContext context, CancellationToken cancellationToken, Func`1 callback) in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 183
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.WithinTransaction[T](DbContext context, CancellationToken cancellationToken, Func`1 callback) in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 183
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.Send[T](ConsumeContext`1 context, IPipe`1 next) in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 64
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.Send[T](ConsumeContext`1 context, IPipe`1 next) in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 68
   at MassTransit.DependencyInjection.DependencyInjectionSagaRepositoryContextFactory`1.<>c__DisplayClass6_0`1.<<Send>g__CreateScope|0>d.MoveNext() in /_/src/MassTransit/DependencyInjection/DependencyInjection/DependencyInjectionSagaRepositoryContextFactory.cs:line 84
--- End of stack trace from previous location ---
   at MassTransit.DependencyInjection.DependencyInjectionSagaRepositoryContextFactory`1.<>c__DisplayClass6_0`1.<<Send>g__CreateScope|0>d.MoveNext() in /_/src/MassTransit/DependencyInjection/DependencyInjection/DependencyInjectionSagaRepositoryContextFactory.cs:line 91
--- End of stack trace from previous location ---
   at MassTransit.Middleware.CorrelatedSagaFilter`2.MassTransit.IFilter<MassTransit.ConsumeContext<TMessage>>.Send(ConsumeContext`1 context, IPipe`1 next) in /_/src/MassTransit/Middleware/CorrelatedSagaFilter.cs:line 46
   at MassTransit.Middleware.CorrelatedSagaFilter`2.MassTransit.IFilter<MassTransit.ConsumeContext<TMessage>>.Send(ConsumeContext`1 context, IPipe`1 next) in /_/src/MassTransit/Middleware/CorrelatedSagaFilter.cs:line 64
   at MassTransit.Middleware.RetryFilter`1.MassTransit.IFilter<TContext>.Send(TContext context, IPipe`1 next) in /_/src/MassTransit/Middleware/RetryFilter.cs:line 47
2022-08-05 22:07:44.405 +04:00 [INF] Entity Framework Core 6.0.3 initialized 'SagasDbContext' using provider 'Npgsql.EntityFrameworkCore.PostgreSQL:6.0.3+94d0a8eaeb9cf5af6ce55a9e59153c1a1be3244f' with options: None
2022-08-05 22:07:44.407 +04:00 [DBG] Opening connection to database 'sagas_db' on server ''.
2022-08-05 22:07:44.408 +04:00 [DBG] Opened connection to database 'sagas_db' on server 'tcp://localhost:3462'.
2022-08-05 22:07:44.409 +04:00 [DBG] Beginning transaction with isolation level 'Serializable'.
2022-08-05 22:07:44.410 +04:00 [DBG] Began transaction with isolation level 'Serializable'.
2022-08-05 22:07:44.411 +04:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2022-08-05 22:07:44.412 +04:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2022-08-05 22:07:44.413 +04:00 [DBG] Executing DbCommand [Parameters=[p0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT b."CorrelationId", b."CurrentState", b."RequestId", b."ResponseAddress"
FROM (
    SELECT * FROM "public"."BuyItemsSagaState" WHERE "CorrelationId" = @p0 FOR UPDATE
) AS b
LIMIT 2
2022-08-05 22:07:44.417 +04:00 [INF] Executed DbCommand (3ms) [Parameters=[p0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT b."CorrelationId", b."CurrentState", b."RequestId", b."ResponseAddress"
FROM (
    SELECT * FROM "public"."BuyItemsSagaState" WHERE "CorrelationId" = @p0 FOR UPDATE
) AS b
LIMIT 2
2022-08-05 22:07:44.419 +04:00 [DBG] Context 'SagasDbContext' started tracking 'BuyItemsSagaState' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2022-08-05 22:07:44.424 +04:00 [DBG] A data reader was disposed.
2022-08-05 22:07:44.425 +04:00 [DBG] SAGA:BuyItemsSagaState:"3fa85f64-5717-4562-b3fc-2c963f66afa6" Used MassTransit.Contracts.RequestTimeoutExpired<Contracts.IGetItemsRequest>
2022-08-05 22:07:44.428 +04:00 [DBG] Rolling back transaction.
2022-08-05 22:07:44.430 +04:00 [DBG] Rolled back transaction.
2022-08-05 22:07:44.430 +04:00 [DBG] Closing connection to database 'sagas_db' on server 'tcp://localhost:3462'.
2022-08-05 22:07:44.431 +04:00 [DBG] Closed connection to database 'sagas_db' on server ''.
2022-08-05 22:07:44.433 +04:00 [DBG] Disposing transaction.
2022-08-05 22:07:44.434 +04:00 [DBG] 'SagasDbContext' disposed.
2022-08-05 22:07:44.436 +04:00 [WRN] R-RETRY "rabbitmq://localhost/buy-items-saga-state" "0c5b0000-5df3-0015-ff7e-08da770d5367" MassTransit.RetryPolicies.RetryConsumeContext<MassTransit.Contracts.RequestTimeoutExpired<Contracts.IGetItemsRequest>>
MassTransit.NotAcceptedStateMachineException: BuyItemsSagaState(3fa85f64-5717-4562-b3fc-2c963f66afa6) Saga exception on receipt of MassTransit.Contracts.RequestTimeoutExpired<Contracts.IGetItemsRequest>: Not accepted in state Final
 ---> MassTransit.UnhandledEventException: The GetItems.TimeoutExpired event is not handled during the Final state for the BuyItemsSaga state machine
   at MassTransit.MassTransitStateMachine`1.DefaultUnhandledEventCallback(UnhandledEventContext`1 context) in /_/src/MassTransit/SagaStateMachine/MassTransitStateMachine.cs:line 221
   at MassTransit.MassTransitStateMachine`1.UnhandledEvent(BehaviorContext`1 context, State state) in /_/src/MassTransit/SagaStateMachine/MassTransitStateMachine.cs:line 1288
   at MassTransit.MassTransitStateMachine`1.<.ctor>b__14_2(BehaviorContext`1 context, State state) in /_/src/MassTransit/SagaStateMachine/MassTransitStateMachine.cs:line 54
   at MassTransit.SagaStateMachine.StateMachineState`1.MassTransit.State<TSaga>.Raise[T](BehaviorContext`2 context) in /_/src/MassTransit/SagaStateMachine/SagaStateMachine/StateMachineState.cs:line 162
   at MassTransit.MassTransitStateMachine`1.MassTransit.StateMachine<TInstance>.RaiseEvent[T](BehaviorContext`2 context) in /_/src/MassTransit/SagaStateMachine/MassTransitStateMachine.cs:line 134
   at MassTransit.Middleware.StateMachineSagaMessageFilter`2.Send(SagaConsumeContext`2 context, IPipe`1 next) in /_/src/MassTransit/Middleware/StateMachineSagaMessageFilter.cs:line 60
   --- End of inner exception stack trace ---
   at MassTransit.Middleware.StateMachineSagaMessageFilter`2.Send(SagaConsumeContext`2 context, IPipe`1 next) in /_/src/MassTransit/Middleware/StateMachineSagaMessageFilter.cs:line 69
   at MassTransit.Middleware.StateMachineSagaMessageFilter`2.Send(SagaConsumeContext`2 context, IPipe`1 next) in /_/src/MassTransit/Middleware/StateMachineSagaMessageFilter.cs:line 74
   at MassTransit.Middleware.SendSagaPipe`2.Send(SagaRepositoryContext`2 context) in /_/src/MassTransit/Middleware/SendSagaPipe.cs:line 43
   at MassTransit.Middleware.SendSagaPipe`2.Send(SagaRepositoryContext`2 context) in /_/src/MassTransit/Middleware/SendSagaPipe.cs:line 67
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.<>c__DisplayClass5_0`1.<<Send>b__1>d.MoveNext() in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 56
--- End of stack trace from previous location ---
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.<>c__DisplayClass8_0.<<WithinTransaction>g__Create|0>d.MoveNext() in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 139
--- End of stack trace from previous location ---
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.WithinTransaction[T](DbContext context, CancellationToken cancellationToken, Func`1 callback) in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 164
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.WithinTransaction[T](DbContext context, CancellationToken cancellationToken, Func`1 callback) in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 183
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.WithinTransaction[T](DbContext context, CancellationToken cancellationToken, Func`1 callback) in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 183
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.Send[T](ConsumeContext`1 context, IPipe`1 next) in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 64
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.Send[T](ConsumeContext`1 context, IPipe`1 next) in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 68
   at MassTransit.DependencyInjection.DependencyInjectionSagaRepositoryContextFactory`1.<>c__DisplayClass6_0`1.<<Send>g__CreateScope|0>d.MoveNext() in /_/src/MassTransit/DependencyInjection/DependencyInjection/DependencyInjectionSagaRepositoryContextFactory.cs:line 84
--- End of stack trace from previous location ---
   at MassTransit.DependencyInjection.DependencyInjectionSagaRepositoryContextFactory`1.<>c__DisplayClass6_0`1.<<Send>g__CreateScope|0>d.MoveNext() in /_/src/MassTransit/DependencyInjection/DependencyInjection/DependencyInjectionSagaRepositoryContextFactory.cs:line 91
--- End of stack trace from previous location ---
   at MassTransit.Middleware.CorrelatedSagaFilter`2.MassTransit.IFilter<MassTransit.ConsumeContext<TMessage>>.Send(ConsumeContext`1 context, IPipe`1 next) in /_/src/MassTransit/Middleware/CorrelatedSagaFilter.cs:line 46
   at MassTransit.Middleware.CorrelatedSagaFilter`2.MassTransit.IFilter<MassTransit.ConsumeContext<TMessage>>.Send(ConsumeContext`1 context, IPipe`1 next) in /_/src/MassTransit/Middleware/CorrelatedSagaFilter.cs:line 64
   at MassTransit.Middleware.RetryFilter`1.MassTransit.IFilter<TContext>.Send(TContext context, IPipe`1 next) in /_/src/MassTransit/Middleware/RetryFilter.cs:line 47
2022-08-05 22:07:44.840 +04:00 [INF] Entity Framework Core 6.0.3 initialized 'SagasDbContext' using provider 'Npgsql.EntityFrameworkCore.PostgreSQL:6.0.3+94d0a8eaeb9cf5af6ce55a9e59153c1a1be3244f' with options: None
2022-08-05 22:07:44.843 +04:00 [DBG] Opening connection to database 'sagas_db' on server ''.
2022-08-05 22:07:44.844 +04:00 [DBG] Opened connection to database 'sagas_db' on server 'tcp://localhost:3462'.
2022-08-05 22:07:44.845 +04:00 [DBG] Beginning transaction with isolation level 'Serializable'.
2022-08-05 22:07:44.846 +04:00 [DBG] Began transaction with isolation level 'Serializable'.
2022-08-05 22:07:44.847 +04:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2022-08-05 22:07:44.847 +04:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2022-08-05 22:07:44.848 +04:00 [DBG] Executing DbCommand [Parameters=[p0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT b."CorrelationId", b."CurrentState", b."RequestId", b."ResponseAddress"
FROM (
    SELECT * FROM "public"."BuyItemsSagaState" WHERE "CorrelationId" = @p0 FOR UPDATE
) AS b
LIMIT 2
2022-08-05 22:07:44.854 +04:00 [INF] Executed DbCommand (6ms) [Parameters=[p0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT b."CorrelationId", b."CurrentState", b."RequestId", b."ResponseAddress"
FROM (
    SELECT * FROM "public"."BuyItemsSagaState" WHERE "CorrelationId" = @p0 FOR UPDATE
) AS b
LIMIT 2
2022-08-05 22:07:44.858 +04:00 [DBG] Context 'SagasDbContext' started tracking 'BuyItemsSagaState' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2022-08-05 22:07:44.859 +04:00 [DBG] A data reader was disposed.
2022-08-05 22:07:44.860 +04:00 [DBG] SAGA:BuyItemsSagaState:"3fa85f64-5717-4562-b3fc-2c963f66afa6" Used MassTransit.Contracts.RequestTimeoutExpired<Contracts.IGetMoneyRequest>
2022-08-05 22:07:44.862 +04:00 [DBG] Rolling back transaction.
2022-08-05 22:07:44.863 +04:00 [DBG] Rolled back transaction.
2022-08-05 22:07:44.864 +04:00 [DBG] Closing connection to database 'sagas_db' on server 'tcp://localhost:3462'.
2022-08-05 22:07:44.865 +04:00 [DBG] Closed connection to database 'sagas_db' on server ''.
2022-08-05 22:07:44.866 +04:00 [DBG] Disposing transaction.
2022-08-05 22:07:44.867 +04:00 [DBG] 'SagasDbContext' disposed.
2022-08-05 22:07:45.463 +04:00 [INF] Entity Framework Core 6.0.3 initialized 'SagasDbContext' using provider 'Npgsql.EntityFrameworkCore.PostgreSQL:6.0.3+94d0a8eaeb9cf5af6ce55a9e59153c1a1be3244f' with options: None
2022-08-05 22:07:45.465 +04:00 [DBG] Opening connection to database 'sagas_db' on server ''.
2022-08-05 22:07:45.466 +04:00 [DBG] Opened connection to database 'sagas_db' on server 'tcp://localhost:3462'.
2022-08-05 22:07:45.467 +04:00 [DBG] Beginning transaction with isolation level 'Serializable'.
2022-08-05 22:07:45.468 +04:00 [DBG] Began transaction with isolation level 'Serializable'.
2022-08-05 22:07:45.469 +04:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2022-08-05 22:07:45.469 +04:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2022-08-05 22:07:45.470 +04:00 [DBG] Executing DbCommand [Parameters=[p0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT b."CorrelationId", b."CurrentState", b."RequestId", b."ResponseAddress"
FROM (
    SELECT * FROM "public"."BuyItemsSagaState" WHERE "CorrelationId" = @p0 FOR UPDATE
) AS b
LIMIT 2
2022-08-05 22:07:45.474 +04:00 [INF] Executed DbCommand (3ms) [Parameters=[p0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT b."CorrelationId", b."CurrentState", b."RequestId", b."ResponseAddress"
FROM (
    SELECT * FROM "public"."BuyItemsSagaState" WHERE "CorrelationId" = @p0 FOR UPDATE
) AS b
LIMIT 2
2022-08-05 22:07:45.476 +04:00 [DBG] Context 'SagasDbContext' started tracking 'BuyItemsSagaState' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2022-08-05 22:07:45.479 +04:00 [DBG] A data reader was disposed.
2022-08-05 22:07:45.479 +04:00 [DBG] SAGA:BuyItemsSagaState:"3fa85f64-5717-4562-b3fc-2c963f66afa6" Used MassTransit.Contracts.RequestTimeoutExpired<Contracts.IGetItemsRequest>
2022-08-05 22:07:45.482 +04:00 [DBG] Rolling back transaction.
2022-08-05 22:07:45.483 +04:00 [DBG] Rolled back transaction.
2022-08-05 22:07:45.484 +04:00 [DBG] Closing connection to database 'sagas_db' on server 'tcp://localhost:3462'.
2022-08-05 22:07:45.485 +04:00 [DBG] Closed connection to database 'sagas_db' on server ''.
2022-08-05 22:07:45.485 +04:00 [DBG] Disposing transaction.
2022-08-05 22:07:45.486 +04:00 [DBG] 'SagasDbContext' disposed.
2022-08-05 22:07:46.872 +04:00 [INF] Entity Framework Core 6.0.3 initialized 'SagasDbContext' using provider 'Npgsql.EntityFrameworkCore.PostgreSQL:6.0.3+94d0a8eaeb9cf5af6ce55a9e59153c1a1be3244f' with options: None
2022-08-05 22:07:46.877 +04:00 [DBG] Opening connection to database 'sagas_db' on server ''.
2022-08-05 22:07:46.878 +04:00 [DBG] Opened connection to database 'sagas_db' on server 'tcp://localhost:3462'.
2022-08-05 22:07:46.878 +04:00 [DBG] Beginning transaction with isolation level 'Serializable'.
2022-08-05 22:07:46.879 +04:00 [DBG] Began transaction with isolation level 'Serializable'.
2022-08-05 22:07:46.880 +04:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2022-08-05 22:07:46.881 +04:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2022-08-05 22:07:46.882 +04:00 [DBG] Executing DbCommand [Parameters=[p0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT b."CorrelationId", b."CurrentState", b."RequestId", b."ResponseAddress"
FROM (
    SELECT * FROM "public"."BuyItemsSagaState" WHERE "CorrelationId" = @p0 FOR UPDATE
) AS b
LIMIT 2
2022-08-05 22:07:46.885 +04:00 [INF] Executed DbCommand (3ms) [Parameters=[p0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT b."CorrelationId", b."CurrentState", b."RequestId", b."ResponseAddress"
FROM (
    SELECT * FROM "public"."BuyItemsSagaState" WHERE "CorrelationId" = @p0 FOR UPDATE
) AS b
LIMIT 2
2022-08-05 22:07:46.887 +04:00 [DBG] Context 'SagasDbContext' started tracking 'BuyItemsSagaState' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2022-08-05 22:07:46.890 +04:00 [DBG] A data reader was disposed.
2022-08-05 22:07:46.891 +04:00 [DBG] SAGA:BuyItemsSagaState:"3fa85f64-5717-4562-b3fc-2c963f66afa6" Used MassTransit.Contracts.RequestTimeoutExpired<Contracts.IGetMoneyRequest>
2022-08-05 22:07:46.893 +04:00 [DBG] Rolling back transaction.
2022-08-05 22:07:46.894 +04:00 [DBG] Rolled back transaction.
2022-08-05 22:07:46.895 +04:00 [DBG] Closing connection to database 'sagas_db' on server 'tcp://localhost:3462'.
2022-08-05 22:07:46.896 +04:00 [DBG] Closed connection to database 'sagas_db' on server ''.
2022-08-05 22:07:46.897 +04:00 [DBG] Disposing transaction.
2022-08-05 22:07:46.897 +04:00 [DBG] 'SagasDbContext' disposed.
2022-08-05 22:07:47.494 +04:00 [INF] Entity Framework Core 6.0.3 initialized 'SagasDbContext' using provider 'Npgsql.EntityFrameworkCore.PostgreSQL:6.0.3+94d0a8eaeb9cf5af6ce55a9e59153c1a1be3244f' with options: None
2022-08-05 22:07:47.500 +04:00 [DBG] Opening connection to database 'sagas_db' on server ''.
2022-08-05 22:07:47.501 +04:00 [DBG] Opened connection to database 'sagas_db' on server 'tcp://localhost:3462'.
2022-08-05 22:07:47.502 +04:00 [DBG] Beginning transaction with isolation level 'Serializable'.
2022-08-05 22:07:47.502 +04:00 [DBG] Began transaction with isolation level 'Serializable'.
2022-08-05 22:07:47.504 +04:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2022-08-05 22:07:47.505 +04:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2022-08-05 22:07:47.505 +04:00 [DBG] Executing DbCommand [Parameters=[p0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT b."CorrelationId", b."CurrentState", b."RequestId", b."ResponseAddress"
FROM (
    SELECT * FROM "public"."BuyItemsSagaState" WHERE "CorrelationId" = @p0 FOR UPDATE
) AS b
LIMIT 2
2022-08-05 22:07:47.509 +04:00 [INF] Executed DbCommand (3ms) [Parameters=[p0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT b."CorrelationId", b."CurrentState", b."RequestId", b."ResponseAddress"
FROM (
    SELECT * FROM "public"."BuyItemsSagaState" WHERE "CorrelationId" = @p0 FOR UPDATE
) AS b
LIMIT 2
2022-08-05 22:07:47.512 +04:00 [DBG] Context 'SagasDbContext' started tracking 'BuyItemsSagaState' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2022-08-05 22:07:47.513 +04:00 [DBG] A data reader was disposed.
2022-08-05 22:07:47.514 +04:00 [DBG] SAGA:BuyItemsSagaState:"3fa85f64-5717-4562-b3fc-2c963f66afa6" Used MassTransit.Contracts.RequestTimeoutExpired<Contracts.IGetItemsRequest>
2022-08-05 22:07:47.516 +04:00 [DBG] Rolling back transaction.
2022-08-05 22:07:47.518 +04:00 [DBG] Rolled back transaction.
2022-08-05 22:07:47.518 +04:00 [DBG] Closing connection to database 'sagas_db' on server 'tcp://localhost:3462'.
2022-08-05 22:07:47.519 +04:00 [DBG] Closed connection to database 'sagas_db' on server ''.
2022-08-05 22:07:47.520 +04:00 [DBG] Disposing transaction.
2022-08-05 22:07:47.521 +04:00 [DBG] 'SagasDbContext' disposed.
2022-08-05 22:07:49.907 +04:00 [INF] Entity Framework Core 6.0.3 initialized 'SagasDbContext' using provider 'Npgsql.EntityFrameworkCore.PostgreSQL:6.0.3+94d0a8eaeb9cf5af6ce55a9e59153c1a1be3244f' with options: None
2022-08-05 22:07:49.910 +04:00 [DBG] Opening connection to database 'sagas_db' on server ''.
2022-08-05 22:07:49.911 +04:00 [DBG] Opened connection to database 'sagas_db' on server 'tcp://localhost:3462'.
2022-08-05 22:07:49.913 +04:00 [DBG] Beginning transaction with isolation level 'Serializable'.
2022-08-05 22:07:49.913 +04:00 [DBG] Began transaction with isolation level 'Serializable'.
2022-08-05 22:07:49.915 +04:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2022-08-05 22:07:49.915 +04:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2022-08-05 22:07:49.916 +04:00 [DBG] Executing DbCommand [Parameters=[p0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT b."CorrelationId", b."CurrentState", b."RequestId", b."ResponseAddress"
FROM (
    SELECT * FROM "public"."BuyItemsSagaState" WHERE "CorrelationId" = @p0 FOR UPDATE
) AS b
LIMIT 2
2022-08-05 22:07:49.919 +04:00 [INF] Executed DbCommand (3ms) [Parameters=[p0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT b."CorrelationId", b."CurrentState", b."RequestId", b."ResponseAddress"
FROM (
    SELECT * FROM "public"."BuyItemsSagaState" WHERE "CorrelationId" = @p0 FOR UPDATE
) AS b
LIMIT 2
2022-08-05 22:07:49.921 +04:00 [DBG] Context 'SagasDbContext' started tracking 'BuyItemsSagaState' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2022-08-05 22:07:49.926 +04:00 [DBG] A data reader was disposed.
2022-08-05 22:07:49.927 +04:00 [DBG] SAGA:BuyItemsSagaState:"3fa85f64-5717-4562-b3fc-2c963f66afa6" Used MassTransit.Contracts.RequestTimeoutExpired<Contracts.IGetMoneyRequest>
2022-08-05 22:07:49.930 +04:00 [DBG] Rolling back transaction.
2022-08-05 22:07:49.932 +04:00 [DBG] Rolled back transaction.
2022-08-05 22:07:49.933 +04:00 [DBG] Closing connection to database 'sagas_db' on server 'tcp://localhost:3462'.
2022-08-05 22:07:49.934 +04:00 [DBG] Closed connection to database 'sagas_db' on server ''.
2022-08-05 22:07:49.935 +04:00 [DBG] Disposing transaction.
2022-08-05 22:07:49.936 +04:00 [DBG] 'SagasDbContext' disposed.
2022-08-05 22:07:49.959 +04:00 [DBG] Declare exchange: name: MassTransit:Fault--MassTransit.Contracts:RequestTimeoutExpired--Contracts:IGetMoneyRequest----, type: fanout, durable
2022-08-05 22:07:49.966 +04:00 [DBG] Declare exchange: name: MassTransit:Fault, type: fanout, durable
2022-08-05 22:07:49.981 +04:00 [DBG] Bind exchange: source: MassTransit:Fault--MassTransit.Contracts:RequestTimeoutExpired--Contracts:IGetMoneyRequest----, destination: MassTransit:Fault
2022-08-05 22:07:50.013 +04:00 [DBG] SEND "rabbitmq://localhost/MassTransit:Fault--MassTransit.Contracts:RequestTimeoutExpired--Contracts:IGetMoneyRequest----" "0c5b0000-5df3-0015-1d5c-08da770d68a1" MassTransit.Fault<MassTransit.Contracts.RequestTimeoutExpired<Contracts.IGetMoneyRequest>>
2022-08-05 22:07:50.017 +04:00 [ERR] R-FAULT "rabbitmq://localhost/buy-items-saga-state" "0c5b0000-5df3-0015-22d9-08da770d52f9" MassTransit.Contracts.RequestTimeoutExpired<Contracts.IGetMoneyRequest> BuyItemsSagaState("00:00:00.0311096")
MassTransit.NotAcceptedStateMachineException: BuyItemsSagaState(3fa85f64-5717-4562-b3fc-2c963f66afa6) Saga exception on receipt of MassTransit.Contracts.RequestTimeoutExpired<Contracts.IGetMoneyRequest>: Not accepted in state Final
 ---> MassTransit.UnhandledEventException: The GetMoney.TimeoutExpired event is not handled during the Final state for the BuyItemsSaga state machine
   at MassTransit.MassTransitStateMachine`1.DefaultUnhandledEventCallback(UnhandledEventContext`1 context) in /_/src/MassTransit/SagaStateMachine/MassTransitStateMachine.cs:line 221
   at MassTransit.MassTransitStateMachine`1.UnhandledEvent(BehaviorContext`1 context, State state) in /_/src/MassTransit/SagaStateMachine/MassTransitStateMachine.cs:line 1288
   at MassTransit.MassTransitStateMachine`1.<.ctor>b__14_2(BehaviorContext`1 context, State state) in /_/src/MassTransit/SagaStateMachine/MassTransitStateMachine.cs:line 54
   at MassTransit.SagaStateMachine.StateMachineState`1.MassTransit.State<TSaga>.Raise[T](BehaviorContext`2 context) in /_/src/MassTransit/SagaStateMachine/SagaStateMachine/StateMachineState.cs:line 162
   at MassTransit.MassTransitStateMachine`1.MassTransit.StateMachine<TInstance>.RaiseEvent[T](BehaviorContext`2 context) in /_/src/MassTransit/SagaStateMachine/MassTransitStateMachine.cs:line 134
   at MassTransit.Middleware.StateMachineSagaMessageFilter`2.Send(SagaConsumeContext`2 context, IPipe`1 next) in /_/src/MassTransit/Middleware/StateMachineSagaMessageFilter.cs:line 60
   --- End of inner exception stack trace ---
   at MassTransit.Middleware.StateMachineSagaMessageFilter`2.Send(SagaConsumeContext`2 context, IPipe`1 next) in /_/src/MassTransit/Middleware/StateMachineSagaMessageFilter.cs:line 69
   at MassTransit.Middleware.StateMachineSagaMessageFilter`2.Send(SagaConsumeContext`2 context, IPipe`1 next) in /_/src/MassTransit/Middleware/StateMachineSagaMessageFilter.cs:line 74
   at MassTransit.Middleware.SendSagaPipe`2.Send(SagaRepositoryContext`2 context) in /_/src/MassTransit/Middleware/SendSagaPipe.cs:line 43
   at MassTransit.Middleware.SendSagaPipe`2.Send(SagaRepositoryContext`2 context) in /_/src/MassTransit/Middleware/SendSagaPipe.cs:line 67
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.<>c__DisplayClass5_0`1.<<Send>b__1>d.MoveNext() in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 56
--- End of stack trace from previous location ---
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.<>c__DisplayClass8_0.<<WithinTransaction>g__Create|0>d.MoveNext() in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 139
--- End of stack trace from previous location ---
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.WithinTransaction[T](DbContext context, CancellationToken cancellationToken, Func`1 callback) in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 164
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.WithinTransaction[T](DbContext context, CancellationToken cancellationToken, Func`1 callback) in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 183
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.WithinTransaction[T](DbContext context, CancellationToken cancellationToken, Func`1 callback) in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 183
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.Send[T](ConsumeContext`1 context, IPipe`1 next) in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 64
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.Send[T](ConsumeContext`1 context, IPipe`1 next) in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 68
   at MassTransit.DependencyInjection.DependencyInjectionSagaRepositoryContextFactory`1.<>c__DisplayClass6_0`1.<<Send>g__CreateScope|0>d.MoveNext() in /_/src/MassTransit/DependencyInjection/DependencyInjection/DependencyInjectionSagaRepositoryContextFactory.cs:line 84
--- End of stack trace from previous location ---
   at MassTransit.DependencyInjection.DependencyInjectionSagaRepositoryContextFactory`1.<>c__DisplayClass6_0`1.<<Send>g__CreateScope|0>d.MoveNext() in /_/src/MassTransit/DependencyInjection/DependencyInjection/DependencyInjectionSagaRepositoryContextFactory.cs:line 91
--- End of stack trace from previous location ---
   at MassTransit.Middleware.CorrelatedSagaFilter`2.MassTransit.IFilter<MassTransit.ConsumeContext<TMessage>>.Send(ConsumeContext`1 context, IPipe`1 next) in /_/src/MassTransit/Middleware/CorrelatedSagaFilter.cs:line 46
   at MassTransit.Middleware.CorrelatedSagaFilter`2.MassTransit.IFilter<MassTransit.ConsumeContext<TMessage>>.Send(ConsumeContext`1 context, IPipe`1 next) in /_/src/MassTransit/Middleware/CorrelatedSagaFilter.cs:line 64
   at MassTransit.Middleware.RetryFilter`1.Attempt(TContext context, RetryContext`1 retryContext, IPipe`1 next) in /_/src/MassTransit/Middleware/RetryFilter.cs:line 158
2022-08-05 22:07:50.052 +04:00 [DBG] Declare queue: name: buy-items-saga-state_error, durable, consumer-count: 0 message-count: 0
2022-08-05 22:07:50.078 +04:00 [DBG] Declare exchange: name: buy-items-saga-state_error, type: fanout, durable
2022-08-05 22:07:50.088 +04:00 [DBG] Bind queue: source: buy-items-saga-state_error, destination: buy-items-saga-state_error
2022-08-05 22:07:50.532 +04:00 [INF] Entity Framework Core 6.0.3 initialized 'SagasDbContext' using provider 'Npgsql.EntityFrameworkCore.PostgreSQL:6.0.3+94d0a8eaeb9cf5af6ce55a9e59153c1a1be3244f' with options: None
2022-08-05 22:07:50.534 +04:00 [DBG] Opening connection to database 'sagas_db' on server ''.
2022-08-05 22:07:50.535 +04:00 [DBG] Opened connection to database 'sagas_db' on server 'tcp://localhost:3462'.
2022-08-05 22:07:50.536 +04:00 [DBG] Beginning transaction with isolation level 'Serializable'.
2022-08-05 22:07:50.537 +04:00 [DBG] Began transaction with isolation level 'Serializable'.
2022-08-05 22:07:50.538 +04:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2022-08-05 22:07:50.540 +04:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2022-08-05 22:07:50.541 +04:00 [DBG] Executing DbCommand [Parameters=[p0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT b."CorrelationId", b."CurrentState", b."RequestId", b."ResponseAddress"
FROM (
    SELECT * FROM "public"."BuyItemsSagaState" WHERE "CorrelationId" = @p0 FOR UPDATE
) AS b
LIMIT 2
2022-08-05 22:07:50.544 +04:00 [INF] Executed DbCommand (3ms) [Parameters=[p0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT b."CorrelationId", b."CurrentState", b."RequestId", b."ResponseAddress"
FROM (
    SELECT * FROM "public"."BuyItemsSagaState" WHERE "CorrelationId" = @p0 FOR UPDATE
) AS b
LIMIT 2
2022-08-05 22:07:50.546 +04:00 [DBG] Context 'SagasDbContext' started tracking 'BuyItemsSagaState' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2022-08-05 22:07:50.547 +04:00 [DBG] A data reader was disposed.
2022-08-05 22:07:50.550 +04:00 [DBG] SAGA:BuyItemsSagaState:"3fa85f64-5717-4562-b3fc-2c963f66afa6" Used MassTransit.Contracts.RequestTimeoutExpired<Contracts.IGetItemsRequest>
2022-08-05 22:07:50.552 +04:00 [DBG] Rolling back transaction.
2022-08-05 22:07:50.554 +04:00 [DBG] Rolled back transaction.
2022-08-05 22:07:50.555 +04:00 [DBG] Closing connection to database 'sagas_db' on server 'tcp://localhost:3462'.
2022-08-05 22:07:50.556 +04:00 [DBG] Closed connection to database 'sagas_db' on server ''.
2022-08-05 22:07:50.557 +04:00 [DBG] Disposing transaction.
2022-08-05 22:07:50.558 +04:00 [DBG] 'SagasDbContext' disposed.
2022-08-05 22:07:50.567 +04:00 [DBG] Declare exchange: name: MassTransit:Fault--MassTransit.Contracts:RequestTimeoutExpired--Contracts:IGetItemsRequest----, type: fanout, durable
2022-08-05 22:07:50.584 +04:00 [DBG] Declare exchange: name: MassTransit:Fault, type: fanout, durable
2022-08-05 22:07:50.597 +04:00 [DBG] Bind exchange: source: MassTransit:Fault--MassTransit.Contracts:RequestTimeoutExpired--Contracts:IGetItemsRequest----, destination: MassTransit:Fault
2022-08-05 22:07:50.633 +04:00 [DBG] SEND "rabbitmq://localhost/MassTransit:Fault--MassTransit.Contracts:RequestTimeoutExpired--Contracts:IGetItemsRequest----" "0c5b0000-5df3-0015-b008-08da770d6900" MassTransit.Fault<MassTransit.Contracts.RequestTimeoutExpired<Contracts.IGetItemsRequest>>
2022-08-05 22:07:50.635 +04:00 [ERR] R-FAULT "rabbitmq://localhost/buy-items-saga-state" "0c5b0000-5df3-0015-ff7e-08da770d5367" MassTransit.Contracts.RequestTimeoutExpired<Contracts.IGetItemsRequest> BuyItemsSagaState("00:00:00.0272413")
MassTransit.NotAcceptedStateMachineException: BuyItemsSagaState(3fa85f64-5717-4562-b3fc-2c963f66afa6) Saga exception on receipt of MassTransit.Contracts.RequestTimeoutExpired<Contracts.IGetItemsRequest>: Not accepted in state Final
 ---> MassTransit.UnhandledEventException: The GetItems.TimeoutExpired event is not handled during the Final state for the BuyItemsSaga state machine
   at MassTransit.MassTransitStateMachine`1.DefaultUnhandledEventCallback(UnhandledEventContext`1 context) in /_/src/MassTransit/SagaStateMachine/MassTransitStateMachine.cs:line 221
   at MassTransit.MassTransitStateMachine`1.UnhandledEvent(BehaviorContext`1 context, State state) in /_/src/MassTransit/SagaStateMachine/MassTransitStateMachine.cs:line 1288
   at MassTransit.MassTransitStateMachine`1.<.ctor>b__14_2(BehaviorContext`1 context, State state) in /_/src/MassTransit/SagaStateMachine/MassTransitStateMachine.cs:line 54
   at MassTransit.SagaStateMachine.StateMachineState`1.MassTransit.State<TSaga>.Raise[T](BehaviorContext`2 context) in /_/src/MassTransit/SagaStateMachine/SagaStateMachine/StateMachineState.cs:line 162
   at MassTransit.MassTransitStateMachine`1.MassTransit.StateMachine<TInstance>.RaiseEvent[T](BehaviorContext`2 context) in /_/src/MassTransit/SagaStateMachine/MassTransitStateMachine.cs:line 134
   at MassTransit.Middleware.StateMachineSagaMessageFilter`2.Send(SagaConsumeContext`2 context, IPipe`1 next) in /_/src/MassTransit/Middleware/StateMachineSagaMessageFilter.cs:line 60
   --- End of inner exception stack trace ---
   at MassTransit.Middleware.StateMachineSagaMessageFilter`2.Send(SagaConsumeContext`2 context, IPipe`1 next) in /_/src/MassTransit/Middleware/StateMachineSagaMessageFilter.cs:line 69
   at MassTransit.Middleware.StateMachineSagaMessageFilter`2.Send(SagaConsumeContext`2 context, IPipe`1 next) in /_/src/MassTransit/Middleware/StateMachineSagaMessageFilter.cs:line 74
   at MassTransit.Middleware.SendSagaPipe`2.Send(SagaRepositoryContext`2 context) in /_/src/MassTransit/Middleware/SendSagaPipe.cs:line 43
   at MassTransit.Middleware.SendSagaPipe`2.Send(SagaRepositoryContext`2 context) in /_/src/MassTransit/Middleware/SendSagaPipe.cs:line 67
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.<>c__DisplayClass5_0`1.<<Send>b__1>d.MoveNext() in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 56
--- End of stack trace from previous location ---
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.<>c__DisplayClass8_0.<<WithinTransaction>g__Create|0>d.MoveNext() in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 139
--- End of stack trace from previous location ---
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.WithinTransaction[T](DbContext context, CancellationToken cancellationToken, Func`1 callback) in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 164
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.WithinTransaction[T](DbContext context, CancellationToken cancellationToken, Func`1 callback) in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 183
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.WithinTransaction[T](DbContext context, CancellationToken cancellationToken, Func`1 callback) in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 183
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.Send[T](ConsumeContext`1 context, IPipe`1 next) in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 64
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.Send[T](ConsumeContext`1 context, IPipe`1 next) in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 68
   at MassTransit.DependencyInjection.DependencyInjectionSagaRepositoryContextFactory`1.<>c__DisplayClass6_0`1.<<Send>g__CreateScope|0>d.MoveNext() in /_/src/MassTransit/DependencyInjection/DependencyInjection/DependencyInjectionSagaRepositoryContextFactory.cs:line 84
--- End of stack trace from previous location ---
   at MassTransit.DependencyInjection.DependencyInjectionSagaRepositoryContextFactory`1.<>c__DisplayClass6_0`1.<<Send>g__CreateScope|0>d.MoveNext() in /_/src/MassTransit/DependencyInjection/DependencyInjection/DependencyInjectionSagaRepositoryContextFactory.cs:line 91
--- End of stack trace from previous location ---
   at MassTransit.Middleware.CorrelatedSagaFilter`2.MassTransit.IFilter<MassTransit.ConsumeContext<TMessage>>.Send(ConsumeContext`1 context, IPipe`1 next) in /_/src/MassTransit/Middleware/CorrelatedSagaFilter.cs:line 46
   at MassTransit.Middleware.CorrelatedSagaFilter`2.MassTransit.IFilter<MassTransit.ConsumeContext<TMessage>>.Send(ConsumeContext`1 context, IPipe`1 next) in /_/src/MassTransit/Middleware/CorrelatedSagaFilter.cs:line 64
   at MassTransit.Middleware.RetryFilter`1.Attempt(TContext context, RetryContext`1 retryContext, IPipe`1 next) in /_/src/MassTransit/Middleware/RetryFilter.cs:line 158
2022-08-05 22:08:23.334 +04:00 [DBG] Connection id "0HMJN1KRF0J7K" received FIN.
2022-08-05 22:08:23.337 +04:00 [DBG] Connection id "0HMJN1KRF0J7K" sending FIN because: "The client closed the connection."
2022-08-05 22:08:23.338 +04:00 [DBG] Connection id "0HMJN1KRF0J7K" disconnecting.
2022-08-05 22:08:23.339 +04:00 [DBG] Connection id "0HMJN1KRF0J7K" stopped.
2022-08-05 22:09:50.928 +04:00 [INF] Entity Framework Core 6.0.3 initialized 'SagasDbContext' using provider 'Npgsql.EntityFrameworkCore.PostgreSQL:6.0.3+94d0a8eaeb9cf5af6ce55a9e59153c1a1be3244f' with options: None
2022-08-05 22:09:50.929 +04:00 [DBG] Opening connection to database 'sagas_db' on server ''.
2022-08-05 22:09:50.930 +04:00 [DBG] Opened connection to database 'sagas_db' on server 'tcp://localhost:3462'.
2022-08-05 22:09:50.931 +04:00 [DBG] Beginning transaction with isolation level 'Serializable'.
2022-08-05 22:09:50.931 +04:00 [DBG] Began transaction with isolation level 'Serializable'.
2022-08-05 22:09:50.932 +04:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2022-08-05 22:09:50.933 +04:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2022-08-05 22:09:50.933 +04:00 [DBG] Executing DbCommand [Parameters=[p0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT b."CorrelationId", b."CurrentState", b."RequestId", b."ResponseAddress"
FROM (
    SELECT * FROM "public"."BuyItemsSagaState" WHERE "CorrelationId" = @p0 FOR UPDATE
) AS b
LIMIT 2
2022-08-05 22:09:50.938 +04:00 [INF] Executed DbCommand (4ms) [Parameters=[p0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT b."CorrelationId", b."CurrentState", b."RequestId", b."ResponseAddress"
FROM (
    SELECT * FROM "public"."BuyItemsSagaState" WHERE "CorrelationId" = @p0 FOR UPDATE
) AS b
LIMIT 2
2022-08-05 22:09:50.940 +04:00 [DBG] Context 'SagasDbContext' started tracking 'BuyItemsSagaState' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2022-08-05 22:09:50.941 +04:00 [DBG] A data reader was disposed.
2022-08-05 22:09:50.941 +04:00 [DBG] SAGA:BuyItemsSagaState:"3fa85f64-5717-4562-b3fc-2c963f66afa6" Used Contracts.BuyItemsRequest
2022-08-05 22:09:50.944 +04:00 [DBG] Rolling back transaction.
2022-08-05 22:09:50.945 +04:00 [DBG] Rolled back transaction.
2022-08-05 22:09:50.946 +04:00 [DBG] Closing connection to database 'sagas_db' on server 'tcp://localhost:3462'.
2022-08-05 22:09:50.946 +04:00 [DBG] Closed connection to database 'sagas_db' on server ''.
2022-08-05 22:09:50.947 +04:00 [DBG] Disposing transaction.
2022-08-05 22:09:50.948 +04:00 [DBG] 'SagasDbContext' disposed.
2022-08-05 22:09:50.950 +04:00 [WRN] R-RETRY "rabbitmq://localhost/buy-items-saga-state" "da210000-5df3-0015-ad1e-08da770db0b0" MassTransit.RetryPolicies.RetryConsumeContext<Contracts.BuyItemsRequest>
MassTransit.NotAcceptedStateMachineException: BuyItemsSagaState(3fa85f64-5717-4562-b3fc-2c963f66afa6) Saga exception on receipt of Contracts.BuyItemsRequest: Not accepted in state Final
 ---> MassTransit.UnhandledEventException: The BuyItems event is not handled during the Final state for the BuyItemsSaga state machine
   at MassTransit.MassTransitStateMachine`1.DefaultUnhandledEventCallback(UnhandledEventContext`1 context) in /_/src/MassTransit/SagaStateMachine/MassTransitStateMachine.cs:line 221
   at MassTransit.MassTransitStateMachine`1.UnhandledEvent(BehaviorContext`1 context, State state) in /_/src/MassTransit/SagaStateMachine/MassTransitStateMachine.cs:line 1288
   at MassTransit.MassTransitStateMachine`1.<.ctor>b__14_2(BehaviorContext`1 context, State state) in /_/src/MassTransit/SagaStateMachine/MassTransitStateMachine.cs:line 54
   at MassTransit.SagaStateMachine.StateMachineState`1.MassTransit.State<TSaga>.Raise[T](BehaviorContext`2 context) in /_/src/MassTransit/SagaStateMachine/SagaStateMachine/StateMachineState.cs:line 162
   at MassTransit.MassTransitStateMachine`1.MassTransit.StateMachine<TInstance>.RaiseEvent[T](BehaviorContext`2 context) in /_/src/MassTransit/SagaStateMachine/MassTransitStateMachine.cs:line 134
   at MassTransit.Middleware.StateMachineSagaMessageFilter`2.Send(SagaConsumeContext`2 context, IPipe`1 next) in /_/src/MassTransit/Middleware/StateMachineSagaMessageFilter.cs:line 60
   --- End of inner exception stack trace ---
   at MassTransit.Middleware.StateMachineSagaMessageFilter`2.Send(SagaConsumeContext`2 context, IPipe`1 next) in /_/src/MassTransit/Middleware/StateMachineSagaMessageFilter.cs:line 69
   at MassTransit.Middleware.StateMachineSagaMessageFilter`2.Send(SagaConsumeContext`2 context, IPipe`1 next) in /_/src/MassTransit/Middleware/StateMachineSagaMessageFilter.cs:line 74
   at MassTransit.Middleware.SendSagaPipe`2.Send(SagaRepositoryContext`2 context) in /_/src/MassTransit/Middleware/SendSagaPipe.cs:line 43
   at MassTransit.Middleware.SendSagaPipe`2.Send(SagaRepositoryContext`2 context) in /_/src/MassTransit/Middleware/SendSagaPipe.cs:line 67
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.<>c__DisplayClass5_0`1.<<Send>b__1>d.MoveNext() in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 56
--- End of stack trace from previous location ---
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.<>c__DisplayClass8_0.<<WithinTransaction>g__Create|0>d.MoveNext() in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 139
--- End of stack trace from previous location ---
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.WithinTransaction[T](DbContext context, CancellationToken cancellationToken, Func`1 callback) in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 185
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.WithinTransaction[T](DbContext context, CancellationToken cancellationToken, Func`1 callback) in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 185
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.WithinTransaction[T](DbContext context, CancellationToken cancellationToken, Func`1 callback) in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 185
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.Send[T](ConsumeContext`1 context, IPipe`1 next) in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 64
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.Send[T](ConsumeContext`1 context, IPipe`1 next) in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 68
   at MassTransit.DependencyInjection.DependencyInjectionSagaRepositoryContextFactory`1.<>c__DisplayClass6_0`1.<<Send>g__CreateScope|0>d.MoveNext() in /_/src/MassTransit/DependencyInjection/DependencyInjection/DependencyInjectionSagaRepositoryContextFactory.cs:line 84
--- End of stack trace from previous location ---
   at MassTransit.DependencyInjection.DependencyInjectionSagaRepositoryContextFactory`1.<>c__DisplayClass6_0`1.<<Send>g__CreateScope|0>d.MoveNext() in /_/src/MassTransit/DependencyInjection/DependencyInjection/DependencyInjectionSagaRepositoryContextFactory.cs:line 91
--- End of stack trace from previous location ---
   at MassTransit.Middleware.CorrelatedSagaFilter`2.MassTransit.IFilter<MassTransit.ConsumeContext<TMessage>>.Send(ConsumeContext`1 context, IPipe`1 next) in /_/src/MassTransit/Middleware/CorrelatedSagaFilter.cs:line 66
   at MassTransit.Middleware.CorrelatedSagaFilter`2.MassTransit.IFilter<MassTransit.ConsumeContext<TMessage>>.Send(ConsumeContext`1 context, IPipe`1 next) in /_/src/MassTransit/Middleware/CorrelatedSagaFilter.cs:line 66
   at MassTransit.Middleware.RetryFilter`1.MassTransit.IFilter<TContext>.Send(TContext context, IPipe`1 next) in /_/src/MassTransit/Middleware/RetryFilter.cs:line 47
2022-08-05 22:09:51.989 +04:00 [INF] Entity Framework Core 6.0.3 initialized 'SagasDbContext' using provider 'Npgsql.EntityFrameworkCore.PostgreSQL:6.0.3+94d0a8eaeb9cf5af6ce55a9e59153c1a1be3244f' with options: None
2022-08-05 22:09:51.992 +04:00 [DBG] Opening connection to database 'sagas_db' on server ''.
2022-08-05 22:09:51.994 +04:00 [DBG] Opened connection to database 'sagas_db' on server 'tcp://localhost:3462'.
2022-08-05 22:09:51.995 +04:00 [DBG] Beginning transaction with isolation level 'Serializable'.
2022-08-05 22:09:51.996 +04:00 [DBG] Began transaction with isolation level 'Serializable'.
2022-08-05 22:09:51.998 +04:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2022-08-05 22:09:51.999 +04:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2022-08-05 22:09:52.000 +04:00 [DBG] Executing DbCommand [Parameters=[p0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT b."CorrelationId", b."CurrentState", b."RequestId", b."ResponseAddress"
FROM (
    SELECT * FROM "public"."BuyItemsSagaState" WHERE "CorrelationId" = @p0 FOR UPDATE
) AS b
LIMIT 2
2022-08-05 22:09:52.008 +04:00 [INF] Executed DbCommand (8ms) [Parameters=[p0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT b."CorrelationId", b."CurrentState", b."RequestId", b."ResponseAddress"
FROM (
    SELECT * FROM "public"."BuyItemsSagaState" WHERE "CorrelationId" = @p0 FOR UPDATE
) AS b
LIMIT 2
2022-08-05 22:09:52.014 +04:00 [DBG] Context 'SagasDbContext' started tracking 'BuyItemsSagaState' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2022-08-05 22:09:52.018 +04:00 [DBG] A data reader was disposed.
2022-08-05 22:09:52.021 +04:00 [DBG] SAGA:BuyItemsSagaState:"3fa85f64-5717-4562-b3fc-2c963f66afa6" Used Contracts.BuyItemsRequest
2022-08-05 22:09:52.023 +04:00 [DBG] Rolling back transaction.
2022-08-05 22:09:52.025 +04:00 [DBG] Rolled back transaction.
2022-08-05 22:09:52.025 +04:00 [DBG] Closing connection to database 'sagas_db' on server 'tcp://localhost:3462'.
2022-08-05 22:09:52.027 +04:00 [DBG] Closed connection to database 'sagas_db' on server ''.
2022-08-05 22:09:52.028 +04:00 [DBG] Disposing transaction.
2022-08-05 22:09:52.029 +04:00 [DBG] 'SagasDbContext' disposed.
2022-08-05 22:09:54.039 +04:00 [INF] Entity Framework Core 6.0.3 initialized 'SagasDbContext' using provider 'Npgsql.EntityFrameworkCore.PostgreSQL:6.0.3+94d0a8eaeb9cf5af6ce55a9e59153c1a1be3244f' with options: None
2022-08-05 22:09:54.042 +04:00 [DBG] Opening connection to database 'sagas_db' on server ''.
2022-08-05 22:09:54.044 +04:00 [DBG] Opened connection to database 'sagas_db' on server 'tcp://localhost:3462'.
2022-08-05 22:09:54.044 +04:00 [DBG] Beginning transaction with isolation level 'Serializable'.
2022-08-05 22:09:54.046 +04:00 [DBG] Began transaction with isolation level 'Serializable'.
2022-08-05 22:09:54.047 +04:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2022-08-05 22:09:54.048 +04:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2022-08-05 22:09:54.049 +04:00 [DBG] Executing DbCommand [Parameters=[p0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT b."CorrelationId", b."CurrentState", b."RequestId", b."ResponseAddress"
FROM (
    SELECT * FROM "public"."BuyItemsSagaState" WHERE "CorrelationId" = @p0 FOR UPDATE
) AS b
LIMIT 2
2022-08-05 22:09:54.055 +04:00 [INF] Executed DbCommand (5ms) [Parameters=[p0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT b."CorrelationId", b."CurrentState", b."RequestId", b."ResponseAddress"
FROM (
    SELECT * FROM "public"."BuyItemsSagaState" WHERE "CorrelationId" = @p0 FOR UPDATE
) AS b
LIMIT 2
2022-08-05 22:09:54.058 +04:00 [DBG] Context 'SagasDbContext' started tracking 'BuyItemsSagaState' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2022-08-05 22:09:54.059 +04:00 [DBG] A data reader was disposed.
2022-08-05 22:09:54.059 +04:00 [DBG] SAGA:BuyItemsSagaState:"3fa85f64-5717-4562-b3fc-2c963f66afa6" Used Contracts.BuyItemsRequest
2022-08-05 22:09:54.061 +04:00 [DBG] Rolling back transaction.
2022-08-05 22:09:54.063 +04:00 [DBG] Rolled back transaction.
2022-08-05 22:09:54.063 +04:00 [DBG] Closing connection to database 'sagas_db' on server 'tcp://localhost:3462'.
2022-08-05 22:09:54.064 +04:00 [DBG] Closed connection to database 'sagas_db' on server ''.
2022-08-05 22:09:54.065 +04:00 [DBG] Disposing transaction.
2022-08-05 22:09:54.066 +04:00 [DBG] 'SagasDbContext' disposed.
2022-08-05 22:09:57.081 +04:00 [INF] Entity Framework Core 6.0.3 initialized 'SagasDbContext' using provider 'Npgsql.EntityFrameworkCore.PostgreSQL:6.0.3+94d0a8eaeb9cf5af6ce55a9e59153c1a1be3244f' with options: None
2022-08-05 22:09:57.090 +04:00 [DBG] Opening connection to database 'sagas_db' on server ''.
2022-08-05 22:09:57.091 +04:00 [DBG] Opened connection to database 'sagas_db' on server 'tcp://localhost:3462'.
2022-08-05 22:09:57.092 +04:00 [DBG] Beginning transaction with isolation level 'Serializable'.
2022-08-05 22:09:57.093 +04:00 [DBG] Began transaction with isolation level 'Serializable'.
2022-08-05 22:09:57.094 +04:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2022-08-05 22:09:57.094 +04:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2022-08-05 22:09:57.095 +04:00 [DBG] Executing DbCommand [Parameters=[p0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT b."CorrelationId", b."CurrentState", b."RequestId", b."ResponseAddress"
FROM (
    SELECT * FROM "public"."BuyItemsSagaState" WHERE "CorrelationId" = @p0 FOR UPDATE
) AS b
LIMIT 2
2022-08-05 22:09:57.106 +04:00 [INF] Executed DbCommand (10ms) [Parameters=[p0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT b."CorrelationId", b."CurrentState", b."RequestId", b."ResponseAddress"
FROM (
    SELECT * FROM "public"."BuyItemsSagaState" WHERE "CorrelationId" = @p0 FOR UPDATE
) AS b
LIMIT 2
2022-08-05 22:09:57.108 +04:00 [DBG] Context 'SagasDbContext' started tracking 'BuyItemsSagaState' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2022-08-05 22:09:57.109 +04:00 [DBG] A data reader was disposed.
2022-08-05 22:09:57.109 +04:00 [DBG] SAGA:BuyItemsSagaState:"3fa85f64-5717-4562-b3fc-2c963f66afa6" Used Contracts.BuyItemsRequest
2022-08-05 22:09:57.112 +04:00 [DBG] Rolling back transaction.
2022-08-05 22:09:57.116 +04:00 [DBG] Rolled back transaction.
2022-08-05 22:09:57.117 +04:00 [DBG] Closing connection to database 'sagas_db' on server 'tcp://localhost:3462'.
2022-08-05 22:09:57.118 +04:00 [DBG] Closed connection to database 'sagas_db' on server ''.
2022-08-05 22:09:57.119 +04:00 [DBG] Disposing transaction.
2022-08-05 22:09:57.120 +04:00 [DBG] 'SagasDbContext' disposed.
2022-08-05 22:09:57.130 +04:00 [DBG] SEND "rabbitmq://localhost:0/SMS2104090_ApiGateway_bus_5eooyyn76cybkadnbdp8qdj1ys?temporary=true" "0c5b0000-5df3-0015-60a0-08da770db466" MassTransit.Fault<Contracts.BuyItemsRequest>
2022-08-05 22:09:57.132 +04:00 [ERR] R-FAULT "rabbitmq://localhost/buy-items-saga-state" "da210000-5df3-0015-ad1e-08da770db0b0" Contracts.BuyItemsRequest BuyItemsSagaState("00:00:00.0402173")
MassTransit.NotAcceptedStateMachineException: BuyItemsSagaState(3fa85f64-5717-4562-b3fc-2c963f66afa6) Saga exception on receipt of Contracts.BuyItemsRequest: Not accepted in state Final
 ---> MassTransit.UnhandledEventException: The BuyItems event is not handled during the Final state for the BuyItemsSaga state machine
   at MassTransit.MassTransitStateMachine`1.DefaultUnhandledEventCallback(UnhandledEventContext`1 context) in /_/src/MassTransit/SagaStateMachine/MassTransitStateMachine.cs:line 221
   at MassTransit.MassTransitStateMachine`1.UnhandledEvent(BehaviorContext`1 context, State state) in /_/src/MassTransit/SagaStateMachine/MassTransitStateMachine.cs:line 1288
   at MassTransit.MassTransitStateMachine`1.<.ctor>b__14_2(BehaviorContext`1 context, State state) in /_/src/MassTransit/SagaStateMachine/MassTransitStateMachine.cs:line 54
   at MassTransit.SagaStateMachine.StateMachineState`1.MassTransit.State<TSaga>.Raise[T](BehaviorContext`2 context) in /_/src/MassTransit/SagaStateMachine/SagaStateMachine/StateMachineState.cs:line 162
   at MassTransit.MassTransitStateMachine`1.MassTransit.StateMachine<TInstance>.RaiseEvent[T](BehaviorContext`2 context) in /_/src/MassTransit/SagaStateMachine/MassTransitStateMachine.cs:line 134
   at MassTransit.Middleware.StateMachineSagaMessageFilter`2.Send(SagaConsumeContext`2 context, IPipe`1 next) in /_/src/MassTransit/Middleware/StateMachineSagaMessageFilter.cs:line 60
   --- End of inner exception stack trace ---
   at MassTransit.Middleware.StateMachineSagaMessageFilter`2.Send(SagaConsumeContext`2 context, IPipe`1 next) in /_/src/MassTransit/Middleware/StateMachineSagaMessageFilter.cs:line 69
   at MassTransit.Middleware.StateMachineSagaMessageFilter`2.Send(SagaConsumeContext`2 context, IPipe`1 next) in /_/src/MassTransit/Middleware/StateMachineSagaMessageFilter.cs:line 74
   at MassTransit.Middleware.SendSagaPipe`2.Send(SagaRepositoryContext`2 context) in /_/src/MassTransit/Middleware/SendSagaPipe.cs:line 74
   at MassTransit.Middleware.SendSagaPipe`2.Send(SagaRepositoryContext`2 context) in /_/src/MassTransit/Middleware/SendSagaPipe.cs:line 74
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.<>c__DisplayClass5_0`1.<<Send>b__1>d.MoveNext() in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 56
--- End of stack trace from previous location ---
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.<>c__DisplayClass8_0.<<WithinTransaction>g__Create|0>d.MoveNext() in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 139
--- End of stack trace from previous location ---
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.WithinTransaction[T](DbContext context, CancellationToken cancellationToken, Func`1 callback) in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 185
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.WithinTransaction[T](DbContext context, CancellationToken cancellationToken, Func`1 callback) in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 185
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.WithinTransaction[T](DbContext context, CancellationToken cancellationToken, Func`1 callback) in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 185
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.Send[T](ConsumeContext`1 context, IPipe`1 next) in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 64
   at MassTransit.EntityFrameworkCoreIntegration.Saga.EntityFrameworkSagaRepositoryContextFactory`1.Send[T](ConsumeContext`1 context, IPipe`1 next) in /_/src/Persistence/MassTransit.EntityFrameworkCoreIntegration/EntityFrameworkCoreIntegration/Saga/EntityFrameworkSagaRepositoryContextFactory.cs:line 68
   at MassTransit.DependencyInjection.DependencyInjectionSagaRepositoryContextFactory`1.<>c__DisplayClass6_0`1.<<Send>g__CreateScope|0>d.MoveNext() in /_/src/MassTransit/DependencyInjection/DependencyInjection/DependencyInjectionSagaRepositoryContextFactory.cs:line 84
--- End of stack trace from previous location ---
   at MassTransit.DependencyInjection.DependencyInjectionSagaRepositoryContextFactory`1.<>c__DisplayClass6_0`1.<<Send>g__CreateScope|0>d.MoveNext() in /_/src/MassTransit/DependencyInjection/DependencyInjection/DependencyInjectionSagaRepositoryContextFactory.cs:line 91
--- End of stack trace from previous location ---
   at MassTransit.Middleware.CorrelatedSagaFilter`2.MassTransit.IFilter<MassTransit.ConsumeContext<TMessage>>.Send(ConsumeContext`1 context, IPipe`1 next) in /_/src/MassTransit/Middleware/CorrelatedSagaFilter.cs:line 66
   at MassTransit.Middleware.CorrelatedSagaFilter`2.MassTransit.IFilter<MassTransit.ConsumeContext<TMessage>>.Send(ConsumeContext`1 context, IPipe`1 next) in /_/src/MassTransit/Middleware/CorrelatedSagaFilter.cs:line 66
   at MassTransit.Middleware.RetryFilter`1.Attempt(TContext context, RetryContext`1 retryContext, IPipe`1 next) in /_/src/MassTransit/Middleware/RetryFilter.cs:line 158
2022-08-05 22:10:04.209 +04:00 [INF] Entity Framework Core 6.0.3 initialized 'SagasDbContext' using provider 'Npgsql.EntityFrameworkCore.PostgreSQL:6.0.3+94d0a8eaeb9cf5af6ce55a9e59153c1a1be3244f' with options: None
2022-08-05 22:10:04.212 +04:00 [DBG] Opening connection to database 'sagas_db' on server ''.
2022-08-05 22:10:04.213 +04:00 [DBG] Opened connection to database 'sagas_db' on server 'tcp://localhost:3462'.
2022-08-05 22:10:04.215 +04:00 [DBG] Beginning transaction with isolation level 'Serializable'.
2022-08-05 22:10:04.217 +04:00 [DBG] Began transaction with isolation level 'Serializable'.
2022-08-05 22:10:04.218 +04:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2022-08-05 22:10:04.219 +04:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2022-08-05 22:10:04.223 +04:00 [DBG] Executing DbCommand [Parameters=[p0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT b."CorrelationId", b."CurrentState", b."RequestId", b."ResponseAddress"
FROM (
    SELECT * FROM "public"."BuyItemsSagaState" WHERE "CorrelationId" = @p0 FOR UPDATE
) AS b
LIMIT 2
2022-08-05 22:10:04.230 +04:00 [INF] Executed DbCommand (6ms) [Parameters=[p0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT b."CorrelationId", b."CurrentState", b."RequestId", b."ResponseAddress"
FROM (
    SELECT * FROM "public"."BuyItemsSagaState" WHERE "CorrelationId" = @p0 FOR UPDATE
) AS b
LIMIT 2
2022-08-05 22:10:04.232 +04:00 [DBG] A data reader was disposed.
2022-08-05 22:10:04.234 +04:00 [DBG] SAGA:BuyItemsSagaState:"4fa85f64-5717-4562-b3fc-2c963f66afa6" Created Contracts.BuyItemsRequest
2022-08-05 22:10:04.238 +04:00 [DBG] SAGA:BuyItemsSagaState:"4fa85f64-5717-4562-b3fc-2c963f66afa6" Added Contracts.BuyItemsRequest
2022-08-05 22:10:04.243 +04:00 [DBG] SEND "rabbitmq://localhost/buy-items-saga-state" "0c5b0000-5df3-0015-6220-08da770db8a4" MassTransit.Contracts.RequestTimeoutExpired<Contracts.IGetMoneyRequest>
2022-08-05 22:10:04.246 +04:00 [DBG] Context 'SagasDbContext' started tracking 'BuyItemsSagaState' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2022-08-05 22:10:04.248 +04:00 [DBG] SaveChanges starting for 'SagasDbContext'.
2022-08-05 22:10:04.249 +04:00 [DBG] DetectChanges starting for 'SagasDbContext'.
2022-08-05 22:10:04.250 +04:00 [DBG] DetectChanges completed for 'SagasDbContext'.
2022-08-05 22:10:04.252 +04:00 [DBG] Creating transaction savepoint.
2022-08-05 22:10:04.255 +04:00 [DBG] Created transaction savepoint.
2022-08-05 22:10:04.255 +04:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2022-08-05 22:10:04.256 +04:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2022-08-05 22:10:04.257 +04:00 [DBG] Executing DbCommand [Parameters=[@p0='?' (DbType = Guid), @p1='?', @p2='?' (DbType = Guid), @p3='?'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "BuyItemsSagaState" ("CorrelationId", "CurrentState", "RequestId", "ResponseAddress")
VALUES (@p0, @p1, @p2, @p3);
2022-08-05 22:10:04.259 +04:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?', @p2='?' (DbType = Guid), @p3='?'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "BuyItemsSagaState" ("CorrelationId", "CurrentState", "RequestId", "ResponseAddress")
VALUES (@p0, @p1, @p2, @p3);
2022-08-05 22:10:04.261 +04:00 [DBG] A data reader was disposed.
2022-08-05 22:10:04.262 +04:00 [DBG] Releasing transaction savepoint.
2022-08-05 22:10:04.263 +04:00 [DBG] Released transaction savepoint.
2022-08-05 22:10:04.263 +04:00 [DBG] An entity of type 'BuyItemsSagaState' tracked by 'SagasDbContext' changed state from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2022-08-05 22:10:04.265 +04:00 [DBG] SaveChanges completed for 'SagasDbContext' with 1 entities written to the database.
2022-08-05 22:10:04.269 +04:00 [DBG] Committing transaction.
2022-08-05 22:10:04.274 +04:00 [DBG] Committed transaction.
2022-08-05 22:10:04.274 +04:00 [DBG] Closing connection to database 'sagas_db' on server 'tcp://localhost:3462'.
2022-08-05 22:10:04.275 +04:00 [DBG] Closed connection to database 'sagas_db' on server ''.
2022-08-05 22:10:04.276 +04:00 [DBG] Disposing transaction.
2022-08-05 22:10:04.277 +04:00 [DBG] 'SagasDbContext' disposed.
2022-08-05 22:10:04.277 +04:00 [DBG] RECEIVE "rabbitmq://localhost/buy-items-saga-state" "da210000-5df3-0015-5ef4-08da770db89c" Contracts.BuyItemsRequest BuyItemsSagaState("00:00:00.0698636")
2022-08-05 22:10:04.287 +04:00 [DBG] SEND "rabbitmq://localhost/Contracts:IGetMoneyRequest" "0c5b0000-5df3-0015-425e-08da770db8aa" Contracts.IGetMoneyRequest
2022-08-05 22:10:14.080 +04:00 [INF] Entity Framework Core 6.0.3 initialized 'SagasDbContext' using provider 'Npgsql.EntityFrameworkCore.PostgreSQL:6.0.3+94d0a8eaeb9cf5af6ce55a9e59153c1a1be3244f' with options: None
2022-08-05 22:10:14.083 +04:00 [DBG] Opening connection to database 'sagas_db' on server ''.
2022-08-05 22:10:14.084 +04:00 [DBG] Opened connection to database 'sagas_db' on server 'tcp://localhost:3462'.
2022-08-05 22:10:14.084 +04:00 [DBG] Beginning transaction with isolation level 'Serializable'.
2022-08-05 22:10:14.086 +04:00 [DBG] Began transaction with isolation level 'Serializable'.
2022-08-05 22:10:14.089 +04:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2022-08-05 22:10:14.090 +04:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2022-08-05 22:10:14.091 +04:00 [DBG] Executing DbCommand [Parameters=[p0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT b."CorrelationId", b."CurrentState", b."RequestId", b."ResponseAddress"
FROM (
    SELECT * FROM "public"."BuyItemsSagaState" WHERE "CorrelationId" = @p0 FOR UPDATE
) AS b
LIMIT 2
2022-08-05 22:10:14.094 +04:00 [INF] Executed DbCommand (3ms) [Parameters=[p0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT b."CorrelationId", b."CurrentState", b."RequestId", b."ResponseAddress"
FROM (
    SELECT * FROM "public"."BuyItemsSagaState" WHERE "CorrelationId" = @p0 FOR UPDATE
) AS b
LIMIT 2
2022-08-05 22:10:14.097 +04:00 [DBG] Context 'SagasDbContext' started tracking 'BuyItemsSagaState' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2022-08-05 22:10:14.099 +04:00 [DBG] A data reader was disposed.
2022-08-05 22:10:14.099 +04:00 [DBG] SAGA:BuyItemsSagaState:"4fa85f64-5717-4562-b3fc-2c963f66afa6" Used Contracts.IGetMoneyResponse
2022-08-05 22:10:14.103 +04:00 [DBG] SEND "rabbitmq://localhost/buy-items-saga-state" "0c5b0000-5df3-0015-039b-08da770dbe85" MassTransit.Contracts.RequestTimeoutExpired<Contracts.IGetItemsRequest>
2022-08-05 22:10:14.105 +04:00 [DBG] An entity of type 'BuyItemsSagaState' tracked by 'SagasDbContext' changed state from '"Unchanged"' to '"Modified"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2022-08-05 22:10:14.106 +04:00 [DBG] SaveChanges starting for 'SagasDbContext'.
2022-08-05 22:10:14.107 +04:00 [DBG] DetectChanges starting for 'SagasDbContext'.
2022-08-05 22:10:14.107 +04:00 [DBG] DetectChanges completed for 'SagasDbContext'.
2022-08-05 22:10:14.108 +04:00 [DBG] Creating transaction savepoint.
2022-08-05 22:10:14.110 +04:00 [DBG] Created transaction savepoint.
2022-08-05 22:10:14.113 +04:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2022-08-05 22:10:14.114 +04:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2022-08-05 22:10:14.115 +04:00 [DBG] Executing DbCommand [Parameters=[@p3='?' (DbType = Guid), @p0='?', @p1='?' (DbType = Guid), @p2='?'], CommandType='"Text"', CommandTimeout='30']
UPDATE "BuyItemsSagaState" SET "CurrentState" = @p0, "RequestId" = @p1, "ResponseAddress" = @p2
WHERE "CorrelationId" = @p3;
2022-08-05 22:10:14.118 +04:00 [INF] Executed DbCommand (3ms) [Parameters=[@p3='?' (DbType = Guid), @p0='?', @p1='?' (DbType = Guid), @p2='?'], CommandType='"Text"', CommandTimeout='30']
UPDATE "BuyItemsSagaState" SET "CurrentState" = @p0, "RequestId" = @p1, "ResponseAddress" = @p2
WHERE "CorrelationId" = @p3;
2022-08-05 22:10:14.120 +04:00 [DBG] A data reader was disposed.
2022-08-05 22:10:14.120 +04:00 [DBG] Releasing transaction savepoint.
2022-08-05 22:10:14.122 +04:00 [DBG] Released transaction savepoint.
2022-08-05 22:10:14.122 +04:00 [DBG] An entity of type 'BuyItemsSagaState' tracked by 'SagasDbContext' changed state from '"Modified"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2022-08-05 22:10:14.123 +04:00 [DBG] SaveChanges completed for 'SagasDbContext' with 1 entities written to the database.
2022-08-05 22:10:14.124 +04:00 [DBG] Committing transaction.
2022-08-05 22:10:14.130 +04:00 [DBG] Committed transaction.
2022-08-05 22:10:14.130 +04:00 [DBG] Closing connection to database 'sagas_db' on server 'tcp://localhost:3462'.
2022-08-05 22:10:14.131 +04:00 [DBG] Closed connection to database 'sagas_db' on server ''.
2022-08-05 22:10:14.133 +04:00 [DBG] Disposing transaction.
2022-08-05 22:10:14.134 +04:00 [DBG] 'SagasDbContext' disposed.
2022-08-05 22:10:14.134 +04:00 [DBG] RECEIVE "rabbitmq://localhost/buy-items-saga-state" "da210000-5df3-0015-d5c8-08da770dbe7f" Contracts.IGetMoneyResponse BuyItemsSagaState("00:00:00.0552124")
2022-08-05 22:10:14.143 +04:00 [DBG] SEND "rabbitmq://localhost/Contracts:IGetItemsRequest" "0c5b0000-5df3-0015-5276-08da770dbe8a" Contracts.IGetItemsRequest
2022-08-05 22:10:17.560 +04:00 [INF] Entity Framework Core 6.0.3 initialized 'SagasDbContext' using provider 'Npgsql.EntityFrameworkCore.PostgreSQL:6.0.3+94d0a8eaeb9cf5af6ce55a9e59153c1a1be3244f' with options: None
2022-08-05 22:10:17.562 +04:00 [DBG] Opening connection to database 'sagas_db' on server ''.
2022-08-05 22:10:17.563 +04:00 [DBG] Opened connection to database 'sagas_db' on server 'tcp://localhost:3462'.
2022-08-05 22:10:17.564 +04:00 [DBG] Beginning transaction with isolation level 'Serializable'.
2022-08-05 22:10:17.565 +04:00 [DBG] Began transaction with isolation level 'Serializable'.
2022-08-05 22:10:17.567 +04:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2022-08-05 22:10:17.568 +04:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2022-08-05 22:10:17.569 +04:00 [DBG] Executing DbCommand [Parameters=[p0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT b."CorrelationId", b."CurrentState", b."RequestId", b."ResponseAddress"
FROM (
    SELECT * FROM "public"."BuyItemsSagaState" WHERE "CorrelationId" = @p0 FOR UPDATE
) AS b
LIMIT 2
2022-08-05 22:10:17.572 +04:00 [INF] Executed DbCommand (3ms) [Parameters=[p0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT b."CorrelationId", b."CurrentState", b."RequestId", b."ResponseAddress"
FROM (
    SELECT * FROM "public"."BuyItemsSagaState" WHERE "CorrelationId" = @p0 FOR UPDATE
) AS b
LIMIT 2
2022-08-05 22:10:17.574 +04:00 [DBG] Context 'SagasDbContext' started tracking 'BuyItemsSagaState' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2022-08-05 22:10:17.575 +04:00 [DBG] A data reader was disposed.
2022-08-05 22:10:17.576 +04:00 [DBG] SAGA:BuyItemsSagaState:"4fa85f64-5717-4562-b3fc-2c963f66afa6" Used Contracts.IGetItemsResponse
2022-08-05 22:10:17.578 +04:00 [DBG] An entity of type 'BuyItemsSagaState' tracked by 'SagasDbContext' changed state from '"Unchanged"' to '"Modified"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2022-08-05 22:10:17.579 +04:00 [DBG] SaveChanges starting for 'SagasDbContext'.
2022-08-05 22:10:17.580 +04:00 [DBG] DetectChanges starting for 'SagasDbContext'.
2022-08-05 22:10:17.581 +04:00 [DBG] DetectChanges completed for 'SagasDbContext'.
2022-08-05 22:10:17.582 +04:00 [DBG] Creating transaction savepoint.
2022-08-05 22:10:17.589 +04:00 [DBG] Created transaction savepoint.
2022-08-05 22:10:17.590 +04:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2022-08-05 22:10:17.590 +04:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2022-08-05 22:10:17.591 +04:00 [DBG] Executing DbCommand [Parameters=[@p3='?' (DbType = Guid), @p0='?', @p1='?' (DbType = Guid), @p2='?'], CommandType='"Text"', CommandTimeout='30']
UPDATE "BuyItemsSagaState" SET "CurrentState" = @p0, "RequestId" = @p1, "ResponseAddress" = @p2
WHERE "CorrelationId" = @p3;
2022-08-05 22:10:17.595 +04:00 [INF] Executed DbCommand (3ms) [Parameters=[@p3='?' (DbType = Guid), @p0='?', @p1='?' (DbType = Guid), @p2='?'], CommandType='"Text"', CommandTimeout='30']
UPDATE "BuyItemsSagaState" SET "CurrentState" = @p0, "RequestId" = @p1, "ResponseAddress" = @p2
WHERE "CorrelationId" = @p3;
2022-08-05 22:10:17.597 +04:00 [DBG] A data reader was disposed.
2022-08-05 22:10:17.598 +04:00 [DBG] Releasing transaction savepoint.
2022-08-05 22:10:17.601 +04:00 [DBG] Released transaction savepoint.
2022-08-05 22:10:17.602 +04:00 [DBG] An entity of type 'BuyItemsSagaState' tracked by 'SagasDbContext' changed state from '"Modified"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2022-08-05 22:10:17.604 +04:00 [DBG] SaveChanges completed for 'SagasDbContext' with 1 entities written to the database.
2022-08-05 22:10:17.605 +04:00 [DBG] Committing transaction.
2022-08-05 22:10:17.609 +04:00 [DBG] Committed transaction.
2022-08-05 22:10:17.610 +04:00 [DBG] Closing connection to database 'sagas_db' on server 'tcp://localhost:3462'.
2022-08-05 22:10:17.611 +04:00 [DBG] Closed connection to database 'sagas_db' on server ''.
2022-08-05 22:10:17.612 +04:00 [DBG] Disposing transaction.
2022-08-05 22:10:17.612 +04:00 [DBG] 'SagasDbContext' disposed.
2022-08-05 22:10:17.615 +04:00 [DBG] RECEIVE "rabbitmq://localhost/buy-items-saga-state" "da210000-5df3-0015-cda8-08da770dc091" Contracts.IGetItemsResponse BuyItemsSagaState("00:00:00.0566645")
2022-08-05 22:10:17.620 +04:00 [DBG] SEND "rabbitmq://localhost:0/SMS2104090_ApiGateway_bus_5eooyyn76cybkadnbdp8qdj1ys?temporary=true" "0c5b0000-5df3-0015-a8ce-08da770dc09d" Contracts.BuyItemsResponse
